(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[75635,35844],{507333:e=>{e.exports={"css-value-chart-controls-bar-height-with-border":"39px","css-value-chart-controls-bar-border":"1px"}},796416:(e,t,n)=>{"use strict";n.d(t,{TOAST_ANIMATION_DURATION:()=>s});const s=500},93309:(e,t,n)=>{"use strict";n.d(t,{getSetToastUserActivityBasedRemovalTimeout:()=>r});var s=n(587307);function r(e,t,n,r){const o=(0,s.createActivityStatus)(n);return function(n,s=2e4){const{start:i,reset:a}=function(e,t){let n;return{start:()=>{n=setTimeout(e,t)},reset:()=>{clearTimeout(n),n=void 0}}}((()=>{e.removeToast(n,r)}),s),c=()=>{const e=o.value(),n=t.value;e&&!n?i():a()};o.subscribe(c),c();const l=t.subscribe(c),d=e.subscribeOnToast(n,(e=>{"RemoveAnimationStart"===e.type&&(a(),d(),o.unsubscribe(c),l())}))}}},587307:(e,t,n)=>{"use strict";n.d(t,{createActivityStatus:()=>r});var s=n(158942);function r(e,t){const n=new Set,r=new s.WatchedValue("hidden"!==document.visibilityState),o=t?.timers||{setTimeout,clearTimeout},i=o.setTimeout,a=o.clearTimeout;let c;const l=t?.ignoreVisibilityChange;r.subscribe((e=>{n.forEach((t=>t(!!e)))}),{callWithLast:!0});const d=()=>{r.setValue(!0),a(c),c=i((()=>{r.setValue(!1)}),e)},u=()=>{"hidden"===document.visibilityState?r.setValue(!1):d()};return{subscribe:t=>{n.size>0||(a(c),c=i((()=>{r.setValue(!1)}),e),document.addEventListener("click",d,{passive:!0}),document.addEventListener("mousemove",d,{passive:!0}),document.addEventListener("keydown",d,{passive:!0}),document.addEventListener("touchstart",d,{passive:!0}),document.addEventListener("wheel",d,{passive:!0}),l||document.addEventListener("visibilitychange",u,{passive:!0})),n.add(t)},unsubscribe:e=>{n.delete(e),0===n.size&&(document.removeEventListener("click",d),document.removeEventListener("mousemove",d),document.removeEventListener("keydown",d),document.removeEventListener("touchstart",d),document.removeEventListener("wheel",d),l||document.removeEventListener("visibilitychange",u),a(c))},value:()=>!!r.value()}}},936442:(e,t,n)=>{"use strict";n.d(t,{CHART_WARNINIG_GROUP_ID:()=>a,showChartWarningNotification:()=>c});var s=n(148255),r=n(779672),o=n(610057);const i=1e4,a="chart_warning";function c(e,t){return new Promise((n=>{r.toastManager.addToast(e,a,t),(0,o.setToastUserActivityBasedRemovalTimeout)(e,i);const c=(0,s.subscribeOnToast)(e,(e=>{"Remove"!==e.type&&e.details!==o.CLOSE_DUE_TO_INACTIVITY_EVENT_DETAILS||(n(),c())}))}))}},148255:(e,t,n)=>{"use strict";n.d(t,{subscribeOnToast:()=>s});const s=n(779672).toastManager.subscribeOnToast},610057:(e,t,n)=>{"use strict";n.d(t,{CLOSE_DUE_TO_INACTIVITY_EVENT_DETAILS:()=>o,setToastUserActivityBasedRemovalTimeout:()=>i});var s=n(779672),r=n(93309);const o="userActivityTimeout",i=(0,r.getSetToastUserActivityBasedRemovalTimeout)(s.toastManager,s.toastUserInteractionStatus,15e3,o)},779672:(e,t,n)=>{"use strict";n.r(t),n.d(t,{toastManager:()=>r,toastUserInteractionStatus:()=>o});var s=n(796416);const r=function(){const e=new Set,t=new Map,n={groups:new Map};function r(e){const t=n.groups.get(e)
;if(t)return t;const s={id:e,list:new Map,added:new Set,removed:new Set};return n.groups.set(e,s),s}function o(e,s){t.delete(e),s.added.delete(e),s.removed.delete(e),s.list.delete(e),0===s.list.size?n.groups.delete(s.id):n.groups.set(s.id,{...s}),i({type:"Remove",toastId:e,groupId:s.id})}function i(t){n.groups=new Map(n.groups),e.forEach((e=>{e(t)}));const s=a.get(t.toastId);s&&s.forEach((e=>{e(t)}))}const a=new Map;return{addToast:function(e,s,o,a,c){if(t.get(e))return;const l=r(s);l.added.add(e);const d={id:e,...o,manualAnimationStart:c};l.list.set(e,d),t.set(e,s),n.groups.set(s,{...l}),i({type:"Add",toastId:e,groupId:s,data:o,details:a})},removeToast:function(e,r){const a=t.get(e);if(!a)return;const c=n.groups.get(a);c&&(c.removed.has(e)||(c.removed.add(e),n.groups.set(a,{...c}),i({type:"RemoveAnimationStart",toastId:e,groupId:a,details:r}),setTimeout((()=>{o(e,c)}),s.TOAST_ANIMATION_DURATION)))},removeGroup:function(e,t){const r=n.groups.get(e);if(!r)return;const a=[];r.list.forEach((n=>{const s=n.id;r.removed.has(s)||(a.push(s),r.removed.add(s),i({type:"RemoveAnimationStart",toastId:s,groupId:e,details:t}))})),n.groups.set(e,{...r}),setTimeout((()=>{a.forEach((e=>{o(e,r)}))}),s.TOAST_ANIMATION_DURATION)},startAddAnimation:function(e){const s=t.get(e);if(!s)return;const r=n.groups.get(s);r&&r.added.delete(e)&&(n.groups.set(s,{...r}),i({type:"AddAnimationStart",toastId:e,groupId:s}))},subscribeOnToast:function(e,t){const n=function(e){const t=a.get(e);if(t)return t;const n=new Set;return a.set(e,n),n}(e);return n.add(t),()=>{n.delete(t),0===n.size&&a.delete(e)}},state:n,subscribe:function(t){return e.add(t),()=>{e.delete(t)}}}}(),o=function(){const e=new Set,t=new Set,n={update:function(s,r){s?t.add(r):t.delete(r);const o=t.size>0;n.value!==o&&(n.value=o,e.forEach((e=>{e(s)})))},value:!1,subscribe:function(t){return e.add(t),()=>{e.delete(t)}}};return n}()},474759:(e,t,n)=>{"use strict";function s(e){const t={};return e.sources&&(t.sources={},e.sources.forEach(((e,n)=>{t.sources[n]=e}))),t.drawing_groups={},e.groups.forEach(((e,n)=>{t.drawing_groups[n]=e})),t.clientId=e.clientId,JSON.stringify(t)}function r(e,t){const n={sources:null,groups:new Map};if(null!==e.sources){n.sources=new Map;for(const t in e.sources||{}){const s=e.sources[t];n.sources.set(t,s)}}for(const t in e.drawing_groups||{}){const s=e.drawing_groups[t];n.groups.set(t,s)}return null!==t&&(n.serverRequestId=t),n.clientId=e.clientId,n.symbol=e.symbol,n}n.d(t,{parseLineToolsAndGroupsDTO:()=>r,stringifyLineToolsAndGroupsDTO:()=>s})},652171:(e,t,n)=>{"use strict";n.d(t,{getStorageTarget:()=>c,globallySharedChartId:()=>a,sharedChartId:()=>i});var s=n(954912),r=n(175203),o=n(357517);const i="_shared",a="UserSync";async function c(e,t,n,a){try{const c=new URL("/chart-token/",location.href);c.searchParams.append("image_url",e),c.searchParams.append("user_id",String(window.user.id||-1));const l=await(0,s.fetch)(c.toString(),{signal:a});if(!l.ok)throw new Error(`Http response is not ok: ${l.status}}`);const d=await l.json()
;if(r.telemetry.sendLineToolsStorageReport("line_tools_token_request_success"),a?.aborted)throw(0,o.createAbortError)();const u=2===n?void 0:1===n?i:t;return{token:d.token,chartId:u,path:2===n?"user/sources":`layout/${e}/sources`}}catch(e){throw(0,o.isAbortError)(e)||r.telemetry.sendLineToolsStorageReport("line_tools_token_request_error"),e}}},375635:(e,t,n)=>{"use strict";n.d(t,{applyIndicatorToAllChartsImpl:()=>le,applyIndicatorsToAllChartsImpl:()=>ae,applyLineToolUpdateNotificationImpl:()=>de,applyStudiesOverrides:()=>Ie,applyThemeImpl:()=>we,chartsSymbolsImpl:()=>pe,copyScreenshotToClipboard:()=>fe,createChartStorageSubscriptionsIfRequired:()=>ge,createClipboardHandler:()=>he,createLeftBottomChartWidgetWV:()=>ye,downloadScreenshot:()=>_e,generateNewChartId:()=>Te,getVisuallyAdjacentDefImpl:()=>ve,handleConnectionLimitReachedChanged:()=>Ce,setBrokerImpl:()=>me});var s=n(650151),r=n(444372),o=n(892323),i=n(674377),a=n(925341);class c extends a.UndoCommand{constructor(e,t){super(null),this._chartModel=e,this._targetIndex=t}redo(){const e=this._chartModel.createPane(this._targetIndex,void 0,this._paneId);this._paneId=e.id()}undo(){const e=(0,s.ensureDefined)(this._paneId),t=this._chartModel.panes().find((t=>t.id()===e));void 0!==t&&this._chartModel.removePane(t)}createdPaneId(){return this._paneId}}var l=n(735566),d=n(927301),u=n(507458);const h=(0,l.getLogger)("Clipboard");class m{constructor(e){this._e=e}write(e){return(0,u.writeImpl)(this._toRaw(e),this._e)}_toRaw(e){const t={files:[]};t.text=e.text,void 0!==e.app?t.html=this._serializeAppData(e.app,e.text):e.html&&(t.html=e.html);for(const n of e.files||[])t.files.push(n);return t}_serializeAppData(e,t){return`<meta charset="utf-8"><span data-tradingview-clip="${(0,d.htmlEscape)(e)}">${t?(0,d.htmlEscape)(t.slice(0,256)):"&#128200;"}</span>`}}class p{constructor(e){this._e=e}async read(){this._e&&0===this._e.eventPhase&&(h.logWarn("Cannot use an already dispatched ClipboardEvent for reading"),this._e=null);const e=this._e?this._readUsingEvent(this._e):await this._readUsingApi();return this._fromRaw(e)}_readUsingEvent(e){const t=(0,s.ensure)(e.clipboardData);e.preventDefault();const n={files:[]};for(let e=0;e<t.files.length;e++)n.files.push(t.files[e]);for(let e=0;e<t.items.length;e++){const s=t.items[e];"string"===s.kind&&("text/plain"===s.type?n.text=t.getData(s.type):"text/html"===s.type?n.html=t.getData(s.type):n.files.push(new Blob([t.getData(s.type)],{type:s.type})))}return n}async _readUsingApi(){const e=(0,u.getClipboard)();if(!e||!e.read)throw new DOMException("ClipboardApi is not supported","NotSupportedError");let t,n;const s=[],r=await e.read();for(const e of r)for(const r of e.types)"text/html"===r?t=e.getType(r).then(this._readBlobAsText):"text/plain"===r?n=e.getType(r).then(this._readBlobAsText):s.push(e.getType(r));return{text:await n,html:await t,files:await Promise.all(s)}}_fromRaw(e){const t={};if(void 0!==e.text&&(t.text=e.text),void 0!==e.html){const n=this._parseAppData(e.html);n?t.app=n:t.html=e.html}
return e.files.length>0&&(t.files=e.files),t}_parseAppData(e){if(-1===e.slice(0,1024).indexOf("data-tradingview-clip"))return;const t=(new DOMParser).parseFromString(e,"text/html").querySelector("[data-tradingview-clip]");return t?t.getAttribute("data-tradingview-clip")||"":void 0}_readBlobAsText(e){return new Promise(((t,n)=>{const s=new FileReader;s.onloadend=()=>{t(s.result)},s.onerror=()=>{n(s.error)},s.readAsText(e)}))}}class g{constructor(e){this._callbacks=Object.assign({},e),this._boundOnCopy=this._onCopyEv.bind(this),this._boundOnCut=this._onCutEv.bind(this),this._boundOnPaste=this._onPasteEv.bind(this)}listen(){document.addEventListener("copy",this._boundOnCopy),document.addEventListener("cut",this._boundOnCut),document.addEventListener("paste",this._boundOnPaste)}async peek(){if("granted"!==(await navigator.permissions.query({name:"clipboard-read"})).state)throw new Error("clipboard-read is not granted");return new p(null).read()}uiRequestCopy(e){this._callbacks.copyRequested&&this._callbacks.copyRequested(new m(null),e)}uiRequestCut(e){this._callbacks.cutRequested&&this._callbacks.cutRequested(new m(null),e)}uiRequestPaste(e){this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new p(null),e)}destroy(){document.removeEventListener("copy",this._boundOnCopy),document.removeEventListener("cut",this._boundOnCut),document.removeEventListener("paste",this._boundOnPaste)}_onCopyEv(e){e.defaultPrevented||this._callbacks.copyRequested&&this._callbacks.copyRequested(new m(e))}_onCutEv(e){e.defaultPrevented||this._callbacks.cutRequested&&this._callbacks.cutRequested(new m(e))}_onPasteEv(e){e.defaultPrevented||this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new p(e))}}var _=n(515312);function f(e){const t=e.target;return null!==t&&1===t.nodeType&&(0,_.isTextEditingField)(t)}function b(e){const t=e.target;if(null===t)return!1;const n=(t.ownerDocument||t).getSelection();return null!==n&&!n.isCollapsed}class y extends g{_onCopyEv(e){if(!f(e)&&!b(e))return super._onCopyEv(e)}_onCutEv(e){if(!f(e)&&!b(e))return super._onCutEv(e)}_onPasteEv(e){if(!f(e))return super._onPasteEv(e)}}var v=n(331841),T=n(936442),w=n(470316),C=n(354298),I=n(400353),S=n(277038),E=n(74867),k=n(175203),M=n(314802),A=n(798266),R=n(652171),O=n(474759),N=n(666054),L=n(908177),W=n(251924),U=n(125226),P=n(77294);const D=new Set(["chart_storage_hibernation_delay_60min","chart_storage_hibernation_delay_10min","chart_storage_hibernation_delay_5min"]);const x=new P.WatchedValue(B());function B(){return(0,U.isFeatureEnabled)("chart_storage_hibernation_delay_60min")?36e5:(0,U.isFeatureEnabled)("chart_storage_hibernation_delay_10min")?6e5:(0,U.isFeatureEnabled)("chart_storage_hibernation_delay_5min")?3e5:6e4}(0,U.onFeaturesStateChanged)().subscribe(null,(e=>{if(!function(e){return D.has(e)}(e))return;const t=B();x.setValue(t,!1)}));const V=x.readonly();var q=n(638456);function F(e){const t=document.querySelector('link[rel~="chart-storage-notifications"]');return t?.href?e?new URL(e,t.href):new URL(t.href):null}function H(e,t){
return Boolean(e.metaInfo.uid.value())&&!t.containsData&&!t.onWidget&&function(){if(!(0,M.isOnMobileAppPage)("new"))return!0;const e=/TradingView\/(\d+)\.(\d+)\.(\d+)\.?/.exec(navigator.userAgent);if(null===e)return!0;const t=Number(e[1])-1,n=Number(e[2])-15,s=Number(e[3])-0;if(t>0||0===t&&n>0||0===t&&0===n&&s>0)return!0;return!1}()&&null!==F()}const j=(0,l.getLogger)("ChartStorageChangesSubscription");class z extends A.PersistentEventSourceTransport{constructor(e,t){super((e=>this._onMessage(e))),this._destroyed=!1,this._onChangeVisibilityBound=this._onChangeVisibility.bind(this),this._hibernateTimerId=null,this._hibernateDelay=V.spawn(),this._beforeUnhibernating=new W.Delegate,this._onChangesCallbacks=new Set,this._haveEverBeenHibernated=!1,this._fireBeforeUnhibernatingOnReconnect=!1,this._fireBeforeUnhibernatingOnReconnectTimerId=0,this._reconnect=()=>{this._tryReconnect()},this._chartWidgetsCollection=e,this._layoutVisibility=e.resizerBridge().visible.spawn(),this._layoutVisibility.subscribe(this._onChangeVisibilityBound,{callWithLast:!0}),k.telemetry.sendLineToolsStorageReport("line_tools_subscription_initial_connect"),this._connectionStatus.subscribe((e=>{e===N.ConnectionStatus.Closed&&k.telemetry.sendLineToolsStorageReport("line_tools_subscription_disconnected")})),this._subscribeForSharingLayout=t,this.connect(),this._hibernateDelay.subscribe((e=>{null!==this._hibernateTimerId&&this._scheduleHibernation(e)})),this._chartWidgetsCollection.metaInfo.uid.subscribe(this._reconnect)}destroy(){this._layoutVisibility.destroy(),this._hibernateDelay.destroy(),this._chartWidgetsCollection.metaInfo.uid.unsubscribe(this._reconnect),this.disconnect(),this._destroyed=!0}subscribeOnChanges(e){this._onChangesCallbacks.add(e)}unsubscribeOnChanges(e){this._onChangesCallbacks.delete(e)}beforeUnhibernating(){return this._beforeUnhibernating}async _prepareParamsForConnection(e){const t=this._chartWidgetsCollection.metaInfo.uid.value();if(this._destroyed)return Promise.reject("Subscription is being destroyed");const n=await(0,R.getStorageTarget)(t,"",0),s=F(`/charts-storage/layout/${t}/subscribe`);null!==s?(s.searchParams.delete("jwt"),s.searchParams.append("jwt",n.token),this._subscribeForSharingLayout&&window.user.id&&window.user.is_pro&&s.searchParams.append("id",""+window.user.id),this._url=s.toString()):this._url=""}_tryReconnectImpl(){super._tryReconnectImpl(),k.telemetry.sendLineToolsStorageReport("line_tools_subscription_reconnecting")}_onOpenCallback(){super._onOpenCallback(),this._fireBeforeUnhibernatingOnReconnect&&(j.logNormal("Unhibernating on reconnect"),this._beforeUnhibernating.fire(),this._fireBeforeUnhibernatingOnReconnect=!1,clearTimeout(this._fireBeforeUnhibernatingOnReconnectTimerId),this._fireBeforeUnhibernatingOnReconnectTimerId=0)}_onMessage(e){if("string"!=typeof e)throw new Error("Wrong message type, expected string");const t=JSON.parse(e);Object.entries(t).forEach((e=>{const t=(0,O.parseLineToolsAndGroupsDTO)(e[1],""),n=e[0];let s=0;n===R.sharedChartId?s=1:n===R.globallySharedChartId&&(s=2),
this._chartWidgetsCollection.applyLineToolUpdateNotification(n,t,s)})),this._onChangesCallbacks.forEach((t=>t(e)))}_onChangeVisibility(){const e=this._layoutVisibility.value();j.logNormal(`Visibility changed to ${e}, connection status: ${this.connectionStatus().value()}`),e?this.connectionStatus().value()!==N.ConnectionStatus.Open?(this.connectionStatus().value()===N.ConnectionStatus.Closed&&this.connect(),this._beforeUnhibernating.fire(),this._haveEverBeenHibernated&&(j.logNormal("Connect due to becoming visible"),k.telemetry.sendLineToolsStorageReport("line_tools_unhibenate_subscription"))):((0,M.isOnMobileAppPage)("any")||q.CheckMobile.iOS()||q.CheckMobile.Android())&&(j.logNormal("Schedule unhibernating on reconnect"),this._fireBeforeUnhibernatingOnReconnect=!0,clearTimeout(this._fireBeforeUnhibernatingOnReconnectTimerId),this._fireBeforeUnhibernatingOnReconnectTimerId=setTimeout((()=>{j.logNormal("Cancel Scheduled unhibernating on reconnect"),this._fireBeforeUnhibernatingOnReconnect=!1}),5e3)):e||this._scheduleHibernation(V.value())}_scheduleHibernation(e){null!==this._hibernateTimerId&&L.workerBasedTimers.clearTimeout(this._hibernateTimerId),this._hibernateTimerId=L.workerBasedTimers.setTimeout((()=>this._disconnectIfInvisible()),e)}_disconnectIfInvisible(){this._hibernateTimerId=null,this._layoutVisibility.value()||(j.logNormal("Disconnect due to becoming invisible"),this.disconnect(),k.telemetry.sendLineToolsStorageReport("line_tools_hibenate_subscription"),this._haveEverBeenHibernated=!0)}}var G=n(308721),$=n(251954),Y=n(909740);const J=new o.TranslatedString("apply toolbars theme",r.t(null,void 0,n(686708)));class K extends a.UndoCommand{constructor(e,t,n=!0){super(J),this._prevThemeName=e,this._themeName=t,this._syncState=n}undo(){(0,G.isStdThemeName)(this._prevThemeName)&&((0,Y.setTheme)(this._prevThemeName),this._syncState&&(0,G.syncTheme)())}redo(){(0,G.isStdThemeName)(this._themeName.toLowerCase())&&((0,Y.setTheme)(this._themeName.toLowerCase()),this._syncState&&(0,G.syncTheme)())}}var Q=n(4944),X=n(791638),Z=n(163263),ee=n(327734);n(507333);const te=new o.TranslatedString("apply indicators to entire layout",r.t(null,void 0,n(870507))),ne=new o.TranslatedString("apply chart theme",r.t(null,void 0,n(368231))),se=r.t(null,void 0,n(328298)),re=r.t(null,void 0,n(978972)),oe=r.t(null,void 0,n(410615)),ie=r.t(null,void 0,n(981518));function ae(e,t){const n=t.model().model().studyTemplate();e.undoHistory.beginUndoMacro(te);for(let s=0;s<e.chartWidgetsDefs.length;s++){const r=e.chartWidgetsDefs[s].chartWidget;r!==t&&(r.hasModel()&&r.model().applyStudyTemplate(n,""))}e.undoHistory.endUndoMacro()}function ce(e,t){for(const n of e.sources){if("study"!==n.type)return!0;if(t.checkIfFeatureAvailable(new ee.StudyMetaInfo(n.source.metaInfo),[]))return!0}return!1}async function le(e,t,n,r,o){e.undoHistory.beginUndoMacro(o);for(let i=0;i<e.chartWidgetsDefs.length;i++){const a=e.chartWidgetsDefs[i].chartWidget;if(a!==t&&a&&a.hasModel()){const t=a.model();if(!ce(n,t))continue;let i;if(r.isOnMainPane)i=(0,
s.ensureNotNull)(t.model().paneForSource(a.model().model().mainSeries()));else{const n=new c(t.model(),r.paneIndex);e.undoHistory.pushUndoCommand(n);const o=(0,s.ensureDefined)(n.createdPaneId());i=(0,s.ensureDefined)(t.model().panes().find((e=>e.id()===o)))}const l=await t.pasteSourceFromClip(i,n,!0);if(l&&1===l.length){const e=l[0];if(r.asCompare){const n=(0,s.ensureNotNull)(t.mainSeries().priceScale());t.moveToScale(e,(0,s.ensureDefined)(i),n,o),t.setPriceScaleMode({percentage:!0},n,null)}}t.model().lightUpdate()}}e.undoHistory.endUndoMacro()}async function de(e,t,n,s){const r=e.map((e=>e.chartWidget)).filter((e=>e.hasModel())).filter((e=>e.id()===t||0!==s));try{r.forEach((e=>e.startApplyingLineToolUpdateNotification()));for(const e of r)await e.model().model().withoutLineToolsSyncAction((()=>e.applyLineToolUpdateNotification(n,s)))}finally{r.forEach((e=>e.endApplyingLineToolUpdateNotification()))}}function ue(e){return e instanceof Error?e.message:null}function he(e){return new y({copyRequested:(t,n)=>{e.activeChartWidget.value().model().clipboardCopy(t,n).catch((e=>{const t=ue(e)??se.format({keystroke:(0,w.humanReadableHash)(w.Modifiers.Mod+67)});(0,T.showChartWarningNotification)("copy",{title:re,text:t})}))},cutRequested:(t,n)=>{e.activeChartWidget.value().model().clipboardCut(t,n).catch((e=>{const t=ue(e)??se.format({keystroke:(0,w.humanReadableHash)(w.Modifiers.Mod+88)});(0,T.showChartWarningNotification)("cut",{title:oe,text:t})}))},pasteRequested:(t,n)=>{if(n?.mode()===i.PaneMode.Widget)return;(n?n.model().undoModel():e.activeChartWidget.value().model()).clipboardPaste(t,n).catch((e=>{const t=ue(e)??se.format({keystroke:(0,w.humanReadableHash)(w.Modifiers.Mod+86)});(0,T.showChartWarningNotification)("paste",{title:ie,text:t})}))}})}function me(e,t){(0,C.setBroker)(t)}function pe(e){const t={};return e.chartWidgetsDefs.map((e=>e.chartWidget)).forEach((e=>t[e.id()]=function(e){const t={};if(!e.hasModel()){const n=e.options().content;if(!n)return t;const r=(0,s.ensureNotNull)(n.panes.reduce(((e,t)=>e??t.sources.find((e=>"MainSeries"===e.type))??null),null));return t.resolution=r.state?.interval,t.symbol=r.state?.symbol,t.short_name=r.state?.shortName,t}const n=e.model().mainSeries(),r=n.properties().childs(),o=n.symbolInfo();t.resolution=r.interval.value(),t.symbol_type=null!==o&&o.type||"",t.exchange=null!==o&&o.exchange||"",t.listed_exchange=null!==o&&o.listed_exchange||"";const i=o?.legs??[];if(null!==o&&n.isSpread()){const e=i[0];let n=o.base_name[0];n=n.split(":")[1],t.symbol=e,t.short_name=n,t.expression=o.full_name}else t.symbol=null!==o&&o.ticker||r.symbol.value(),t.short_name=r.shortName.value();const a=o?.base_name??[];return t.legs=i.map(((e,t)=>({symbol:e,pro_symbol:a[t]}))),t}(e))),t}function ge(e,t){if(H(e,t.widgetOptions)){const n=new z(e,!e.readOnly());n.beforeUnhibernating().subscribe(e,(()=>{!function(e){e.chartWidgetsDefs.map((e=>e.chartWidget)).forEach((e=>e.reloadAllLineTools()))}(t)})),t.setChartStorageNotificationSubscription(n)}}function _e(e){return v.downloadClientScreenshot(e)}
function fe(e){return v.copyToClipboardClientScreenshot(e).then((()=>{(0,$.emit)("onClientScreenshotCopiedToClipboard")}))}const be={s:0,"2h":0,"2v":1,"3h":0,"3v":2,"3s":0,"3r":1,"2-1":1,"1-2":1,4:1,"4v":3,"4h":0,"4s":0,"4s-l":0,"1-3":1,"3-1":3,"2-2-l":0,"2-2-r":1,"2-2":3,"1-4":1,"5h":0,"5v":0,"5s":0,"5s-l":0,"2-3":2,"3-2":3,"4-1":4,"2-3-l":0,"2-3-r":2,6:1,"6h":0,"6v":0,"6c":4,"2-4":2,"4-2":4,"4-3":4,"7h":0,"7s":0,8:1,"8c":6,"8h":0,"8v":0,"9s":6,"5-4":5,"9h":0,"9v":0,"10c5":1,"10h":0,"10v":0,"12c6":1,"12c4":3,"12h":0,"14c7":1,"16c8":1,"16c4":3};function ye(e,t,n,s){let r=0;const o=(0,X.createWVFromGetterAndSubscriptions)((()=>++r),[n,s]);return(0,Q.combine)(((t,n)=>e()[be[t]]??null),t.weakReference(),o.ownership())}function ve(e,t,n){const s=e.chartWidgetsDefs.slice(0,e.layoutTemplate.value().count).map(((t,n,s)=>({def:t,metrics:e.layoutTemplate.value().sizer({top:0,left:0,width:256,height:256},n,s.length,0)}))).sort(((e,t)=>e.metrics.top-t.metrics.top||e.metrics.left-t.metrics.left)).map((e=>e.def));if(s.length<2)return null;let r=s.indexOf(t);return-1===r?null:(r=(r+(n?s.length-1:1))%s.length,s[r])}function Te(e){let t=1;for(;e(""+t);)t++;return""+t}async function we(e,t,n){const{theme:s,onlyActiveChart:r,restoreNonThemeDefaults:o,themeName:i,standardTheme:a,syncState:c=!0,noUndo:l}=n,d=(0,G.getCurrentTheme)().name;let u;r?u=[e.activeChartWidget.value()]:(await Promise.all(e.savedChartWidgetOptions.map(((e,t)=>t)).map((t=>new Promise((n=>{const s=function(e,t,n){return e.addNewChartWidget(t,n)}(e,t,n);e.hideChart(s)}))))),u=e.chartWidgetsDefs.map((e=>e.chartWidget))),l?(a&&new K(d,i,c).redo(),u.forEach((e=>{e.model().model().restoreTheme(s,o,l)}))):(e.undoHistory.beginUndoMacro(ne),a&&e.undoHistory.pushUndoCommand(new K(d,i,c)),u.forEach((e=>{e.model().model().restoreTheme(s,o)})),e.undoHistory.endUndoMacro()),await Promise.all(u.map((e=>e.model().model().colorStudiesPropertiesReady())))}function Ce(e){if(e){const e=function(){const e=(0,I.getConfig)("BACKEND_CONNECTIONS")?.limit??0,t=(0,s.ensureDefined)(window.pro),n=t.getProductsByType(t.PRODUCT_TYPES.pro_plan);for(const t of n)if(((0,I.getConfig)("BACKEND_CONNECTIONS",(0,s.ensureDefined)(t.id))?.limit??0)>e)return{connectionCount:e,moreConnectionsPlanAvailable:!0};return{connectionCount:e,moreConnectionsPlanAvailable:!1}}(),t=[{text:r.t(null,void 0,n(906186)),action:E.PredefinedAction.Close,variant:"secondary",color:"gray",compactMode:!0,onClick:()=>window.ChartApiInstance.connect()}];e.moreConnectionsPlanAvailable&&t.push({action:E.PredefinedAction.OpenGopro,text:r.t(null,void 0,n(987780)),compactMode:!0}),(0,S.createGoProDialog)({feature:"connectionsLimit",actionButtonsLayout:t.length>1?E.ActionButtonsLayout.Row:E.ActionButtonsLayout.Column,actions:t,customParams:e})}}function Ie(e){ee.StudyMetaInfo.mergeDefaultsOverrides(e),(0,Z.studyMetaInfoRepository)().isReady()&&ee.StudyMetaInfo.overrideDefaults((0,Z.studyMetaInfoRepository)().getInternalMetaInfoArray())}},331841:(e,t,n)=>{"use strict";n.d(t,{copyToClipboardClientScreenshot:()=>i,
copyToClipboardImageOfChart:()=>r,downloadClientScreenshot:()=>a,getImageOfChartSilently:()=>o});const s=()=>Promise.all([n.e(96330),n.e(54389)]).then(n.bind(n,756853));function r(e,t={}){return s().then((n=>n.copyToClipboardImageOfChart(e,t)))}function o(e,t={}){return s().then((n=>n.getImageOfChartSilently(e,t)))}function i(e){return s().then((t=>t.copyToClipboardClientScreenshot(e)))}function a(e){return s().then((t=>t.downloadClientScreenshot(e)))}},908177:(e,t,n)=>{"use strict";n.d(t,{workerBasedTimers:()=>o});var s=n(357517),r=n(476914);const o=new class{constructor(){this._timerWorker=null,this._timerIdCounter=1,this._timersMap=new Map,this._rejectsToCall=new Set,this._processMessage=e=>{const t=this._timersMap.get(e.data.turnaround);switch(e.data.type){case"timerCreated":t&&(t.scheduledForRemoving?("interval"===t.type?this._getTimerWorker().postMessage({type:"clearInterval",id:e.data.id}):this._getTimerWorker().postMessage({type:"clearTimeout",id:e.data.id}),this._deleteTimerFromMap(e.data.turnaround)):t.workerTimerId=e.data.id);break;case"timerFired":t&&(t.callback(),"timeout"===t.type&&this._deleteTimerFromMap(e.data.turnaround))}}}destroy(){this._rejectsToCall.forEach((e=>e((0,s.createAbortError)()))),this._timerWorker?.terminate(),this._timerWorker=null,this._timersMap.clear()}setTimeout(e,t){return this._setTimeoutImpl(e,t,"timeout")}clearTimeout(e){const t=this._timersMap.get(e);t&&(t.workerTimerId?(this._getTimerWorker().postMessage({type:"clearTimeout",id:t.workerTimerId}),this._deleteTimerFromMap(e)):t.scheduledForRemoving=!0)}setInterval(e,t){const n=this._nextTimerId();return this._timersMap.set(n,{callback:e,type:"interval"}),this._getTimerWorker().postMessage({type:"setInterval",delay:t,turnaround:n}),n}clearInterval(e){const t=this._timersMap.get(e);t&&(t.workerTimerId?(this._getTimerWorker().postMessage({type:"clearInterval",id:t.workerTimerId}),this._deleteTimerFromMap(e)):t.scheduledForRemoving=!0)}async createTimeout(e,t){let n;return new Promise(((r,o)=>{n=o,this._rejectsToCall.add(n);const i=this.setTimeout(r,e);t?.signal?.addEventListener("abort",(()=>{this.clearTimeout(i),o((0,s.createAbortError)())}))})).finally((()=>{this._rejectsToCall.delete(n)}))}async*createInterval(e,t){let n=()=>{},r=e=>{};const o=this.setInterval((()=>{n()}),e);t.signal.addEventListener("abort",(()=>{this.clearInterval(o),r((0,s.createAbortError)())}));try{for(;;)await new Promise(((e,t)=>{n=e,this._rejectsToCall.delete(r),r=t,this._rejectsToCall.add(r)})),yield}catch(e){if(!(0,s.isAbortError)(e))throw e}}_getTimerWorker(){return null===this._timerWorker&&(this._timerWorker=new r.Worker(new URL(n.p+n.u(77050),n.b),{name:"Timer worker"}),this._timerWorker.onmessage=this._processMessage),this._timerWorker}_setTimeoutImpl(e,t,n){const s=this._nextTimerId();return this._timersMap.set(s,{callback:e,type:n}),this._getTimerWorker().postMessage({type:"setTimeout",delay:t,turnaround:s}),s}_deleteTimerFromMap(e){if(this._timersMap.delete(e),0===this._timersMap.size){const e=this._setTimeoutImpl((()=>{
1===this._timersMap.size&&this._timersMap.has(e)&&(this._timersMap.delete(e),this._timerWorker?.terminate(),this._timerWorker=null)}),6e4,"terminal_timer")}}_nextTimerId(){return this._timerIdCounter++}}}}]);