"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[57211],{708246:(t,e,i)=>{i.d(e,{iterateAndPatchObjectsByMap:()=>f,patchPropertiesAsync:()=>c,processLegacy:()=>y});var n=i(650151),s=i(735566),r=i(290222),o=i(197188),a=i(345848),u=i(603774),l=i(282312),d=i(744404);const p=(0,s.getLogger)("Pine.ScriptLib");function c(t,e,i,n=null,o,u){return p.logNormal("patchPropertiesAsync"),u=u??void 0===o,new Promise(((c,y)=>{if(!e.TVScriptMetaInfoExprs)return void c(t);const h=e.TVScriptMetaInfoExprs.tree||"",g=e.TVScriptMetaInfoExprs.patchMap||{};(function(t,e){(0,a.trackEvent)("Pine","ScriptLib.evalMetaInfoExprs");const i=d.Deferred(),n={username:window.user&&window.user.username,source:t,inputs:JSON.stringify(e||{})};return(0,l._pineFacadeAjax)("POST","/eval_pine_ex/",n).done(((t,e)=>{t.error?i.reject((0,l._readableError)(t.error,e)):t.success?i.resolve(t.result):i.reject((0,l.safetyGetReason)(t))})).fail((t=>{(0,l._anyRequestAsyncFail)(i,t)})),i.promise()})(h,i).done((i=>{if(!i)return void c(t);if(n?.aborted)return;const a=t.childs().inputs.childs().text.value(),l=i.rootValues;f([t,e.defaults,e],g,((e,i,n)=>{const s=l[n],r=e[0],a=e[1],d=e[2];if(u||void 0!==o?.[n]&&o[n]!==s)if(a?.hasOwnProperty(i)&&d?.hasOwnProperty(i)&&p.logError(`Inconsistent meta info structure: both defaults and meta have property ${i}`),a?.hasOwnProperty(i)){const e=r[i];t.childs()?.patchMetaInfoDefaults?.value()?((u||e.value()===a[i])&&e.setValue(s),a[i]=s):e.setValue(s)}else d[i]=s})),void 0!==o&&Object.keys(l).forEach((t=>{void 0!==o[t]&&(o[t]=l[t])}));const d=t.childs().inputs.childs().text.value();a&&!d&&(0,r.getPersistentLogger)()?.addPersistentLogEntry(`Detected invalid meta info evaluation expression result: IL code input value is empty, id: ${e.fullId}`,s.LOGLEVEL.ERROR,"PineMetaInfoValidation"),c(t)})).fail((t=>{y(t)}))}))}function f(t,e,i){const s=Object.keys(e);for(let r=0;r<s.length;r++){const o=s[r],a=e[o],u=o.split(".");"defaults"===u[0]&&u.splice(0,1),(0,n.assert)(u.length>1,"Unexpectedly short json path");let l=[...t];for(let t=0;t<u.length-1;++t){const e=u[t];l=l.map((t=>t?t[e]:null))}i(l,u[u.length-1],a)}}function y(t,e){(0,a.trackEvent)("Pine","ScriptLib.processLegacy");const i=(0,o.createDeferredPromise)(),n=window.user&&window.user.username,s="/process_legacy/"+encodeURIComponent(t)+"/?user_name="+encodeURIComponent(n),r=e?{source:e}:{};return(0,l._pineFacadeAjax)("POST",s,r).done((t=>{t.error?i.reject((0,l._readableError)(t.error)):t.success?((0,u.logPineMetaInfoIssues)("ScriptLib.processLegacy",t.result.metaInfo),i.resolve(t.result.metaInfo)):i.reject((0,l.safetyGetReason)(t))})).fail((t=>{(0,l._anyRequestAsyncFail)(i,t)})),i.promise}},985324:(t,e,i)=>{i.d(e,{migrateMetaInfoAndPropState:()=>d});var n=i(650151),s=i(327734),r=i(536794);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"],a=["DoubleTopCP@tv-basicstudies","BullishFlagCP@tv-basicstudies","HeadAndShouldersCP@tv-basicstudies","TripleTopCP@tv-basicstudies"];class u{targetMetaInfoVersion(){return 53}migrateMetaInfo(t){
const e=t,i=t;if(i._metainfoVersion=53,void 0!==e.defaults&&void 0!==e.defaults.inputs&&(o.includes(e.id)||a.includes(e.id)&&Number(e.version)<156)){const t=e.defaults.inputs["Invert Pattern"];i.id=this._getNewIdStudies(e.id,t)}}migratePropState(t){}_getNewIdStudies(t,e){return t.startsWith("WedgeCP")?e?"WedgeFallingCP@tv-basicstudies":"WedgeRisingCP@tv-basicstudies":t.startsWith("PennantCP")?e?"PennantBearishCP@tv-basicstudies":"PennantBullishCP@tv-basicstudies":t.startsWith("DoubleTopCP")&&e?"DoubleBottomCP@tv-basicstudies":t.startsWith("BullishFlagCP")&&e?"BearishFlagCP@tv-basicstudies":t.startsWith("HeadAndShouldersCP")&&e?"HeadAndShouldersInverseCP@tv-basicstudies":t.startsWith("TripleTopCP")&&e?"TripleBottomCP@tv-basicstudies":t}}const l=[new class{targetMetaInfoVersion(){return 47}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=47,!e.defaults||void 0===e.defaults.precision)return void(i.format={type:"inherit"});const n=e.defaults&&e.defaults.precision,s=(0,r.isNumber)(n)?n:parseInt(n);0===s?i.format={type:"volume"}:isFinite(s)?i.format={type:"price",precision:s}:i.format={type:"inherit"},delete e.defaults.precision}migratePropState(t){}},new class{targetMetaInfoVersion(){return 50}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=50,void 0===e.defaults||void 0===e.defaults.ohlcPlots||void 0===e.ohlcPlots)return;const s=e.ohlcPlots,r=e.defaults.ohlcPlots,o=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const t of Object.keys(r)){const e=r[t];if("ohlc_candles"===e.plottype){let i=!1;const n=s[t];void 0!==n&&(i=!!n.drawBorder,delete n.drawBorder),o[t]={borderColor:"#000000",drawBorder:i,...e}}}}migratePropState(t){}},new class{targetMetaInfoVersion(){return 53}migrateMetaInfo(t){const e=t,i=t;if(i._metainfoVersion=53,void 0!==e.defaults){if(void 0!==e.defaults.ohlcPlots&&void 0!==e.ohlcPlots){const t=Object.keys(e.ohlcPlots),s=e.defaults.ohlcPlots,r=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const e of t){const t=s[e];if(void 0===t||void 0===t.visible)continue;const i=t.visible?4294967295:0;delete t.visible,r[e]={display:i,...t}}}if(void 0!==e.defaults.styles&&void 0!==e.plots){const t=e.plots.map((t=>t.id)),s=e.defaults.styles,r=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).styles);for(const e of t){const t=s[e];if(void 0===t||void 0===t.visible)continue;const i=t.visible?4294967295:0;delete t.visible,r[e]={display:i,...t}}}}}migratePropState(t){if(t.ohlcPlots)for(const e of Object.keys(t.ohlcPlots)){const i=(0,n.ensureDefined)(t.ohlcPlots[e]);void 0!==i.visible&&(i.display=i.visible?4294967295:0,delete i.visible)}if(t.styles)for(const e of Object.keys(t.styles)){const i=(0,n.ensureDefined)(t.styles[e]);void 0!==i.visible&&(i.display=i.visible?4294967295:0,delete i.visible)}}}];function d(t,e){const i=s.StudyMetaInfo.versionOf(t),r=t;void 0===r._serverMetaInfoVersion&&(r._serverMetaInfoVersion=i);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"].includes(t.id);l.forEach((s=>{(i<0||i>=s.targetMetaInfoVersion())&&!o||(s.migrateMetaInfo(t),
void 0!==e&&s.migratePropState(e),(0,n.assert)(t._metainfoVersion===s.targetMetaInfoVersion()))}))}l.push(new u),l.sort((function(t,e){return t.targetMetaInfoVersion()-e.targetMetaInfoVersion()}))},767405:(t,e,i)=>{i.d(e,{ChartColorDependentStudyInputNames:()=>r,InputDisplayFlags:()=>n,RangeDependentStudyInputNames:()=>s,areStudyInputsEqual:()=>p,editableStudyInputs:()=>y,getInputValue:()=>l,isExtendedInput:()=>a,isExtendedInputBool:()=>v,isExtendedInputSource:()=>u,isStudyInputDependsOnChart:()=>g,isStudyInputDependsOnChartColors:()=>h,isStudyInputOptionsInfo:()=>d,isTimeOrPriceNotHiddenInput:()=>f,rangeDependentStudyInputsToTimeRange:()=>c});var n,s,r,o=i(182433);function a(t){return(0,o.default)(t)}function u(t){return"source"===t.t}function l(t){return a(t)?t.v:t}function d(t){return["text","integer","float","price","session","resolution"].includes(t.type)&&t.hasOwnProperty("options")}function p(t,e,i){for(const n of t)if(e[n.id]!==i[n.id])return!1;return!0}function c(t){return{from:Math.round(t.first_visible_bar_time/1e3),to:Math.round(t.last_visible_bar_time/1e3)}}function f(t){return("time"===t.type||"price"===t.type)&&!0!==t.isHidden}function y(t){const e=t.filter(f);if(0===e.length)return[];const i=new Map,n=[];e.forEach((t=>{const{group:e,inline:s}=t;if(void 0===s)return void n.push(t);const r=s+(e||"");if(i.has(r))i.get(r)?.push(t);else{const e=[t];i.set(r,e),n.push(e)}}));const s=[];for(let t=0;t<n.length;t++){const e=n[t];Array.isArray(e)?2===e.length&&e[0].type!==e[1].type?s.push(e):s.push(...e):s.push(e)}return s}function h(t){return Object.values(r).map((t=>t)).includes(t.id)}function g(t){return!!h(t)||Object.values(s).map((t=>t)).includes(t.id)}function v(t){return(0,o.default)(t)&&"t"in t&&"bool"===t.t&&"v"in t&&"boolean"==typeof t.v}!function(t){t[t.None=0]="None",t[t.DataWindow=2]="DataWindow",t[t.StatusLine=8]="StatusLine",t[t.All=15]="All"}(n||(n={})),function(t){t.FirstBar="first_visible_bar_time",t.LastBar="last_visible_bar_time",t.Realtime="subscribeRealtime"}(s||(s={})),function(t){t.FgColor="__chart_fgcolor",t.BgColor="__chart_bgcolor"}(r||(r={}))},163263:(t,e,i)=>{i.r(e),i.d(e,{StudyMetaInfoRepository:()=>v,emptyPineId:()=>h,isStudyDescriptor:()=>g,studyMetaInfoRepository:()=>S});var n=i(481251),s=i(444372),r=i(650151),o=i(327734),a=i(985324),u=i(914417),l=i(344060),d=i(884934),p=i(401843),c=i(735566),f=i(197188);const y=(0,c.getLogger)("Chart.Studies.StudyMetaInfoRepository",{color:"#606"}),h="";function g(t){return"object"==typeof t&&null!==t&&"type"in t&&("java"===t.type&&"studyId"in t||"pine"===t.type&&"pineId"in t)}class v{constructor(t){this._isReady=!1,this._studyVersioning=null,this._rawStudiesMetaInfo=[],this._rawStudiesMetaInfoDeferredPromise=null,this._javaStudiesMetaInfo=[],this._pineMetaInfoCache=[],this._compileErrors=new WeakMap,this._studiesMigrations=[],this._chartApi=t}async requestMetaInfo(){if(null===this._rawStudiesMetaInfoDeferredPromise){this._rawStudiesMetaInfoDeferredPromise=(0,f.createDeferredPromise)()
;const t=await this._chartApi.requestMetadata(),e=t.params[1].metainfo.slice();{const i=t.params[1].migrations.slice();this._processSiteMetaInfo(e,i)}this._studyVersioning=new l.StudyVersioning(this._javaStudiesMetaInfo,this._studiesMigrations),this._requestFinished(),this._rawStudiesMetaInfoDeferredPromise.resolve(this._rawStudiesMetaInfo)}return this._rawStudiesMetaInfoDeferredPromise.promise}async findById(t){this._isReady||await this.requestMetaInfo();const e=this._findStudyMetaInfo(t);if(null!==e){const t=this._compileErrors.get(e);return t?Promise.reject(t):Promise.resolve(e)}return"pine"===t.type?this._compilePine(t):Promise.reject(`unexpected study id=${t.studyId} with type=${t.type}`)}findByIdSync(t){return this._findStudyMetaInfo(t)}isReady(){return this._isReady}async findAllJavaStudies(){return this._isReady||await this.requestMetaInfo(),this._javaStudiesMetaInfo}studyVersioning(){return(0,r.ensureNotNull)(this._studyVersioning)}getInternalMetaInfoArray(){return this._javaStudiesMetaInfo}addPineMetaInfo(t,e){const i=m(this._pineMetaInfoCache,t);return e&&(!Array.isArray(e)||e.length>0)&&(e=Array.isArray(e)?new p.PineCompileFailErrorImpl({warnings:[],errors:e},t):e,this._compileErrors.set(i,e)),i}async getLatestMetaInfoForPineStudy(t,e){const i=await(0,d.requestUserScripts)();let n;if(i){const s=i.find((e=>e.scriptIdPart===t));if(s){const t=u.Version.parse(e),i=u.Version.parse(s.version);t.isLess(i)&&(n=s.version)}}if(void 0!==n){const e={type:"pine",pineId:t,pineVersion:n};return this.findById(e)}return null}_processMigrations(t){this._studiesMigrations=[];for(let e=0;t&&e<t.length;e++)this._studiesMigrations.push(t[e])}_processSiteMetaInfo(t,e){for(const e of t)l.StudyVersioning.verifyInputsMaxValue(e),I(e);this._rawStudiesMetaInfo=t,this._processMigrations(e);for(const t of this._rawStudiesMetaInfo)m(this._javaStudiesMetaInfo,t);o.StudyMetaInfo.overrideDefaults(this._javaStudiesMetaInfo)}_processLibraryMetaInfo(t){}_requestFinished(){this._isReady=!0}_findStudyMetaInfo(t){return"java"===t.type?((0,r.assert)(0!==this._javaStudiesMetaInfo.length,"Java studies metainfo should be define here"),this._javaStudiesMetaInfo.find((e=>e.id===t.studyId))||null):this._pineMetaInfoCache.find((e=>e.scriptIdPart===t.pineId&&(void 0===t.pineVersion||(0,r.ensureDefined)(e.pine).version===t.pineVersion)))||null}_compilePine(t){y.logNormal(`Compiling ${t.pineId} script`);const e=(0,d.translateScriptAsync2)(t.pineId,t.pineVersion||"last").then((({metaInfo:e,compileErrors:i})=>(y.logNormal(`Compiling ${t.pineId} is successful`),this.addPineMetaInfo((0,r.ensureDefined)(e),i.errors))));return e.catch((e=>{e instanceof p.PineCompileFailErrorImpl&&this.addPineMetaInfo(e.metaInfo,e),y.logNormal(`Compiling ${t.pineId} is failed`)})),e}}function I(t){t.description_localized=s.t(t.description,{context:"study"},i(783477))}function m(t,e){const i=new o.StudyMetaInfo(e).state();(0,a.migrateMetaInfoAndPropState)(i);const n=new o.StudyMetaInfo(i);let s=!0;const r=t.findIndex((t=>t.id===n.id));if(-1===r)t.push(n);else{
const e=t[r],i=void 0!==e.pine?u.Version.parse(e.pine.version):null,o=void 0!==n.pine?u.Version.parse(n.pine.version):null;null===o||null===i||o.isGreaterOrEqual(i)?(e.removeDefaults(),t[r]=n):s=!1}return s&&n.createDefaults(),n}const S=(0,n.default)((()=>new v(window.ChartApiInstance)))},296673:(t,e,i)=>{i.d(e,{applyOverridesToStudy:()=>p,applyOverridesToStudyDefaults:()=>c});var n=i(650151),s=i(140831),r=i(735566);const o={line:s.LineStudyPlotStyle.Line,histogram:s.LineStudyPlotStyle.Histogram,cross:s.LineStudyPlotStyle.Cross,area:s.LineStudyPlotStyle.Area,columns:s.LineStudyPlotStyle.Columns,circles:s.LineStudyPlotStyle.Circles,line_with_breaks:s.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:s.LineStudyPlotStyle.AreaWithBreaks,step_line:s.LineStudyPlotStyle.StepLine,step_line_with_breaks:s.LineStudyPlotStyle.StepLineWithBreaks,step_line_with_diamonds:s.LineStudyPlotStyle.StepLineWithDiamonds},a=(0,r.getLogger)("Chart.Model.StudyPropertiesOverrider");var u,l;function d(t,e,i,n){const s=i.split(".");if(0===s.length||0===s[0].length)return;const r=function(t){const e=t.split(":");return{name:e[0],type:2===e.length?e[1]:null}}(s[0]),o=r.name,d=r.type,p=null!==d,c=!p||"band"===d,f=!p||"area"===d,y=!p||"input"===d,h=!p||"plot"===d?l.getPlotIdByTitle(t,o):null,g=c?l.getBandIndexByName(t,o):null,v=f?l.getFilledAreaIdByTitle(t,o):null,I=y?l.getInputByName(t,o):null,m=e.hasOwnProperty(o);if((null!==h?1:0)+(null!==g?1:0)+(null!==v?1:0)+(null!==I?1:0)+(m?1:0)>1)return void a.logWarn(`Study '${t.description}' has ambiguous identifier '${o}'`);const S=s[1];if(null!==h){if(1===s.length)return void a.logWarn(`Path of sub-property of '${o}' plot for study '${t.description}' must be not empty`);const i=s.slice(1);u.applyPlotProperty(t,e,h,i,n)}else if(null!==I)u.applyInputValue(e,I,n);else if(null!==g){if(void 0===S)return void a.logWarn(`Property name of '${o}' band for study '${t.description}' must be set`);u.applyBandProperty(e,g,S,n)}else if(null!==v){if(void 0===S)return void a.logWarn(`Property name of '${o}' area for study '${t.description}' must be set`);u.applyFilledAreaProperty(e,v,S,n)}else m?u.setRootProperty(e,s,n):a.logWarn(`Study '${t.description}' has no plot or input '${o}'`)}function p(t,e){const i=t.properties(),n=i.state();for(const i in e)e.hasOwnProperty(i)&&d(t.metaInfo(),n,i,e[i]);i.mergeAndFire(n)}function c(t,e,i){for(const n in t){if(!t.hasOwnProperty(n))continue;const s=n.indexOf(".");if(-1===s)continue;const r=n.substring(0,s),o=l.getMetaInfoByDescription(e,r);if(null===o){a.logWarn(`There is no such study ${r}`);continue}const u=i(o);null!==u?d(o,u,n.substring(s+1),t[n]):a.logWarn(`Cannot apply overrides for study ${r}`)}}!function(t){t.applyPlotProperty=function(t,e,i,r,u){if(void 0===e.styles)return void a.logWarn("Study does not have styles");const l=r[0];if("color"===l){const o=function(t,e,i){if(void 0===t.plots)return null;for(const n of t.plots){if(!(0,s.isPaletteColorerPlot)(n)||void 0===e.palettes)continue;const t=e.palettes[n.palette];if(n.target===i&&void 0!==t)return t}return null
}(t,e,i);return void function(t,e,i,s,r){void 0!==t.styles?null===e&&!isNaN(s)&&s>0?a.logWarn(`Study plot does not have color #${s}`):((0===s||isNaN(s))&&((0,n.ensureDefined)(t.styles[i]).color=String(r),s=0),null!==e&&((0,n.ensureDefined)(e.colors?.[s]).color=String(r))):a.logWarn("Study does not have styles")}(e,o,i,r.length>1?parseInt(r[1]):NaN,u)}const d=e.styles[i];if(void 0!==d&&d.hasOwnProperty(l)){if("plottype"===l){const t=o[String(u)];if(void 0===t)return void a.logWarn(`Unsupported plot type for plot: ${u}`);u=t}d[l]=u}else a.logWarn(`Study plot does not have property '${l}'`)},t.applyBandProperty=function(t,e,i,n){if(void 0===t.bands)return void a.logWarn("Study does not have bands");const s=t.bands[e];if(void 0!==s&&s.hasOwnProperty(i)){if("plottype"===i){const t=o[String(n)];if(void 0===t)return void a.logWarn(`Unsupported plot type for band: ${n}`);n=t}s[i]=n}else a.logWarn(`Study band does not have property '${i}'`)},t.applyFilledAreaProperty=function(t,e,i,n){if(void 0===t.filledAreasStyle)return void a.logWarn("Study does not have areas");const s=t.filledAreasStyle[e];void 0!==s&&s.hasOwnProperty(i)?s[i]=n:a.logWarn(`Study area does not have property '${i}'`)},t.applyInputValue=function(t,e,i){void 0!==t.inputs&&t.inputs.hasOwnProperty(e)?t.inputs[e]=i:a.logWarn(`Study does not have input '${e}'`)},t.setRootProperty=function(t,e,i){if(0===e.length)return;let n=t;for(const t of e.slice(0,-1)){if(null==n||!n.hasOwnProperty(t))break;n=n[t]}const s=e[e.length-1];null!=n&&n.hasOwnProperty(s)?n[s]=i:a.logWarn(`Study does not have property ${e.join(".")}`)}}(u||(u={})),function(t){t.getInputByName=function(t,e){if(void 0===t.inputs)return null;e=e.toLowerCase();for(const i of t.inputs)if(i.name.toLowerCase()===e)return i.id;return null},t.getPlotIdByTitle=function(t,e){if(void 0===t.styles)return null;e=e.toLowerCase();for(const i in t.styles){const n=t.styles[i];if((void 0!==n&&void 0!==n.title?n.title:i).toLowerCase()===e)return i}return null},t.getFilledAreaIdByTitle=function(t,e){if(void 0===t.filledAreas)return null;e=e.toLowerCase();for(const i of t.filledAreas)if(i.title.toLowerCase()===e)return i.id;return null},t.getBandIndexByName=function(t,e){if(void 0===t.bands)return null;e=e.toLowerCase();for(let i=0;i<t.bands.length;++i)if(t.bands[i].name.toLowerCase()===e)return i;return null},t.getMetaInfoByDescription=function(t,e){e=e.toLowerCase();for(const i of t)if(i.description.toLowerCase()===e||i.shortDescription.toLowerCase()===e)return i;return null}}(l||(l={}))},507025:(t,e,i)=>{const{clone:n}=i(536794);var s=i(914417).Version,r=i(735566).getLogger("Chart.StudyMigration");function o(t){this._studyId=t,this._maxToVers=s.ZERO,this._maxFromVers=s.ZERO,this._migrs=[]}o.prototype.addMigration=function(t,e,i){var n=s.parse(t),r=s.parse(e);n.isGreater(this._maxFromVers)&&(this._maxFromVers=n),r.isGreater(this._maxToVers)&&(this._maxToVers=r),this._migrs.push({fromVers:n,toVers:r,rules:i})},o.prototype.updateInputs=function(t,e,i){if(!i)return i;for(var s=n(i),o=t;o.isLess(e);){
var a=this._findMigration(o);if(null==a)break;if(r.logNormal("Migrating study inputs from "+a.fromVers+" to "+a.toVers+" version, studyId: "+this._studyId+", migration: "+JSON.stringify(a)+", inputs: "+JSON.stringify(i)),s=this._applyMigration(s,a),!o.isLess(a.toVers))throw new Error("Problems in study migration process... Possible infinite cycle has been detected and stopped.");o=a.toVers}return o>t&&r.logNormal("Study inputs migration is done, studyId: "+this._studyId+", inputs: "+JSON.stringify(s)),s},o.prototype._findMigration=function(t){for(var e=-1,i=this._maxFromVers,n=0;n<this._migrs.length;n++){var s=this._migrs[n];s.fromVers.isLess(t)||s.fromVers.isLessOrEqual(i)&&(i=s.fromVers,e=n)}return e<0?null:this._migrs[e]},o.prototype._applyMigration=function(t,e){for(var i=t,n=0;n<e.rules.length;n++){var s=e.rules[n];i=this._getApplyRuleFun(s.type)(i,s)}return i},o.prototype._getApplyRuleFun=function(t){if("inputRemoved"===t)return o._applyInputRemovedRule;if("inputChangedType"===t)return o._applyInputChangedTypeRule;if("inputChangedMinMax"===t)return o._applyInputChangedMinMaxRule;if("inputChangedOptions"===t)return o._applyInputChangedOptionsRule;throw new Error("Unknown migration rule type: "+t)},o._applyInputRemovedRule=function(t,e){if(!(e.inputId in t))return t;if("removeVal"!==e.action)throw new Error("Unexpected rule.action="+e.action+" in rule.type="+e.type);var i=t[e.inputId];return delete t[e.inputId],r.logNormal("Input "+e.inputId+"="+i+" removed"),t},o._applyInputChangedTypeRule=function(t,e){var i=t[e.inputId];if("resetToDefVal"===e.action)return t[e.inputId]=e.defVal,r.logNormal("Input "+e.inputId+"="+i+" reset to default value "+e.defVal),t;if("convertVal"===e.action){if(null==i)return t;if("float"===e.inputTypeFrom&&"integer"===e.inputType)return t[e.inputId]=Math.round(t[e.inputId]),r.logNormal("Input "+e.inputId+"="+i+" converted to value "+t[e.inputId]),t;if("integer"===e.inputTypeFrom&&"float"===e.inputType)return t;if("text"===e.inputTypeFrom&&"source"===e.inputType)return o._isValidSource(i,e.options)||(t[e.inputId]=e.defVal),t;throw new Error("Cannot convertVal from "+e.inputTypeFrom+" to "+e.inputType)}throw new Error("Unknown action "+e.action+" for rule with type "+e.type)},o._isValidSource=function(t,e){return t.indexOf("$")>=0||e.indexOf(t)>=0},o._applyInputChangedMinMaxRule=function(t,e){if("adjustValIfNeeded"!==e.action)throw new Error("Unknown action "+e.action+" for rule with type "+e.type);var i=t[e.inputId];return i<e.minVal?t[e.inputId]=e.minVal:i>e.maxVal&&(t[e.inputId]=e.maxVal),r.logNormal("Input "+e.inputId+"="+i+" adjusted to value "+t[e.inputId]),t},o._applyInputChangedOptionsRule=function(t,e){if(!(["text"].indexOf(e.inputType)>=0&&"resetToDefValIfNeeded"===e.action))throw new Error("Unexpected rule.inputType="+e.inputType+" in rule.action="+e.action);var i=t[e.inputId];return e.options.indexOf(i)<0&&(t[e.inputId]=e.defVal,r.logNormal("Input "+e.inputId+"="+i+" reset to default value "+e.defVal)),t},t.exports=o},344060:(t,e,i)=>{i.d(e,{StudyVersioning:()=>m})
;var n=i(998034),s=i(650151),r=i(327734),o=i(507025),a=i.n(o),u=i(735566),l=i(914417),d=i(985324),p=i(884934),c=i(444372);var f=i(708246),y=i(971417),h=i(66974),g=i(536794);const v=(0,u.getLogger)("Chart.Study.Versioning"),I=1e12;class m{constructor(t,e){if(this._migrations={},!t)throw new Error("No studies metainfo");if(this._studiesMetainfo=t,!e)throw new Error("No studies migrations");this._studiesMigrations=e;for(let t=0;t<this._studiesMigrations.length;t++){const e=this._studiesMigrations[t],i=e.versFrom,n=e.versTo;for(let t=0;t<e.studyMigrations.length;t++){const s=e.studyMigrations[t],r=s.studyId;if(0===s.rules.length){v.logError("Study Migration should have at least one convertion rule");continue}const o=r in this._migrations?this._migrations[r]:new(a())(r);o.addMigration(i,n,s.rules),this._migrations[r]=o}}this._clientMigrations=[(t,e)=>{if(0===this._studiesMetainfo.length||!t.isTVScript||t.version>=22)return e;const i={};let n=0,s=0,r=e[s];for(;void 0!==r;){const t=e[r.id];r.isFake&&(r.id="in_"+n++),i[s]=r,i[r.id]=t,s++,r=e[s]}return i}]}updateMetaInfoAsync(t,e){const i=r.StudyMetaInfo.versionOf(t);if(t.isTVScript&&!t.pine&&i<43){(0,s.assert)((0,g.isExistent)(t.scriptIdPart),"scriptIdPart is missing, study "+JSON.stringify(t));const i=t.scriptIdPart;return{sync:!1,result:new Promise(((n,s)=>{(0,f.processLegacy)(i,t.TVScriptSourceCode).then((i=>{t.removeDefaults();const s=new r.StudyMetaInfo(i);e&&s.createDefaults();const o=s.state();(0,d.migrateMetaInfoAndPropState)(o),n(new r.StudyMetaInfo(o))})).catch((t=>{s(t)}))}))}}if(t.isTVScript&&t.pine){if((t._serverMetaInfoVersion||i)<54){return{sync:!1,result:(0,p.translateScriptAsync2)(t.scriptIdPart,t.pine.version).then((i=>{t.removeDefaults();const n=new r.StudyMetaInfo(i.metaInfo);e&&n.createDefaults();const s=n.state();return(0,d.migrateMetaInfoAndPropState)(s),new r.StudyMetaInfo(s)}))}}return e&&t.createDefaults(),{sync:!0,result:t}}{let e=null;const i=this._studiesMetainfo;for(let n=0;n<i.length;n++)if(i[n].id===t.id){e=i[n];break}return{sync:!0,result:e?new r.StudyMetaInfo(e.state()):null}}}updateStudyState(t,e,i){if(null==t||null==e||null==i)return t;t=(0,g.clone)(t),this.updateStudyInputsIfNeeded(t,e.version,i);for(const i of this._clientMigrations){const n=i.call(this,e,t.inputs);Object.keys(n).length===Object.keys(t.inputs).length?t.inputs=n:v.logWarn("StudyVersioning._clientMigrations application returned bad result. Skipping it...")}const n=r.StudyMetaInfo.versionOf(e);if(e.isTVScript&&e.TVScriptSourceCode&&n>=12&&n<=26){const n={};for(let t=0;t<e.plots.length;++t){const s=e.plots[t],r=i.plots[t];n[s.id]=r.id}const s=Object.keys(t.styles);for(let e=0;e<s.length;++e){const i=s[e],r=t.styles[i];delete t.styles[i];const o=n[i];t.styles[o]=r}const r=Object.keys(t.plots);for(let e=0;e<r.length;++e){const i=r[e],s=t.plots[i].id;t.plots[i].id=n[s]}}return t}updateStudyInputsIfNeeded(t,e,i){if(!(i.isTVScript||!!i.pine)&&e!==i.version){const n=i&&i.defaults.inputs;t.inputs=this.updateStudyInputs(i.id,e,i.version,t.inputs,n)}}updateStudyInputs(t,e,i,n,s){
let r=(0,g.clone)(n);if(t in this._migrations){const n=l.Version.parse(e);let s;if("last"===i){const e=this.lastVersionOfStudy(t);s=l.Version.parse(e)}else s=l.Version.parse(i);r=this._migrations[t].updateInputs(n,s,r)}if(null==s)return r;for(const t in s)t in r||(r[t]=s[t]);for(const i in r)if(!(i in s)){const n=r[i];v.logWarn(`Extra input detected, studyId='${t}', versionFrom='${e}', inputId='${i}', inputValue='${n}', removing it and continue...`),delete r[i]}return r}lastVersionOfStudy(t){return(0,s.ensureDefined)(this._studiesMetainfo.find((e=>e.id===t))).version}updateMetaInfo(t){if(!t)return t;(0,s.assert)(t instanceof r.StudyMetaInfo),(0,s.assert)(!t.isTVScript,"This method should update only built-in java indicators metaInfo. For Pine indicators use updateMetaInfoAsync");const e=this._studiesMetainfo.find((e=>t.id===e.id));return e?new r.StudyMetaInfo(e.state()):null}static patchPointsBasedStudyState(t){return this._fixInputsMaxValue(t.state,t.metaInfo),"LineToolRegressionTrend"===t.type&&(t=function(t){const e={palettes:{},inputs:[{defval:2,id:"upper diviation",max:500,min:-500,name:c.t(null,void 0,i(591900)),type:"integer"},{defval:-2,id:"lower diviation",max:500,min:-500,name:c.t(null,void 0,i(831736)),type:"integer"},{defval:!0,id:"use upper diviation",name:c.t(null,void 0,i(784451)),type:"bool"},{defval:!0,id:"use lower diviation",name:c.t(null,void 0,i(449299)),type:"bool"},{defval:0,id:"first bar time",max:253370764800,min:0,name:c.t(null,void 0,i(780509)),type:"time"},{defval:0,id:"last bar time",max:253370764800,min:0,name:c.t(null,void 0,i(59933)),type:"time"},{defval:"close",id:"source",name:c.t(null,void 0,i(997751)),options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"}],plots:[],graphics:{},defaults:{inputs:{"first bar time":0,"last bar time":0,"lower diviation":-2,source:"close","upper diviation":2,"use lower diviation":!0,"use upper diviation":!0}},_metainfoVersion:6,description:"Regression Trend",id:"RegressionTrend@tv-basicstudies",is_price_study:!0,shortDescription:"Reg Trend",shortId:"RegressionTrend",version:"2",fullId:"RegressionTrend@tv-basicstudies-2",name:"RegressionTrend@tv-basicstudies"};return t.metaInfo||(t.metaInfo=e),t}(t)),t}static patchStudyData(t,e,i,n){if(!(0,h.isProd)())return{data:e,nsData:i,indexes:n??void 0};const s=(0,g.clone)(e),o=(0,g.clone)(i),a=(0,g.clone)(n);"VbPVisible@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,s?.graphics),"VbPSessions@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,s?.graphics);const u=r.StudyMetaInfo.versionOf(t);if(s&&t.isTVScript&&t.TVScriptSourceCode&&u>=12&&u<=26){const t=s.columns,e=[];s.columns=e;for(let i=0;i<t.length;++i){const t="plot_"+i;e.push(t)}}return{data:s,nsData:o,indexes:a??void 0}}static patchPointsBasedStudyData(t,e){if(!(0,h.isProd)())return e;if(!t||!e)return e;const i=(0,g.clone)(e);return"VbPFixed@tv-volumebyprice"===t.id&&t.version&&+t.version<=4&&this._patchOldVolumeProfiles(0,i),i}static patchPropsStateAndMetaInfo(t,e,i){
let s=e.state();"Script$BOOKER"!==e.productId||s.alerts||delete t.alerts,this._fixInputsOrder(t,s),this._fixInputsMaxValue(t,s);const o=this.splitInputs(t.inputs);t.inputs=o.obj;const a=r.StudyMetaInfo.versionOf(e);a<42&&s.isChildStudy&&(t.isChildStudy=s.isChildStudy);if(e.isTVScript&&e.version<60&&("Script$TV_EARNINGS@tv-scripting"!==e.id&&"Script$TV_DIVIDENDS@tv-scripting"!==e.id&&"Script$TV_SPLITS@tv-scripting"!==e.id||delete s.TVScriptSourceCode),"Volume"!==e.id&&"Volume@tv-basicstudies"!==e.id||0!==e.inputs.length||(s.inputs=[{id:"length",type:"integer",defval:20,min:1,max:1e3}],s.plots.push({id:"vol_ma",type:"line"})),"Volume@tv-basicstudies"===e.id&&e.version&&e.version<=46&&void 0===t.styles.vol.transparency&&(t.styles.vol.transparency=t.transparency||87),"PivotPointsStandard@tv-basicstudies"===e.id&&(0===s.inputs.length?(t.inputs={kind:"Traditional",showHistoricalPivots:!0},s.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]):1===s.inputs.length&&(t.inputs={kind:"Traditional"},s.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]),void 0===t._hardCodedDefaultsVersion)){t._hardCodedDefaultsVersion=1;const e=t.color;delete t.color,t.levelsStyle={colors:{P:e,"S1/R1":e,"S2/R2":e,"S3/R3":e,"S4/R4":e,"S5/R5":e}}}"CMF"===e.shortId&&2===s.inputs.length&&(t.inputs={length:t.inputs["length fast"]},s.inputs=s.inputs.splice(0,1),s.inputs[0].id="length"),s.defaults&&void 0===s.defaults.precision&&a<46&&(-1!==["Volume@tv-basicstudies","VbPVisible@tv-volumebyprice","VbPSessions@tv-volumebyprice"].indexOf(e.id)?s.defaults.precision=0:s.defaults.precision=4);let u=e.id;if(e.version<60){const t=["TV_DIVIDENDS","TV_SPLITS","TV_EARNINGS"],i=6;for(let n=0;n<t.length;n++)e.id.startsWith("Script$"+t[n]+"@tv-scripting")&&(s.fullId="ESD"+s.fullId.substring(i),s.id="ESD"+s.id.substring(i),s.name&&(s.name="ESD"+s.name.substring(i)),s.shortId="ESD"+s.shortId.substring(i),s.productId="ESD"+s.productId.substring(i),u="ESD"+e.id.substring(i))}const l={"ESD$TV_EARNINGS@tv-scripting":{fullId:"Earnings@tv-basicstudies-129!",id:"Earnings@tv-basicstudies",name:"Earnings@tv-basicstudies",shortId:"Earnings",productId:"tv-basicstudies"},"ESD$TV_SPLITS@tv-scripting":{fullId:"Splits@tv-basicstudies-129!",id:"Splits@tv-basicstudies",name:"Splits@tv-basicstudies",shortId:"Splits",productId:"tv-basicstudies"},"ESD$TV_DIVIDENDS@tv-scripting":{fullId:"Dividends@tv-basicstudies-129!",id:"Dividends@tv-basicstudies",name:"Dividends@tv-basicstudies",shortId:"Dividends",productId:"tv-basicstudies"}};if(u in l&&Object.assign(s,l[u]),a<43){const i={"StrategyScript$STD;Consecutive%1Ups/Downs%1Strategy":{pineId:"STD;Consecutive%1Ups%1Downs%1Strategy",className:"StrategyScript"},Script$EDGR_NET_INCOME_FROM_CONTINUING_OPERATIONS_APPLICABLE_TO_COMMON_V2:{
pineId:"Script$EDGR_NET_INCOME_FROM_CONTINUING_OPS_APPLICABLE_TO_COMMON_V2",className:"Script"}};if(e.shortId in i){const r=i[e.shortId].className+"$"+i[e.shortId].pineId,o={scriptIdPart:i[e.shortId].pineId,fullId:s.fullId.replace(s.shortId,r),id:s.id.replace(s.shortId,r),name:s.name?.replace(s.shortId,r),shortId:r};(0,n.default)(s,o),(0,n.default)(t,o)}const r=(0,y.extractPineId)(e.fullId),o=r&&r.match(/^(USER)(_\d+)(;)(.*)$/);if(o){const e=o[0],i=o[1]+o[3]+o[2]+o[4],r={scriptIdPart:i,fullId:s.fullId.replace(e,i),id:s.id.replace(e,i),name:s.name?.replace(e,i),shortId:s.shortId.replace(e,i)};(0,n.default)(s,r),(0,n.default)(t,r)}}if("MA"===e.id){const e={id:"MAExp",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgExp",type:"line"}],palettes:{}},i={id:"MASimple",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgSimple",type:"line"}],palettes:{}},n={id:"MAVolumeWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgVolumeWeighted",type:"line"}],palettes:{}},r={id:"MAWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgWeighted",type:"line"}],palettes:{}};switch(t.inputs.type){case"exp":s=e;break;case"simple":s=i;break;case"weighted":s=r;break;case"volume weighted":s=n}t.styles[s.plots[0].id]=t.styles.MovAvg,delete t.styles.MovAvg,delete t.inputs.type}return i.oldShowStudyLastValueProperty&&(t.oldShowLastValue=t.showLastValue),delete t.showLastValue,delete t.showStudyArguments,(0,d.migrateMetaInfoAndPropState)(s,t),{propsState:t,metaInfo:s}}static splitInputs(t){const e={},i={};for(const[n,s]of Object.entries(t))(0,g.isNumber)(parseInt(n,10))?e[n]=s:i[n]=s;return{arr:e,obj:i}}static verifyInputsMaxValue(t){if(t.inputs)for(const e of t.inputs)"integer"===e.type&&e.max&&e.max>I&&v.logWarn("Bad integer input max value in metaInfo id="+t.id+" title="+t.description)}static mergeInputsObjPart(t,e){const i=this.splitInputs(e);(0,n.default)(t,i.obj)}static _fixInputsOrder(t,e){const i=this._getOrderedInputIds(e),s=this.splitInputs(t.inputs),r=s.arr,o=s.obj,a=(0,n.default)({},o);for(let t=0;t<i.length;++t){const e=i[t],n=this._findInputKeyById(r,e);null!==n&&(a[t]=r[n])}t.inputs=a}static _fixInputsMaxValue(t,e){if((0,g.isAbsent)(e))return;const i=I;if(e.inputs)for(const t of e.inputs)"integer"===t.type&&t.max&&t.max>i&&(t.max=i);if(!t||!t.inputs)return;const s=this.splitInputs(t.inputs),r=s.arr
;for(const[,t]of Object.entries(r))"integer"===t.type&&t.max&&t.max>i&&(t.max=i);t.inputs=(0,n.default)(s.obj,s.arr)}static _findInputKeyById(t,e){let i=null;for(const n in t)if((0,g.isNumber)(parseInt(n,10))&&t[n].id===e){i=n;break}return i}static _getOrderedInputIds(t){const e=[];for(const i of t.inputs)e.push(i.id);return e}static _patchOldVolumeProfiles(t,e){if(!e?.hhists)return;const i=e.hhists[t].data,n=[];for(const[,t]of Object.entries(i))n.push(t);e.hhists[0].data=n}}},327734:(t,e,i)=>{i.r(e),i.d(e,{StudyMetaInfo:()=>w,getStudyIdWithVersion:()=>b,replayStrategyStudyId:()=>P});var n=i(283873),s=i(154834),r=i(650151),o=i(536794),a=i(735566),u=i(290222),l=i(140831),d=i(767405),p=i(453287),c=i(296673),f=i(707681),y=i(750397);const h=(0,a.getLogger)("Chart.Study.MetaInfo"),g=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),v=new Set([]),I=new Set(["line","shapes","chars","arrows","alertcondition"]),m=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"],["VbPAnchored@tv-basicstudies","linetoolanchoredvp"]]),S=/^([^\$]+)\$\d+$/,_=["bool","color","time","text_area"];function b(t){return w.cutDollarHash(t.id)+"-"+t.version}const P="ReplayStrategy@tv-scripting",M=["useVersionFromMetaInfo","_forceOverlayPlotIds"];class w{constructor(t,e=!1){this._forceOverlayPlotIds=new Set,(0,o.merge)(this,{palettes:{},inputs:[],plots:[],graphics:{},defaults:{}}),(0,o.merge)(this,t);const i=t.fullId||t.id;(0,o.merge)(this,w.parseIdString(i)),this._updateInputDisplayDefaults(),this.useVersionFromMetaInfo=e,this.plots.forEach((t=>{const e=t.id,i=this.styles?.[e];let n=!!i?.forceOverlay;!n&&(0,l.isOhlcPlot)(t)&&(n=this.ohlcPlots?.[t.target]?.forceOverlay??!1,n&&this._forceOverlayPlotIds.add(t.target)),n&&this._forceOverlayPlotIds.add(e)}))}defaultInputs(){return this.inputs.map((t=>t.defval)).filter(o.isExistent)}state(){const t={};for(const[e,i]of Object.entries(this))M.includes(e)||this.hasOwnProperty(e)&&(t[e]=(0,s.default)(i),"id"===e&&(t[e]+="-"+this.version));return t}symbolInputId(){return this.inputs.find((t=>"symbol"===t.type))?.id||null}inputById(t){return(0,r.ensureDefined)(this.inputs.find((e=>e.id===t)))}createDefaults(){if(this.defaults){const t=(0,o.clone)(this.defaults);t.precision="default";const e=w.getStudyPropertyRootName(this);(0,p.createDefaults)(e,t)}}removeDefaults(){(0,p.removeDefaults)(w.getStudyPropertyRootName(this))}isPlotForceOverlay(t){return this._forceOverlayPlotIds.has(t)}hasForceOverlayPlots(){return 0!==this._forceOverlayPlotIds.size}static getSourceIdsByInputs(t,e){if(!Array.isArray(t)||!e)return[];const i=[];for(const s of t)if(w.isSourceInput(s)&&(0,n.default)(e[s.id])){const t=e[s.id];t.includes("$")&&i.push(t.split("$")[0])}return i}static isSourceInput(t){return Boolean(t.id&&(("source"===t.id||"src"===t.id)&&("text"===t.type||"source"===t.type)||"source"===t.type))}static getSourceInputIds(t){const e=[];for(const i of t.inputs)w.isSourceInput(i)&&e.push(i.id);return e}
static setChildStudyMetaInfoPropertiesSourceId(t,e,i){for(const n of t.inputs){if(!w.isSourceInput(n))continue;const t=i.childs().inputs&&i.childs().inputs.childs()[n.id];if(t){const i=t.value(),n=S.exec(i);if(2===n?.length){if("{pid}"===n[1]){const n=i.replace(/^[^\$]+/,e);t.setValue(n)}}}}}static canBeChild(t){if((0,n.default)(t))return!0;if(!t)return!1;if(t.extra&&!w.isAllowedSourceInputsCount(t.extra.sourceInputsCount)||!0===t.canNotBeChild||!1===t.canBeChild||g.has(t.id))return!1;let e=0;for(const i of t.inputs)w.isSourceInput(i)&&(e+=1);return w.isAllowedSourceInputsCount(e)}static isAllowedSourceInputsCount(t){return t>0||1===t}static canHaveChildren(t){if(t){if(t.isTVScriptStrategy||t.TVScriptSourceCode&&(0,y.isStrategy)(t.TVScriptSourceCode))return!1;if(t.id&&!v.has(t.id)&&Array.isArray(t.plots))for(const e of t.plots)if(I.has(e.type))return!0}return!1}static getChildSourceInputTitles(t,e,i){const n={};if(e.plots&&e.plots.length&&t.options&&t.options.length)for(const s of t.options){const t=s?+s.split("$")[1]:NaN,r=isFinite(t)&&e.plots[t];r&&I.has(r.type)&&(n[s]=e.styles&&e.styles[r.id]&&e.styles[r.id]?.title||r.id,i&&(n[s]=i+":â€‰"+n[s]))}return n}static canPlotBeSourceOfChildStudy(t){return I.has(t)}static getStudyPropertyRootName(t){const e=m.get(t.id);if(void 0!==e)return e;let i="study_"+t.id;return t.pine&&t.pine.version&&(i+="_"+t.pine.version.replace(".","_")),i}static getStudyPropertyRootNameById(t){const e=m.get(t);return void 0!==e?e:"study_"+t}static isScriptStrategy(t){if(t.extra&&t.extra.kind)return"strategy"===t.extra.kind;if(!0===t.isTVScriptStrategy)return!0;const e=t.TVScriptSourceCode||t.scriptSource;return!!e&&(0,y.isStrategy)(e)}static isReplayStrategy(t){return t.id===P}static parseIdString(t){return(0,f.parseIdString)(t)}static versionOf(t){const e="_metainfoVersion"in t&&(0,o.isNumber)(t._metainfoVersion)?t._metainfoVersion:0;return e<0&&h.logError("Metainfo format version cannot be negative: "+e),e}static getPackageName(t){const e=/^[^@]+@([^-]+-[^-]+)/.exec(t||"");e?.[1]||(0,u.getPersistentLogger)()?.addPersistentLogEntry(`getStudyPackageName: study id ${t} with stack ${(new Error).stack}`,a.LOGLEVEL.INFO,"chart.StudyMetaInfo");const[,i="tv-basicstudies"]=e||[];return i}static cutDollarHash(t){const e=t.indexOf("$");if(-1===e)return t;const i=t.indexOf("@"),n=i>=0?t.substring(i):"";return t.substring(0,e)+n}static hasPubSuffix(t){return/^PUB;.+$/.test(t)}static hasStdSuffix(t){return/^STD;.+$/.test(t)}static isStandardPine(t){return/^(Strategy)?Script\$STD;.*@tv-scripting$/.test(t)}static getStudyIdWithLatestVersion(t,e){const i=w.cutDollarHash(t.id);let n=i;return i.indexOf("Portfolio@tv-scripting")>=0?n+=e?"!":"":"ReplayStrategy@tv-scripting"===n?n+="-581!":i.indexOf("@tv-scripting")>=0?n+="-101!":i.endsWith("CP@tv-basicstudies")?n+="-"+Math.min(t.version,207):i.endsWith("CP@tv-chartpatterns")?n+="-"+Math.min(t.version,9):i.endsWith("@tv-volumebyprice")||e?n+="-"+t.version+"!":n+="-"+t.version,n}static overrideDefaults(t){0!==t.length&&(0,
c.applyOverridesToStudyDefaults)(this.savedStudiesOverrides,t,(t=>window.TradingView.defaultProperties[w.getStudyPropertyRootName(t)]||null))}static mergeDefaultsOverrides(t){(0,o.merge)(this.savedStudiesOverrides,t)}static findStudyMetaInfoByDescription(t,e){if(t){const i=e.toLowerCase();for(const e of t)if(e.description.toLowerCase()===i)return e;throw new Error("unexpected study id:"+e)}throw new Error("There is no studies metainfo")}_updateInputDisplayDefaults(){this.inputs.filter((t=>void 0===t.display)).forEach((t=>{_.includes(t.type)?t.display=d.InputDisplayFlags.None:t.display=d.InputDisplayFlags.All}))}}w.savedStudiesOverrides={},window.TradingView.StudyMetaInfo=w},650369:(t,e,i)=>{i.r(e),i.d(e,{alphaToTransparency:()=>o,applyAlpha:()=>r,applyTransparency:()=>u,colorFromBackground:()=>c,colorToInteger:()=>g,generateColor:()=>s,getLuminance:()=>d,gradientColorAtPercent:()=>f,isHexColor:()=>p,resetTransparency:()=>l,rgbaFromInteger:()=>y,rgbaToInteger:()=>h,transparencyToAlpha:()=>a});var n=i(724377);function s(t,e,i){if(e=e||0,!p(t))return i?(0,n.rgbaToString)((0,n.rgba)((0,n.parseRgb)(t),(0,n.normalizeAlphaComponent)(a(e)))):t;const[s,r,o]=(0,n.parseRgb)(t),u=(0,n.normalizeAlphaComponent)(a(e));return(0,n.rgbaToString)([s,r,o,u])}function r(t,e,i){const s=(0,n.tryParseRgba)(t);if(null===s)throw new Error(`Invalid color: ${t}`);const[r,o,a,u]=s,l=(0,n.normalizeAlphaComponent)(e*(i?u:1));return(0,n.rgbaToString)((0,n.rgba)([r,o,a],l))}function o(t){return 100*(1-t)}function a(t){if(t<0||t>100)throw new Error("invalid transparency");return 1-t/100}function u(t,e){if("transparent"===t)return t;const i=(0,n.parseRgba)(t),s=i[3];return(0,n.rgbaToString)((0,n.rgba)(i[0],i[1],i[2],a(e)*s))}function l(t){return"transparent"===t?t:p(t)?t.slice(0,7):(0,n.rgbaToString)((0,n.rgba)((0,n.parseRgb)(t),(0,n.normalizeAlphaComponent)(1)))}function d(t){const e=(0,n.parseRgb)(t).map((t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)));return Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function p(t){return 0===t.indexOf("#")}function c(t){return"black"===(0,n.rgbToBlackWhiteString)((0,n.parseRgb)(t),150)?"#ffffff":"#000000"}function f(t,e,i){const[s,r,o,a]=(0,n.parseRgba)(t),[u,l,d,p]=(0,n.parseRgba)(e),c=(0,n.rgba)(Math.round(s+i*(u-s)),Math.round(r+i*(l-r)),Math.round(o+i*(d-o)),a+i*(p-a));return(0,n.rgbaToString)(c)}function y(t){const e=(t=Math.round(t))%256;t-=e;const i=(t/=256)%256;t-=i;const n=(t/=256)%256;t-=n;return`rgba(${e},${i},${n},${(t/=256)/255})`}function h(t){const e=Math.round(255*t[3]);return t[0]+256*t[1]+65536*t[2]+16777216*e}function g(t){const e=(0,n.tryParseRgba)(t);return null===e?0:h(e)}}}]);