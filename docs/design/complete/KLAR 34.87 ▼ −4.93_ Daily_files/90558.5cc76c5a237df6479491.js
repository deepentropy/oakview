(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[90558,9726,43382,48094],{642260:e=>{e.exports={}},360433:e=>{e.exports={rootContainer:"rootContainer-fxQkGV8J"}},66234:e=>{e.exports={container:"container-B8mkOfAH",inner:"inner-B8mkOfAH","border-left":"border-left-B8mkOfAH","border-right":"border-right-B8mkOfAH","border-top":"border-top-B8mkOfAH","border-bottom":"border-bottom-B8mkOfAH","top-right-radius":"top-right-radius-B8mkOfAH","top-left-radius":"top-left-radius-B8mkOfAH","bottom-right-radius":"bottom-right-radius-B8mkOfAH","bottom-left-radius":"bottom-left-radius-B8mkOfAH"}},782618:(e,t,i)=>{"use strict";i.d(t,{setupChartEventHint:()=>u});var r=i(650151),n=i(444372),s=i(62802),o=i(313344),a=i(772717),l=i(638456),c=i(470316),d=i(687037);const h=["LineToolTrendLine","LineToolRay","LineToolInfoLine","LineToolExtended","LineToolRegressionTrend","LineToolRotatedRectangle","LineToolParallelChannel","LineToolFlatBottom","LineToolDisjointAngle","LineToolPitchfork","LineToolSchiffPitchfork","LineToolSchiffPitchfork2","LineToolInsidePitchfork","LineToolVertLine","LineToolCrossLine","LineToolHorzLine","LineToolHorzRay","LineToolTrendAngle"];function u(e,t=!1,u=!1){if(!d.enabled("popup_hints"))return()=>{};const g=e.getContainer();let _=null,p=null,m=null;return o.tool.subscribe(v),o.createdLineTool.subscribe(null,S),o.finishedLineTool.subscribe(null,f),e.layoutSizesChanged().subscribe(y),t||l.CheckMobile.any()||!w("hint.startFocusedZoom")||(m=function(e,t){let i=!1;const r=n=>{n?(i&&t(n),e.onZoom().unsubscribe(null,r)):i||(t(n),i=!0)};return e.onZoom().subscribe(null,r),()=>e.onZoom().unsubscribe(null,r)}(e,(function(e){if(!w("hint.startFocusedZoom"))return;if(e)p&&(m=null,C("hint.startFocusedZoom"));else{b(n.t(null,void 0,i(681712)).format({key:(0,c.humanReadableModifiers)(c.Modifiers.Mod,!1)}),"hint.startFocusedZoom")}}))),()=>{o.tool.unsubscribe(v),o.createdLineTool.unsubscribe(null,S),o.finishedLineTool.unsubscribe(null,f),e.layoutSizesChanged().unsubscribe(y),m?.()};function v(){const t=o.tool.value(),r=l.CheckMobile.any();if(_?.hide(),!r&&(0,o.toolIsDemonstration)(t)&&w("hint.demonstrationCursorSelected")){return void b(n.t(null,void 0,i(187133)).format({key:(0,c.humanReadableModifiers)(c.Modifiers.Alt,!1)}),"hint.demonstrationCursorSelected")}if(u&&r&&(s=t,h.includes(s)))return void async function(t){{const r=()=>(0,o.resetToCursor)(!0);if(_)_.show(t,r);else{const{DrawingHintsRenderer:n}=await Promise.all([i.e(71731),i.e(78335),i.e(91953),i.e(32227),i.e(35858)]).then(i.bind(i,953745));_=new n(e),t===o.tool.value()&&_.show(t,r)}}}(t);var s;if("LineToolTextAbsolute"===t&&w("hint.anchoredTextWillBeRemoved"))return void b(n.t(null,void 0,i(277705)),"hint.anchoredTextWillBeRemoved");if(!w("hint.touchPainting"))return;const d=(0,a.isLineToolDrawWithoutPoints)(t);!(0,a.isStudyLineToolName)(t)||"LineToolRegressionTrend"===t||d||r?(0,a.isLineToolName)(t)&&!(0,
a.isLineDrawnWithPressedButton)(t)&&!d&&r?b(n.t(null,void 0,i(360663)),"hint.touchPainting"):p&&p.hide():b(n.t(null,void 0,i(414985)),"hint.touchPainting")}function S(){const e=o.tool.value();"LineToolPath"===e&&w("hint.finishBuildPathByDblClick")?b(n.t(null,void 0,i(275296)),"hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&w("hint.finishBuildPolylineByDblClick")&&b(n.t(null,void 0,i(317409)),"hint.finishBuildPolylineByDblClick")}function f(){if(p){const e=o.tool.value();"LineToolPath"===e?C("hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&C("hint.finishBuildPolylineByDblClick")}}function y(){if(!w("hint.startResizingChartInLayout"))return;b(l.CheckMobile.any()?n.t(null,void 0,i(436539)):n.t(null,void 0,i(9430)),"hint.startResizingChartInLayout")}function b(e,t){if(p)p.show(e,C.bind(null,t));else{const r=o.tool.value();Promise.all([i.e(86280),i.e(75923),i.e(32227),i.e(26166)]).then(i.bind(i,410837)).then((i=>{p=new i.ChartEventHintRenderer(g),r===o.tool.value()&&p.show(e,C.bind(null,t))}))}}function w(e){return!Boolean(s.getBool(e))}function C(e){s.setValue(e,!0,{forceFlush:!0}),(0,r.ensureNotNull)(p).destroy(),null!==m&&m(),p=null}}},732433:(e,t,i)=>{"use strict";i.d(t,{SYMBOL_TYPE_BLACK_LIST:()=>r});const r=new Set(["spread","economic"])},229534:(e,t,i)=>{"use strict";async function r(e){return(await Promise.all([i.e(66814),i.e(53054),i.e(34489),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(17066),i.e(63745),i.e(89410),i.e(84434),i.e(25977),i.e(26614),i.e(2224),i.e(37757)]).then(i.bind(i,173403))).createDialog(e)}function n(e){r(e).then((e=>e.open()))}i.d(t,{createErrorDialog:()=>r,showErrorDialog:()=>n})},969919:(e,t,i)=>{"use strict";i.d(t,{ChartAreaResizer:()=>d});var r=i(77294),n=i(581996),s=i(484443),o=i(687037),a=i(772383);const l=o.enabled("no_min_chart_width"),c=o.enabled("bypass_chart_height_check");class d{constructor(e){this._processVisibility=e=>{const t=e.container.value();return this.affectsLayout(e.name)?(t&&t.classList.toggle("js-hidden",!1),!0):(t&&t.classList.toggle("js-hidden",!0),!1)},this._setWidth=(e,t,i)=>{let r=i;this._fullscreenArea!==e.name&&(e.availWidth.setValue(i),e.canNegotiate.width&&(r=(0,s.determineSize)(i,e.negotiations.width))),t||(r=0);const n=e.container.value();return n&&t&&(n.style.width=r+"px"),e.width.setValue(r),r},this._setHeight=(e,t,i)=>{let r=i;this._fullscreenArea!==e.name&&(e.availHeight.setValue(i),e.canNegotiate.height&&(r=(0,s.determineSize)(i,e.negotiations.height))),t||(r=0);const n=e.container.value();return n&&t&&(n.style.height=r+"px"),e.height.setValue(r),r};const t=e.container.value();if(!t)throw new Error("bridge.container.value() must be an element");this._container=t,this._availableAreas=["left","tradingpanel","right","top","bottom","center","topleft","extratop"],this._areas={},this._bridge=e,this._width=e.width,this._height=e.height,this._width.subscribe((()=>this.recalculate())),this._height.subscribe((()=>this.recalculate())),this._bridge.visible.subscribe((()=>this._updateVisibility())),
this._bridge.fullscreen.subscribe((()=>this._onParentFullscreenChange())),this.recalculate()}allocate(e){const t=e&&e.areaName;if(-1===this._availableAreas.indexOf(t))throw new Error("unknown options.areaName");this.free(t);const i=this._createDOM(t),o={name:t,canNegotiate:{width:"left"===t||"right"===t||"tradingpanel"===t||"topleft"===t,height:"top"===t||"bottom"===t||"topleft"===t||"extratop"===t},negotiations:{width:[],height:[]},remove:()=>{for(const e in this._areas)this._areas[e]===o&&this.free(e)},negotiateWidth:e=>{if(!o.canNegotiate.width)return;const t=(0,s.processNegotiation)(e);(0,s.negotiationsAreEqual)(o.negotiations.width,t)||(o.negotiations.width=t,this.recalculate())},negotiateHeight:e=>{if(!o.canNegotiate.height)return;const t=(0,s.processNegotiation)(e);(0,s.negotiationsAreEqual)(o.negotiations.height,t)||(o.negotiations.height=t,this.recalculate())},requestFullscreen:()=>{this._fullscreenArea||("right"!==t&&"center"!==t||(this._fullscreenArea=t),"center"===t&&this._bridge.requestFullscreen(),this._updateFullscreen())},exitFullscreen:()=>{t===this._fullscreenArea&&(this._fullscreenArea=void 0,"center"===t&&this._bridge.exitFullscreen(),this._updateFullscreen())},width:new r.WatchedValue,height:new r.WatchedValue,availWidth:new r.WatchedValue,availHeight:new r.WatchedValue,alive:new r.WatchedValue(!0),container:new r.WatchedValue(i),visible:new r.WatchedValue(!0),fullscreen:new r.WatchedValue(!1),fullscreenable:new r.WatchedValue("right"===t||"center"===t),rdState:new n.ResizerDetacherState};return o.rdState.pushOwner(o),this._areas[t]=o,o.rdState.owner.subscribe((e=>{const i=o.container.value();if(e!==o)i&&(i.innerHTML="",i.parentElement&&i.parentElement.removeChild(i));else{let e=null;for(let i=this._availableAreas.indexOf(t);i--;){const t=this._availableAreas[i];if(this.affectsLayout(t)){e=this._areas[t].container.value();break}}i&&(e&&i.parentElement?i.insertAdjacentElement("afterend",e):this._container.appendChild(i))}this.recalculate()}),{callWithLast:!0}),o.rdState.bridge()}free(e){const t=this._areas[e];if(!t)return;this._areas[e]=void 0;const i=t.container.value();i&&i.parentElement&&i.parentElement.removeChild(i),t.alive.setValue(!1)}recalculate(){const e={};this._recalcSingleRunToken=e;const t=this._areas.topleft,i=this._areas.left,r=this._areas.tradingpanel,n=this._areas.right,s=this._areas.top,o=this._areas.bottom,c=this._areas.center,d=this._areas.extratop,h=this._width.value(),u=this._height.value();let g=0,_=0,p=0,m=0,v=0,S=0,f=0,y=0;if(e===this._recalcSingleRunToken&&d){const e=this._processVisibility(d);y=this._setHeight(d,e,u),this._setWidth(d,e,h)}if(e===this._recalcSingleRunToken&&t){const e=this._processVisibility(t);f=this._setHeight(t,e,u),S=this._setWidth(t,e,h);const i=t.container.value();e&&i&&(i.style.top=y+"px")}let b=0;if(e===this._recalcSingleRunToken&&s){const e=this._processVisibility(s),t=s.container.value();e&&t&&(t.style.left=S+"px",t.style.top=y+"px");const i=h-S;this._setWidth(s,e,i),g=this._setHeight(s,e,u),g&&(b=1)}if(e===this._recalcSingleRunToken&&i){
const e=this._processVisibility(i),t=Math.max(f,g);p=this._setWidth(i,e,h),p&&(p+=4),p&&1===b&&(b=4);const r=i.container.value();e&&r&&(r.style.top=t+y+b+"px"),this._setHeight(i,e,u-t-y)}if(e===this._recalcSingleRunToken&&r){const e=this._processVisibility(r);let t=h-p;l||(t-=300),v=this._setWidth(r,e,t),v&&1===b&&(b=4),this._setHeight(r,e,u-y-g-b)}if(e===this._recalcSingleRunToken&&n){const e=this._processVisibility(n);let t=h-p-v;l||(t-=300),m=this._setWidth(n,e,t),m&&1===b&&(b=4),this._setHeight(n,e,u-y-g-b);const i=n.container.value();e&&i&&(i.style.top=g+y+b+"px")}const w=v+m;let C=0,T=h-p-v-m-(w?4:0);const P=Boolean(v||!w);if(!m&&v&&(T+=4),e===this._recalcSingleRunToken&&o){const e=this._processVisibility(o),t=o.container.value();e&&t&&(t.style.left=p+"px",t.classList.toggle("no-border-top-left-radius",!p),t.classList.toggle("no-border-top-right-radius",P)),this._setWidth(o,e,T);const i=u-y;C=Math.min(300,i-0),_=this._setHeight(o,e,i)+4}const A=Boolean(g&&(p||w));if(this._container.classList.toggle("layout-with-border-radius",A),a.setNewBlackColor&&this._container.classList.toggle("black-border-bigger-radius",!0),e===this._recalcSingleRunToken&&c){const e=this._processVisibility(c),t=c.container.value();e&&t&&(t.style.left=p+"px",t.style.top=g+y+b+"px",t.classList.toggle("no-border-bottom-left-radius",!_||!p),t.classList.toggle("no-border-bottom-right-radius",P||!_),t.classList.toggle("no-border-top-left-radius",Boolean(!p&&w)),t.classList.toggle("no-border-top-right-radius",P)),this._setWidth(c,e,T);const i=u-g-_-y-b;this._setHeight(c,e,Math.max(i,C))}if(e===this._recalcSingleRunToken&&r&&this.affectsLayout("tradingpanel")){const e=r.container.value();e&&(e.style.right=v&&m?`${m+4}px`:`${m}px`,e.style.top=y+g+b+"px",e.style.borderTopRightRadius=A&&m?"4px":"0px")}e===this._recalcSingleRunToken&&this._updateVisibility()}affectsLayout(e){const t=this._areas[e];if(!t)return!1;if(t.rdState.owner.value()!==t)return!1;if(this._fullscreenArea&&this._fullscreenArea!==e)return h(e);if(this._width.value()<=567||this._height.value()<=445&&!c){if(!["center","top","left","topleft","extratop"].includes(e))return!1}return!0}_updateVisibility(){const e=this._bridge.visible.value();for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],r=this._areas[i];r&&(e&&this.affectsLayout(i)?r.visible.setValue(!0):r.visible.setValue(!1))}}_onParentFullscreenChange(){this._bridge.fullscreen.value()||(this._fullscreenArea=void 0,this._updateFullscreen())}_updateFullscreen(){const e=void 0!==this._fullscreenArea;for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],r=this._areas[i];if(!r)continue;if(i===this._fullscreenArea){r.fullscreen.setValue(!0);continue}r.fullscreen.setValue(!1);const n=r.container.value();n&&n.classList.toggle("js-hidden",e&&!h(i))}this._updateVisibility(),this.recalculate()}_createDOM(e){const t=document.createElement("div");return t.classList.add("layout__area--"+e),t.style.position="absolute","tradingpanel"===e&&(t.style.borderTopRightRadius="4px"),
"bottom"===e?t.style.bottom="0":t.style.top="0","right"===e||"tradingpanel"===e?t.style.right="0":t.style.left="0",t}}function h(e){const t=o.enabled("side_toolbar_in_fullscreen_mode"),i=o.enabled("header_in_fullscreen_mode");return"center"===e||"left"===e&&t||"top"===e&&i}},250378:(e,t,i)=>{"use strict";i.d(t,{BadRequestErrorResponse:()=>n});var r=i(867023);class n extends r.ErrorResponse{constructor(e){super(e),this.name="BadRequestError",e.error?this.message=e.error:this.message="unknown error"}}},867023:(e,t,i)=>{"use strict";i.d(t,{ErrorResponse:()=>r});class r{constructor(e){this._status=e.status,this._statusText=e.statusText||""}getInfo(){return{name:this.name,status:this._status,statusText:this._statusText,message:this.message}}}},729030:(e,t,i)=>{"use strict";i.d(t,{getSymbolData:()=>l});var r=i(954912),n=i(438874),s=i(250378),o=i(685503),a=i(159954);function l(e,t,i,l,c=!0,d=!1){const h=i.join(","),u=(0,n.getSymbolDataUrl)(t,h,l,c,d),g={signal:e,method:"GET",credentials:"include",headers:{Accept:"application/json"}};return(0,r.fetch)(u,g,{logOnErrorStatus:!1}).then((e=>{if(400===e.status){const{status:t,statusText:i}=e;return e.json().then((e=>{const r=e.errmsg;throw new s.BadRequestErrorResponse({status:t,statusText:i,error:r})}))}if(404===e.status){const{status:t,statusText:i}=e;return e.json().then((r=>{if("symbol_not_exists"===r.code){const e=r.errmsg;throw new a.SymbolDoesNotExistErrorResponse({status:t,statusText:i,error:e})}throw new o.HttpErrorResponse(e)}))}if(e.ok)return e.json().then((e=>e));throw new o.HttpErrorResponse(e)}))}},685503:(e,t,i)=>{"use strict";i.d(t,{HttpErrorResponse:()=>n});var r=i(867023);class n extends r.ErrorResponse{constructor(e){super(e),this.name="HttpErrorResponse",this._status>=200&&this._status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`}}},159954:(e,t,i)=>{"use strict";i.d(t,{SymbolDoesNotExistErrorResponse:()=>n});var r=i(867023);class n extends r.ErrorResponse{constructor(e){super(e),this.name="SymbolDoesNotExistError",this.message=e.error||"symbol does not exist"}}},438874:(e,t,i)=>{"use strict";function r(){return window.SCREENER_HOST||"https://scanner.tradingview.com"}function n(e,t){const i=r();return t?`${i}/${t}/`:1===e.length?`${i}/${e[0]}/`:`${i}/global/`}function s(e,t,i,n,s){const o=r(),a={symbol:e,fields:t};n&&(a.no_404="true"),s&&(a.price_conversion="disabled"),i&&(a["label-product"]=i);const l=new URL(`${o}/symbol`);return Object.keys(a).forEach((e=>{l.searchParams.append(e,a[e])})),l.toString()}function o(e,t){return`${r()}/enum?id=${e}&lang=${t||window.language||"en"}`}function a(e,t){return`${r()}/enum/ordered?id=${e}&lang=${t||window.language||"en"}`}i.d(t,{getBackendUrl:()=>n,getEnumOrderedRegistryUrl:()=>a,getEnumRegistryUrl:()=>o,getSymbolDataUrl:()=>s})},372006:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SupportTicketData:()=>C})
;var r=i(954912),n=i(849289),s=i.n(n),o=i(871934),a=i(514183),l=i(314802),c=i(638456),d=i(131089),h=i(582950),u=i(735566),g=i(290222),_=i(989013),p=i(835518),m=(i(659863),i(125226)),v=i(262078),S=i(62802);function f(e){const t={name:e.name,time:e.startTime};return"measure"===e.entryType&&(t.duration=e.duration),t}function y(){const e=navigator.connection;return{effectiveType:e&&e.effectiveType||"unknown",rtt:e&&e.rtt||-1}}var b=i(386491);const w=(0,u.getLogger)("Support.TicketData");class C{constructor(e={}){this._options=e,this.reset()}destroy(){delete this._data,delete this._browserInfo,delete this._dialogElement}reset(){this._data={event:"support_ticket",screenshotAgree:!0},this._browserInfo=new(s())}setOptions(e){this._options={...this._options,...e}}getData(){return this._data}addData(e){Object.assign(this._data,e)}setDialogElement(e){this._dialogElement=e}async getFinalData(){if(void 0!==this._beforeCollectingFinalData&&(await this._beforeCollectingFinalData(),this._data.snapshotData)){try{const{data:e,width:t,height:i}=this._data.snapshotData;this._data.pageSnapshotURL=await(0,d.uploadSnapshot)(`data:image/png;base64,${e}`,t,i)}catch(e){w.logError(`${e}`)}delete this._data.snapshotData}const e=this._options.disableAutoCollection?this.getData():await this._collectData();return e?.tradingLogsAgree&&!e.trading&&(e.trading=this._getMinimalTradingLogs()),(0,h.isTicketDataComplete)(e)?e:(w.logError("Not enough data collected. `event` and one of (`userId`, `email`) fields required."),null)}onBeforeCollectingFinalData(e){this._beforeCollectingFinalData=e}tradingDataPromise(){return this._tradingDataPromise}onTradingData(e){this._tradingDataPromise=e}static setChartWidgetCollection(e){C._chartWidgetCollection=e}static getChartWidgetCollection(){return C._chartWidgetCollection}static setScreener(e){C._screener=e}static getScreener(){return C._screener}static setNewScreenerStandalone(e){C._newScreenerStandalone=e}static getNewScreenerStandalone(){return C._newScreenerStandalone}async _collectData(){this.addData(this._filterEmptyFields({browserInfo:this._getBrowserInfo(),ping:this._getPingInfo(),user:this._getUser(),userId:this._getUserId(),pro_plan:this._getProPlan(),websocketAddress:this._getWebSocketAddress(),sessionid:this._getSessionId(),ref:this._getReferrer(),js_errors:this._getJsErrors(),product:this._getProductId(),symbolSessionId:this._getSymbolSessionId(),dividendsAdjustment:this._getDividendsAdjustment(),backAdjustment:this._getBackAdjustment(),settlementAsClose:this._getSettlementAsClose(),chartSessionDisconnects:this._getChartSessionDisconnects(),marketStatuses:this._getChartMarketStatuses(),seriesStatuses:this._getChartSeriesStatuses(),is_pro:this._getUserIsPro(),subscription_state:this._getSubscriptionState(),proOffers:this._getProOffers(),timezone:this._getTimezone(),performanceMetrics:this._getPerformanceMetrics(),serverInfo:this._getServerInfo(),serverTimeOffset:this._getServerTimeOffset(),settings:this._getUserSettings(),domNodesCount:this._getDomNodesCount(),buildTime:this._getBuildTime(),
plugins:this._getPlugins(),locale:this._getLocale(),featuretoggles:this._getFeaturetoggles()}));const e=await Promise.allSettled([this._getChartSnapshot(),this._getTradingLogs(),this._getScreenerParams(),this._getLogHistory(),this._getPersistentLogHistory(),this._getDesktopReports(),this._getAlertHealthchecks(),this._getNewScreenerStandaloneParams(),this._getPageSnapshot()]);return this.addData(this._filterEmptyFields({snapshotURL:"fulfilled"===e[0].status?e[0].value:null,trading:"fulfilled"===e[1].status?e[1].value:null,screener:"fulfilled"===e[2].status?e[2].value:null,log:"fulfilled"===e[3].status?e[3].value:null,persistentLogs:"fulfilled"===e[4].status?e[4].value:null,desktopReports:"fulfilled"===e[5].status?e[5].value:null,alertHealthchecks:"fulfilled"===e[6].status?e[6].value:null,newScreenerStandaloneState:"fulfilled"===e[7].status?e[7].value:null,pageSnapshotURL:"fulfilled"===e[8].status?e[8].value:null})),this._data}_getBrowserInfo(){return this._browserInfo.state()}async _getChartSnapshot(){const e=C.getChartWidgetCollection();if(void 0===e)return w.logWarn("Abort generating snapshot. No chartWidgetCollection found."),null;_.forceTradingObjVisibilityOnScreenshot.setValue(!0);try{const t=await(0,o.takeChartSnapshotPromise)(e,{showHeaderMainSymbol:!0});return`${location.protocol}//${location.host}/x/${t}`}catch{return w.logError("Failed to take chart snapshot."),_.forceTradingObjVisibilityOnScreenshot.setValue(null),null}}_getMinimalTradingLogs(){return JSON.stringify({deviceId:(0,p.getDeviceId)()})}async _getTradingLogs(){if(!this._data.tradingLogsAgree)return w.logWarn("Abort collecting trading logs. User did not agree to send trading logs."),null;const e=(0,a.tradingService)();if(!e)return w.logWarn("Abort collecting trading logs. No trading object found."),null;const t=e.activeBroker();if(null===t||!t.bugReportInfo||1!==t.connectionStatus())return w.logWarn("Abort collecting trading logs because of connection or abscence of info collection method."),null;try{const e=await t.bugReportInfo();return JSON.stringify(e)}catch(e){return w.logError(`Error while collecting activeBroker info: ${e}`),null}}async _getScreenerParams(){const e=C.getScreener();return void 0===e?(w.logWarn("Abort collecting screener params. No screener found."),null):e.getCurrentState()}async _getNewScreenerStandaloneParams(){const e=C.getNewScreenerStandalone();return e?e.getCurrentStateStringified():(w.logWarn("Abort collecting new screener standalone params. No new screener standalone found."),null)}async _performHealthCheck(e,t,i="GET"){const n=Date.now();try{const s=await(0,r.fetch)(t,{method:i});return{title:e,status:s.status,responseTime:Date.now()-n,responseSize:s.headers.get("content-length")||"unknown"}}catch{return{title:e,status:0,responseTime:Date.now()-n}}}async _getAlertHealthchecks(){
return this._data.issueType!==h.TVOnlyActiveIssueType.Alert?null:Promise.all([this._performHealthCheck("alert_facade","https://pricealerts.tradingview.com/is_alive","POST"),this._performHealthCheck("old_alerts","https://alerts.tradingview.com/alerts/health/"),this._performHealthCheck("pine_facade","https://pine-facade.tradingview.com/pine-facade/is_auth_to_get/STD%3BSMA/last")])}_getProductId(){return(0,l.isOnMobileAppPage)("old")?"ios":(0,l.isOnMobileAppPage)("new")?"android":(0,c.isDesktopApp)()?"desktop":(0,c.isSymphonyEmbed)()?"symphony":"tv"}_getSymbolSessionId(){const e=C.getChartWidgetCollection();if(!e)return w.logWarn("Abort getting sessionId property value. No chartWidgetCollection found."),null;let t;try{t=e.activeChartWidget.value().model().mainSeries().properties().childs().sessionId.value()}catch(e){return w.logError(`Error while getting sessionId property value: ${e.message}`),null}return"string"==typeof t?t:null}_getDividendsAdjustment(){const e=C.getChartWidgetCollection();if(!e)return w.logWarn("Abort getting dividendsAdjustment property value. No chartWidgetCollection found."),null;let t;try{t=e.activeChartWidget.value().model().mainSeries().properties().childs().dividendsAdjustment.value()}catch(e){return w.logError(`Error while getting dividendsAdjustment property value: ${e.message}`),null}return"boolean"==typeof t?t:null}_getBackAdjustment(){const e=C.getChartWidgetCollection();if(!e)return w.logWarn("Abort getting backAdjustment property value. No chartWidgetCollection found."),null;let t;try{t=e.activeChartWidget.value().model().mainSeries().properties().childs().backAdjustment.value()}catch(e){return w.logError(`Error while getting backAdjustment property value: ${e?.message}`),null}return"boolean"==typeof t?t:null}_getSettlementAsClose(){const e=C.getChartWidgetCollection();if(!e)return w.logWarn("Abort getting settlementAsClose property value. No chartWidgetCollection found."),null;let t;try{t=e.activeChartWidget.value().model().mainSeries().properties().childs().settlementAsClose.value()}catch(e){return w.logError(`Error while getting settlementAsClose property value: ${e?.message}`),null}return"boolean"==typeof t?t:null}_getChartSessionDisconnects(){return window.ChartApiInstance?window.ChartApiInstance.disconnectCount():(w.logWarn("Abort getting chart session disconnects count. No ChartApiInstance found."),null)}_getChartMarketStatuses(){const e=C.getChartWidgetCollection();return e?e.chartMarketStatuses():(w.logWarn("Abort getting market statuses. No chartWidgetCollection found."),[])}_getChartSeriesStatuses(){const e=C.getChartWidgetCollection();return e?e.chartSeriesStatuses():(w.logWarn("Abort getting series statuses. No chartWidgetCollection found."),[])}_getUserIsPro(){return Boolean(window.user&&window.user.is_pro)}_getSubscriptionState(){return(0,b.isPaidPro)(window.user)?h.SubscriptionState.IsPro:window.user.had_pro?h.SubscriptionState.ExPro:void 0}_getProOffers(){return window.pro&&window.pro.offers&&window.pro.offers()||[]}_getTimezone(){const e=C.getChartWidgetCollection()
;if(!e)return w.logWarn("Abort getting timezone. No chartWidgetCollection found."),null;let t=null;try{t=e.activeChartWidget.value().model().model().properties().childs().timezone.value()}catch(e){w.logError(`Error while getting timezone: ${e.message}`)}return t}_getPerformanceMetrics(){return function(){if(!window.performance||!performance.getEntriesByType)return null;const e=performance.getEntriesByType("navigation");if(0===e.length)return null;const t=e[0];let i=performance.getEntriesByType("mark");i=i.slice(Math.max(i.length-1e3,0));let r=performance.getEntriesByType("paint");r=r.slice(Math.max(r.length-1e3,0));let n=performance.getEntriesByType("measure");return n=r.slice(Math.max(n.length-1e3,0)),{connection:y(),navigation:t.toJSON&&t.toJSON()||"unknown",paints:r.map(f),marks:i.map(f),measures:n.map(f),pushstream:{statusPublic:v.pushStreamMultiplexer.status(),statusPrivate:v.pushStreamMultiplexer.statusPrivate()}}}()}_sortLogs(e,t){return e.timestamp-t.timestamp}async _getLogHistory(){let e;try{let t=(0,u.getRawLogHistory)();v.pushStreamMultiplexer.ownPushStream()||(t=t.concat(await v.pushStreamMultiplexer.getLogs())),e=t.sort(this._sortLogs).map(u.serializeLogHistoryEntry).join("\n").slice(-8e6)}catch(t){w.logWarn(`Error while collecting log history: ${t.message}`),e=JSON.stringify({error:"logger.getLogHistory(maxLen) failed: "+t.message,stack:t.stack})}return e}async _getPersistentLogHistory(){const e=await((0,g.getPersistentLogger)()?.getLastSessions(5))??[];return e.forEach((e=>e.entries=e.entries.slice(-8e6))),e}async _getDesktopReports(){return window.TVD&&window.TVD.getReports?window.TVD.getReports():null}_getPingInfo(){if(!window.ChartApiInstance)return w.logWarn("Abort getting chart session disconnects count. No ChartApiInstance found."),[];const e=window.ChartApiInstance.getPingInfo();return null!==e?[e.min,e.max,e.avg]:[]}_getUserId(){return window.user&&window.user.id?window.user.id:null}_getUser(){return window.user&&window.user.username||"Guest"}_getProPlan(){return window.user&&window.user.pro_plan&&"free"!==window.user.pro_plan?window.user.pro_plan:null}_getWebSocketAddress(){return window.WSBackendConnection?window.WSBackendConnection.getHost():(w.logWarn("Abort getting websocket address. No WSBackendConnection found."),null)}_getSessionId(){return window.ChartApiInstance?window.ChartApiInstance.sessionid:(w.logWarn("Abort getting websocket address. No ChartApiInstance found."),null)}_getReferrer(){return location.href}_getJsErrors(){return window.__tv_js_errors.slice(0,10)}_filterEmptyFields(e){const t={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];null!=r&&(!Array.isArray(r)||r.length>0)&&(t[i]=r)}return t}_getServerInfo(){const e=document.querySelector('meta[name="tv:server-name"]');return null!==e?e.getAttribute("content"):null}_getServerTimeOffset(){return window.ChartApiInstance?String(Math.round(window.ChartApiInstance.serverTime()-Date.now()))+"s":(w.logWarn("Abort getting server time offset. No ChartApiInstance found."),null)}_getUserSettings(){{
const e=S.default.keys().reduce(((e,t)=>{const i=S.default.getValue(t);if(i)try{e[t]=JSON.parse(i)}catch(r){e[t]=i}return e}),{});return JSON.stringify(e).slice(0,5e5)}}_getDomNodesCount(){return document.querySelectorAll("*").length}async _getPageSnapshot(){if(!this._data.screenshotAgree||!(0,l.isOnMobileAppPage)("new"))return null;const e=await Promise.all([i.e(59928),i.e(142)]).then(i.bind(i,311702)),t={logging:!1,ignoreElements:e=>e===this._dialogElement,querySelectorForSnapshot:""};document.getElementById("js-screener-container")?t.querySelectorForSnapshot="#js-screener-container":document.getElementById("js-market-heatmap")&&(t.querySelectorForSnapshot="#js-market-heatmap");try{const i=await e.generateHtml2CanvasSnapshot(t);return i?(0,d.uploadSnapshot)(i.data,i.width,i.height):null}catch(e){return w.logError(`Failed to make page snapshot: ${e}`),null}}_getBuildTime(){return window.BUILD_TIME}_getPlugins(){return void 0!==navigator.plugins?Array.from(navigator.plugins).map((e=>({name:e.name,filename:e.filename,description:e.description}))):[]}_getLocale(){return window.language??"en"}_getFeaturetoggles(){return Object.keys(window.featureToggleState??{}).reduce(((e,t)=>(e[t]=(0,m.isFeatureEnabled)(t),e)),{})}}},582950:(e,t,i)=>{"use strict";var r,n,s,o,a;i.d(t,{AdditionalIssueType:()=>a,CoreActiveIssueType:()=>r,CoreLegacyIssueType:()=>n,DUPLICATE_TICKET_ERROR_CODE:()=>l,FieldName:()=>_,FreshdeskProduct:()=>g,SatisfactionStatus:()=>u,SubscriptionState:()=>c,TVOnlyActiveIssueType:()=>s,TVOnlyLegacyIssueType:()=>o,TicketNoteState:()=>d,TicketPublicStatus:()=>h,isTicketDataComplete:()=>p}),function(e){e.Chart="Chart",e.Trading="Trading issue",e.Indicators="Indicators",e.Drawings="Drawings"}(r||(r={})),function(e){e.Other="Other",e.DrawingIssue="Drawings issue",e.StudyNotLoading="Study not loading",e.SlowChart="Slow scrolling or chart loading"}(n||(n={})),function(e){e.Billing="Billing",e.Data="Data",e.PineScript="Pine Script issue",e.Alert="Alerts issue",e.Screener="Screener",e.SocialNetwork="Social network",e.Watchlist="Watchlist",e.MobileApps="Mobile apps",e.Desktop="Desktop",e.Financials="Financials",e.ProfileSettings="Profile settings",e.Heatmap="Heatmap",e.AccountRecovery="Account recovery",e.Blackfriday="Black Friday",e.Cybermonday="Cyber Monday",e.PaymentSearch="Payment search",e.Options="Options",e.PineSeeds="Pine Seeds",e.News="News",e.Portfolio="Portfolio",e.Curves="Yield Curves",e.Strategies="Strategies"}(s||(s={})),function(e){e.Unsubscribe="Unsubscribe",e.ChartDoesNotLoad="Chart does not load",e.NoRealTimeData="No real-time data",e.GapInTheData="Gap in the data",e.PriceIncorrect="Price incorrect"}(o||(o={})),function(e){e.Refund="Refund"}(a||(a={}));const l="duplicated_request";var c,d,h,u,g,_;function p(e){return null!==e&&void 0!==e.event&&void 0!==e.userId||null!==e&&void 0!==e.email}!function(e){e.IsPro="Is PRO",e.ExPro="Ex-PRO"}(c||(c={})),function(e){e.FromAgent="0",e.FromUser="2",e.FromEva="3"}(d||(d={})),function(e){e.Received="Received",e.InProgress="In Progress",e.Closed="Closed"}(h||(h={})),
function(e){e[e.Good=103]="Good",e[e.Average=100]="Average",e[e.Bad=-103]="Bad"}(u||(u={})),function(e){e[e.Production=43000002188]="Production",e[e.ProductionFree=43000002552]="ProductionFree",e[e.ProductionRefunds=43000007194]="ProductionRefunds",e[e.Staging=43000002187]="Staging",e[e.StagingFree=43000002553]="StagingFree",e[e.StagingRefunds=43000007193]="StagingRefunds"}(g||(g={})),function(e){e.IssueType="issue-type",e.Alert="alert",e.Broker="broker",e.TicketOrderId="ticket-order-id",e.Description="description",e.PineScript="pine-script",e.Attachments="attachments",e.TradingLogsAgree="trading-agree",e.PageScreenshotAgree="page-screenshot-agree",e.PineRepo="pine-repo"}(_||(_={}))},163482:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TECHNICALS_QS_FIELDS:()=>r,TECHNICALS_SCREENER_COLUMNS:()=>l,requiredMAColumns:()=>o,requiredOscColumns:()=>s,requiredPivotsColumns:()=>a,requiredRecommendColumns:()=>n});const r=["type","listed_exchange","pricescale","typespecs","pro_name","short_name"],n=["Recommend.Other","Recommend.All","Recommend.MA"],s=["RSI","Stoch.K","CCI20","ADX","AO","Mom","MACD.macd","Stoch.RSI.K","W.R","BBPower","UO"],o=["EMA10","SMA10","EMA20","SMA20","EMA30","SMA30","EMA50","SMA50","EMA100","SMA100","EMA200","SMA200","Ichimoku.BLine","VWMA","HullMA9"],a=["Pivot.M.Classic.R3","Pivot.M.Classic.R2","Pivot.M.Classic.R1","Pivot.M.Classic.Middle","Pivot.M.Classic.S1","Pivot.M.Classic.S2","Pivot.M.Classic.S3","Pivot.M.Fibonacci.R3","Pivot.M.Fibonacci.R2","Pivot.M.Fibonacci.R1","Pivot.M.Fibonacci.Middle","Pivot.M.Fibonacci.S1","Pivot.M.Fibonacci.S2","Pivot.M.Fibonacci.S3","Pivot.M.Camarilla.R3","Pivot.M.Camarilla.R2","Pivot.M.Camarilla.R1","Pivot.M.Camarilla.Middle","Pivot.M.Camarilla.S1","Pivot.M.Camarilla.S2","Pivot.M.Camarilla.S3","Pivot.M.Woodie.R3","Pivot.M.Woodie.R2","Pivot.M.Woodie.R1","Pivot.M.Woodie.Middle","Pivot.M.Woodie.S1","Pivot.M.Woodie.S2","Pivot.M.Woodie.S3","Pivot.M.Demark.R1","Pivot.M.Demark.Middle","Pivot.M.Demark.S1"],l=[...n,...s,...o,...a]},719885:(e,t,i)=>{"use strict";i.d(t,{TechnicalsDialogController:()=>c});var r=i(202373),n=i(188414),s=i(729030),o=i(732433),a=i(163482);let l;class c extends n.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}async show(e){const t=e?.symbol?e.symbol:r.linking.proSymbol.value();if(e?.snapshot){const{snapshot:i}=e,r=await this._loadModule();this._getDialog(r,{...e,symbol:t,...i,exchange:i.listed_exchange}).show()}else{const r=async()=>{const{snapshoter:e}=await i.e(51030).then(i.bind(i,795394));return e().getSnapshot(t,new Set(a.TECHNICALS_QS_FIELDS))},[n,s]=await Promise.all([this._loadModule(),r()]);if("error"===s.status)return void this._getDialog(n,{...e,symbol:t}).show();this._getDialog(n,{...e,symbol:t,...s.values,exchange:s.values.listed_exchange}).show()}}async canBeShown(e){const t=e||r.linking.proSymbol.value();if(!t)return!1;const n=new Set([...a.TECHNICALS_QS_FIELDS,"description"]),l=await(async()=>{const{snapshoter:e}=await i.e(51030).then(i.bind(i,795394));return e().getSnapshot(t,n)})()
;if("error"===l.status)return!1;const{values:{type:c,listed_exchange:d,description:h}}=l;if(!o.SYMBOL_TYPE_BLACK_LIST.has(c))try{const e=await(0,s.getSymbolData)(null,t,["Recommend.All"]);return Boolean(e&&0!==Object.keys(e).length&&h&&d&&c)}catch(e){return!1}return!1}hide(){this._dialog?.hide()}static getInstance(){return l||(l=new c),l}_getDialog(e,t){return this._dialog?.hide(),this._dialog?.visible().unsubscribe(this._subscribe),this._dialog=new e.TechnicalsDialogRenderer(t),this._dialog.visible().subscribe(this._subscribe),this._dialog}_loadModule(){return Promise.all([i.e(40035),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(55629),i.e(31697),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(6563),i.e(17353),i.e(94891),i.e(35009),i.e(52350),i.e(36147),i.e(14731),i.e(89923),i.e(17760),i.e(84427),i.e(26630),i.e(83999),i.e(72578),i.e(84465),i.e(3430),i.e(15159),i.e(89048),i.e(94395),i.e(99667),i.e(42508),i.e(55149),i.e(40627),i.e(76471),i.e(68960),i.e(32227),i.e(95759),i.e(97829),i.e(62324),i.e(71138)]).then(i.bind(i,948549))}}},487381:(e,t,i)=>{"use strict";i.d(t,{setupTrackingModePopupHint:()=>l});var r=i(62802),n=i(313344),s=i(638456),o=i(345848),a=i(687037);function l(e){if(!s.CheckMobile.any()||Boolean(r.getBool("hint.trackingMode"))||!a.enabled("popup_hints"))return;const t=s=>{const a=n.tool.value();((0,n.toolIsCursor)(a)||(0,n.toolIsEraser)(a))&&(s.preventDefault(),s.stopPropagation(),Promise.all([i.e(30625),i.e(1283),i.e(85615),i.e(56224),i.e(55629),i.e(86280),i.e(66884),i.e(32227),i.e(62526),i.e(35174)]).then(i.bind(i,416108)).then((e=>{e.render(document.createElement("div"),(()=>{r.setValue("hint.trackingMode",!0,{forceFlush:!0}),(0,o.trackEvent)("GUI","Tracking Mode")}))})),e.removeEventListener("touchstart",t,!0))};e.addEventListener("touchstart",t,!0)}},24958:(e,t,i)=>{"use strict";i.d(t,{TradingBootloader:()=>u});var r=i(564894),n=i(510013),s=i(62802),o=i(444372),a=i(497106),l=i(687037),c=i(194745),d=i(607196),h=i(360433);class u extends n.ChunkLoader{constructor(e){super(),this._options=e;const t=this._options.resizerBridge.container.value();t.classList.add(h.rootContainer),t.ariaLabel=o.t(null,void 0,i(648165)),window.is_authenticated&&!(0,a.isMobileTradingAvailable)()&&l.enabled("show_order_panel_on_start")&&(this._options.resizerBridge.negotiateWidth(s.default.getInt(c.settingsKeys.PANEL_WIDTH)||d.minPanelWidth),this._options.resizerBridge.negotiateHeight(d.panelHeight))}async _startLoading(){return this._loadTrading()}async _loadTrading(){
const{resizerBridge:e,chartWidgetCollection:t}=this._options,[{TRADING_SERVICE:n},{Trading:s},{TradingNotificationsHandler:o}]=await Promise.all([Promise.all([i.e(18061),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(55629),i.e(10727),i.e(31697),i.e(86280),i.e(6563),i.e(30783),i.e(98567),i.e(29573),i.e(73438),i.e(70815),i.e(66029),i.e(7256),i.e(84794),i.e(35009),i.e(14731),i.e(89923),i.e(99397),i.e(17760),i.e(55469),i.e(96621),i.e(12532),i.e(69069),i.e(81469),i.e(57434),i.e(70526),i.e(32496),i.e(83256),i.e(55973),i.e(46770),i.e(16499),i.e(19985),i.e(10742),i.e(88827),i.e(30642),i.e(28396),i.e(88047),i.e(84799),i.e(39439),i.e(44048),i.e(9290),i.e(76905),i.e(81476),i.e(32227),i.e(94483),i.e(71986),i.e(93524),i.e(63094),i.e(71951),i.e(91462),i.e(34906),i.e(66695),i.e(25142)]).then(i.bind(i,514183)),Promise.all([i.e(18061),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(55629),i.e(10727),i.e(31697),i.e(86280),i.e(6563),i.e(30783),i.e(98567),i.e(29573),i.e(73438),i.e(70815),i.e(66029),i.e(7256),i.e(84794),i.e(35009),i.e(14731),i.e(89923),i.e(99397),i.e(17760),i.e(55469),i.e(96621),i.e(12532),i.e(69069),i.e(81469),i.e(57434),i.e(70526),i.e(32496),i.e(83256),i.e(55973),i.e(46770),i.e(16499),i.e(19985),i.e(10742),i.e(88827),i.e(30642),i.e(28396),i.e(88047),i.e(84799),i.e(39439),i.e(44048),i.e(9290),i.e(76905),i.e(81476),i.e(32227),i.e(94483),i.e(71986),i.e(93524),i.e(63094),i.e(71951),i.e(91462),i.e(34906),i.e(66695),i.e(25142)]).then(i.bind(i,709331)),Promise.all([i.e(18061),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(55629),i.e(10727),i.e(31697),i.e(86280),i.e(6563),i.e(30783),i.e(98567),i.e(29573),i.e(73438),i.e(70815),i.e(66029),i.e(7256),i.e(84794),i.e(35009),i.e(14731),i.e(89923),i.e(99397),i.e(17760),i.e(55469),i.e(96621),i.e(12532),i.e(69069),i.e(81469),i.e(57434),i.e(70526),i.e(32496),i.e(83256),i.e(55973),i.e(46770),i.e(16499),i.e(19985),i.e(10742),i.e(88827),i.e(30642),i.e(28396),i.e(88047),i.e(84799),i.e(39439),i.e(44048),i.e(9290),i.e(76905),i.e(81476),i.e(32227),i.e(94483),i.e(71986),i.e(93524),i.e(63094),i.e(71951),i.e(91462),i.e(34906),i.e(66695),i.e(25142)]).then(i.bind(i,801620))]);try{const i=new s(e,this._options.bottomWidgetBarSettled);return r.registerService(n,i),void 0!==t&&i.setChartWidgetCollection(t),new o(i),i}catch(e){{const[{getLogger:t},{getLoggerMessage:r}]=await Promise.all([Promise.resolve().then(i.bind(i,735566)),i.e(32215).then(i.bind(i,762092))]);t("Trading Bootloader").logWarn(`Failed to create Trading: ${r(e)}`)}throw e}}}},477600:(e,t,i)=>{"use strict";i.d(t,{createStubElem:()=>n});var r=i(66234);function n(e=[],t=[]){const i=document.createElement("div"),n=document.createElement("div");return i.appendChild(n),i.classList.add(r.container),n.classList.add(r.inner),e.forEach((e=>{i.classList.add(r[e])})),t.forEach((e=>{i.classList.add(r[e])})),i}},100148:(e,t,i)=>{"use strict";function r(e,t){const i=e.dataSourceForId(t);if(null===i)throw new Error(`Chart has no study or shape with id "${t}"`);return i}i.d(t,{SelectionApi:()=>n});class n{constructor(e){this._model=e}add(e){
Array.isArray(e)?this._model.selectionMacro((t=>{e.map(r.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.add([e])}canBeAddedToSelection(e){const t=r(this._model,e);return this._model.selection().canBeAddedToSelection(t)}set(e){Array.isArray(e)?this._model.selectionMacro((t=>{t.clearSelection(),e.map(r.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.set([e])}remove(e){Array.isArray(e)?this._model.selectionMacro((t=>{e.map(r.bind(null,this._model)).forEach((e=>t.removeSourceFromSelection(e)))})):this.remove([e])}contains(e){const t=r(this._model,e);return this._model.selection().isSelected(t)}allSources(){return this._model.selection().dataSources().map((e=>e.id()))}isEmpty(){return this._model.selection().isEmpty()}clear(){this._model.selectionMacro((e=>{e.clearSelection()}))}onChanged(){return this._model.onSelectedSourceChanged()}}},503595:(e,t,i)=>{"use strict";i.d(t,{asyncWindowOpen:()=>a});var r=i(314802),n=i(638456),s=i(444372),o=i(23482);function a(e,t,a){return window.TVD||(0,r.isOnMobileAppPage)("any")||"_self"===t||(0,n.isSymphonyEmbed)()?function(e,t,i){return e.then((e=>{void 0!==e&&open(e,t,i)}),(()=>{}))}(e,t,a):async function(e,t,r){const n=URL.createObjectURL(new Blob([`<!doctype html><html style="background-color:${getComputedStyle(document.documentElement).backgroundColor}"><head><meta charset="utf-8"><title>${s.t(null,void 0,i(493292))}</title></head><body style="background-color:${getComputedStyle(document.body).backgroundColor}"></body></html>`],{type:"text/html"}));try{o.isIOS&&await new Promise((e=>setTimeout(e)));const i=open(n,t,r);if(!i)throw new Error("cound not open a new tab");const s=await e.catch((()=>{}));void 0!==s?i.location.replace(s):i.close()}finally{URL.revokeObjectURL(n)}}(e,t,a)}},849289:(e,t,i)=>{"use strict";var r,n,s,o=i(77034);function a(){return r||(this instanceof a?void(r=this):new a)}a.prototype.browser=function(){return n||(n=o.name+" "+o.version),n},a.prototype.setBrowser=function(e){"string"==typeof e&&e&&(n=e)},a.prototype.os=function(){if(!s){var e=Object.keys(o);s=["mac","windows","windowsphone","linux","chromeos","android","ios","blackberry","firefoxos","webos","bada","tizen","sailfish"].filter((function(t){return e.includes(t)}))[0]}return s},a.prototype.setOS=function(e){"string"==typeof e&&e&&(s=e)},a.prototype.cookieEnabled=function(){return navigator.cookieEnabled},a.prototype.viewportSize=function(){return document.documentElement.clientWidth+" x "+document.documentElement.clientHeight},a.prototype.screenSize=function(){return window.screen&&(screen.width||screen.availWidth)+" x "+(screen.height||screen.availHeight)||"unknown"},a.prototype.colorDepth=function(){return window.screen&&screen.colorDepth||"unknown"},a.prototype.pixelRatio=function(){return window.devicePixelRatio||0},a.prototype.wsTestResult=function(){return"Pending"},a.prototype.maxTouchPoints=function(){return navigator.maxTouchPoints||0},a.prototype.orientation=function(){return"onorientationchange"in window},a.prototype.touchevents=function(){
return"ontouchstart"in window},a.prototype.hover=function(){try{return window.matchMedia("(any-hover: hover)").matches}catch(e){return null}},a.prototype.state=function(){return{os:this.os(),browser:this.browser(),cookieEnabled:this.cookieEnabled(),viewportSize:this.viewportSize(),screenSize:this.screenSize(),colorDepth:this.colorDepth(),pixelRatio:this.pixelRatio(),maxTouchPoints:this.maxTouchPoints(),orientation:this.orientation(),touchevents:this.touchevents(),hover:this.hover()}},e.exports=a},510013:(e,t,i)=>{"use strict";i.d(t,{ChunkLoader:()=>n});var r=i(357517);class n{constructor(){this._retries=5,this._cache=null,this._tryLoad=(e,t)=>{this._retries=this._retries-1;this._startLoading(e).then(t,0!==this._retries?i=>{(0,r.isAbortError)(i)||setTimeout((()=>this._tryLoad(e,t)),3e3)}:void 0)}}load(e){return this._cache||(this._cache=new Promise(this._tryLoad.bind(this,e??null))),this._cache}}},84004:(e,t,i)=>{"use strict";i.d(t,{addIDCCodes:()=>l});var r=i(954912),n=i(444372),s=(i(7742),i(345848)),o=i(845768),a=i(593887);function l(e){return(0,s.trackEvent)("IDC Add Delay Service","Agreed",e),(0,r.fetch)(`/idc-add-delay-service/${e}/`,{credentials:"include"}).then((e=>e.json())).then((e=>e.res===o.SymbolAvailabilityCodes.OK?0:1)).catch((()=>(function(e){(0,a.showNoticeDialog)({title:n.t(null,void 0,i(91940)),content:n.t(null,void 0,i(882369)).format({exchange:e.toUpperCase()})})}(e),Promise.resolve(1))))}},746849:(e,t,i)=>{"use strict";i.d(t,{checkIfExchangeAvailable:()=>s,isUserNeedSignAgreement:()=>n});i(7742);var r=i(406103);function n(e){if(!(0,r.isIDCExchange)(e))return!1;e=o(e);const t=window.pro,i=t.getProduct(e);return void 0!==i.idc_service_codes_delay&&((!Array.isArray(i.included_exchanges)||!i.included_exchanges.some((e=>t.hasPackage(o(e)))))&&!function(e){const t=window.pro;return t.hasPackage(e)||t.hasPackage(e+"_dly")}(e))}function s(e){const t=window.pro;return new Promise((i=>{window.is_authenticated?!t.getIDCExchanges(!0).length||t.isInvalidShopConf()?t.updateShopConf().then((()=>{i(!n(e))})).catch((()=>{i(!0)})):i(!n(e)):i(!0)}))}function o(e){return e.startsWith("exchange-")?e:"exchange-{0}".format(e.toLowerCase())}},572104:(e,t,i)=>{"use strict";i.d(t,{BIST_MIXED_KEY:()=>h,checkBrokerageBist:()=>g,vorAgreementDialog:()=>_});var r=i(226722),n=i(749028),s=i(442424),o=i(85437);var a=i(735566);const l=(0,s.subscriptionNotification)(),c=(0,a.getLogger)("VorAgreementDialog"),d=()=>{},h="bist_mixed",u=["INFOYATIRIM","OSMANLI"];function g(e){u.includes(e)&&_(h)}async function _(e,t=!1){try{if(t)return void p(t);const i=await(0,n.isSignedExchangeAgreement)({exchange:e});if(i.response)return;p()}catch(e){c.logError(e.message)}}async function p(e=!1){!async function(e){
const{ShowAgreementDialogImpl:t}=await Promise.all([i.e(15665),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(91478),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(53924),i.e(30783),i.e(98567),i.e(31481),i.e(73438),i.e(70815),i.e(19981),i.e(51711),i.e(24313),i.e(26630),i.e(57369),i.e(78392),i.e(3113),i.e(31868),i.e(37732),i.e(94521),i.e(13647),i.e(19854),i.e(17512),i.e(38253),i.e(35393),i.e(83557),i.e(45632),i.e(25307),i.e(67265),i.e(32227),i.e(12831),i.e(65805),i.e(65089),i.e(6729),i.e(45586),i.e(61174),i.e(8302)]).then(i.bind(i,254610));t(e)}({isUpdateRequired:e,onConfirm:()=>{(0,o.showExchangeAgreementDialog)({onClose:()=>{e||l.emit({type:s.SubscriptionEventType.AgreementSigned}),window.user.market_profile_updated_timestamp=void 0,window.sessionStorage.setItem("market_profile_updated","true"),r.TVXWindowEvents.emit(s.SubscriptionEventType.MarketProfileDataUpdated)},isExpert:"pro"===window.user.declared_status,hideCloseButton:!0,isUpdateRequired:e})},onClose:d})}},406103:(e,t,i)=>{"use strict";i.d(t,{isIDCExchange:()=>n});var r=i(386491);function n(e,t=!1){if(e&&e.startsWith("exchange-"))return function(e,t=!1){const i=window.pro?.getProduct(e);return!(void 0===i||!(0,r.isProductDefined)(i)||(t?!i.idc_service_codes_delay:!i.idc_service_codes))}(e,t);const i=(e||"").toLowerCase();return window.pro?.getIDCExchanges(t)?.includes(i)??!1}},202022:(e,t,i)=>{"use strict";i.d(t,{isSymbolAvailable:()=>C,requestFallbackSymbol:()=>T});var r=i(599612),n=i(207799),s=i(345848),o=i(592068);var a=i(84004);const l=window.pro;function c(e){return new Promise((t=>{if(!(e=e&&e.toLowerCase()))return void t(!1);if((0,o.isOpenedModals)())return void t(!1);let r=!1;(0,n.createIdcDelayAddServiceDialog)().then((n=>{n.open(),n.on("afterOpen",(()=>{(0,s.trackEvent)("IDC Add Delay Service","Dialog Shown",e)})),n.on("afterClose",(()=>{r||t(!1)})),n.on("action:add-service",(n=>{r=!0,n.destroy(),(0,a.addIDCCodes)(e).then((e=>{0===e?(l.invalidateShopConf(),l.updateShopConf(),async function(){const{showSubscriptionHasBeenChangedDialog:e}=await Promise.all([i.e(61851),i.e(1283),i.e(56224),i.e(59648),i.e(99408),i.e(78335),i.e(15984),i.e(65729),i.e(13647),i.e(38962),i.e(72086),i.e(61073),i.e(32227),i.e(12047),i.e(30870)]).then(i.bind(i,754401));e({pushReload:!0})}(),t(!0)):t(!1)}))}))}))}))}var d=i(406103),h=i(712787),u=i(178100);const g=["ls"];var _=i(845768);var p=i(277038),m=i(202373),v=i(416234),S=i(125226),f=i(314802);var y=i(572104),b=i(727481),w=i(149340);function C(e,t){return(0,r.check)(e).then((()=>(function(e){if(!window.TradingView.onChartPage&&(0,f.isOnMobileAppPage)("any"))return;if((0,S.isFeatureEnabled)("force_to_upgrade_to_expert")&&window.user.force_to_upgrade)return void(0,b.showUpgradeToProDialog)({isForcedToUpgrade:window.user.force_to_upgrade});if((0,S.isFeatureEnabled)("force_to_complete_data")&&window.user.force_to_complete_data)return void(0,y.vorAgreementDialog)();const t=function(){
if(window.user.market_profile_updated_timestamp&&!window.sessionStorage.getItem("market_profile_updated")){const e=(new Date).getTime()-1e3*window.user.market_profile_updated_timestamp;return Math.floor(e/1e3/60/60/24/365)>0}return!1}();t&&(0,y.vorAgreementDialog)(void 0,t);if(!e)return;const i=window.pro.getUserExchangeByPerm(e);if((0,S.isFeatureEnabled)("required_agreement_for_rt")&&i){const{exchange_agreement:t,idc_service_codes:r,exchange_agreement_expert:n}=i;if(r)return;const s=(window.user.is_expert?n:t)??e;return void(0,y.vorAgreementDialog)(s)}if(y.BIST_MIXED_KEY.startsWith(e)){window.pro.getUserExchangeByPerm(y.BIST_MIXED_KEY)&&(0,y.vorAgreementDialog)(y.BIST_MIXED_KEY)}}(t),!0))).catch((e=>{if(e.errCode===_.SymbolAvailabilityCodes.DELAY_NOT_AVAILABLE)(0,p.createGoProDialog)({feature:"idcFreeUser",closeOnOutsideClick:!1,goOnMarkets:!0});else if((0,d.isIDCExchange)(e.exchange)){if(e.errCode===_.SymbolAvailabilityCodes.NEED_SIGN_AGREEMENT)return t=e.exchange,new Promise((e=>{(t=t&&t.toLowerCase())?(0,o.isOpenedModals)()?e(!1):(0,n.createIdcDelayAgreementDialog)({exchange:t}).then((i=>{i.on("afterOpen",(()=>{(0,s.trackEvent)("IDC Delay","Dialog Shown",t)})),i.on("afterClose",(()=>{e(!1)})),i.on("action:sign-agreement",(()=>{window.saver.saveChartSilently(),(0,s.trackEvent)("IDC Delay","Go on Agreement",t)})),i.open()})):e(!1)}));if(e.errCode===_.SymbolAvailabilityCodes.NEED_ADD_SERVICE)return c(e.exchange)}var t;return Promise.resolve(!1)}))}function T(e,t){return new Promise((r=>{if("group_not_permitted"!==t.type)return void r(e);if(!t.symbolGroup)return void r(window.DEFAULT_SYMBOL);const n=t.symbolGroup,s=(0,u.isSfFlag)(n),a=(0,h.isMcxFlag)(n),l=(c=n,g.includes(c.toLowerCase()));var c,d;if(s||a||l){if((0,o.isOpenedModals)())return void r(window.DEFAULT_SYMBOL);d={exchange:(0,w.getExchange)(m.linking.proSymbol.value()),onSigninSuccess:()=>{r(e)},isRealtime:a},Promise.all([i.e(56108),i.e(1283),i.e(56224),i.e(59648),i.e(99408),i.e(78335),i.e(65729),i.e(13647),i.e(38962),i.e(72086),i.e(68307),i.e(32227),i.e(12047),i.e(90107),i.e(27901)]).then(i.bind(i,600827)).then((e=>e.createGoRegisterDialog(d))),C(e).then((t=>{t&&r(e)}))}const _=(0,v.getSymbolGroupData)(n);_?function(e){Promise.all([i.e(23682),i.e(1283),i.e(85615),i.e(56224),i.e(55629),i.e(86280),i.e(65729),i.e(32413),i.e(65928),i.e(32227),i.e(62526),i.e(87279)]).then(i.bind(i,163628)).then((t=>t.createAvailableExchangeDialog(e)))}({width:600,title:_.title,content:_.description,destroy:()=>r(window.DEFAULT_SYMBOL)}):r(window.DEFAULT_SYMBOL)}))}},599612:(e,t,i)=>{"use strict";i.r(t),i.d(t,{check:()=>l});var r=i(149340),n=i(954912),s=i(400353),o=i(746849),a=i(845768);function l(e,t=!0){return new Promise(((i,l)=>{const c=(0,r.getExchange)(e);c?(0,o.checkIfExchangeAvailable)(c).then((r=>r?i(e):(0,s.enabled)("IDC_AVAILABLE_DELAY")?t?void(0,n.fetch)(`/idc-sign-agreement-check/${c}/`,{credentials:"include"}).then((t=>t.json().then((t=>t.res===a.SymbolAvailabilityCodes.DELAY_NOT_AVAILABLE?l({exchange:c,errCode:t.res,reason:"delay not available",symbol:e
}):t.res===a.SymbolAvailabilityCodes.NEED_SIGN_AGREEMENT?l({exchange:c,errCode:t.res,reason:"need sign agreement",symbol:e}):t.res===a.SymbolAvailabilityCodes.NEED_ADD_SERVICE?l({exchange:c,errCode:t.res,reason:"need add service",symbol:e}):i(e))))).catch((()=>{i(e)})):i(e):l({exchange:c,errCode:a.SymbolAvailabilityCodes.DELAY_NOT_AVAILABLE,reason:"delay not available",symbol:e}))):i(e)}))}},845768:(e,t,i)=>{"use strict";i.d(t,{SymbolAvailabilityCodes:()=>r});const r=JSON.parse('{"OK":"OK","ERR":"ERR","SYMBOL_NOT_AVAILABLE_FOR_ANON":"SYMBOL_NOT_AVAILABLE_FOR_ANON","DELAY_NOT_AVAILABLE":"DELAY_NOT_AVAILABLE","NEED_SIGN_AGREEMENT":"NEED_SIGN_AGREEMENT","NEED_ADD_SERVICE":"NEED_ADD_SERVICE"}')},656130:(e,t,i)=>{"use strict";i.d(t,{generateChartUrl:()=>n});var r=i(314802);function n(e){const t=e.chartId?`/chart/${e.chartId}/`:"/chart/",i=new URL(t,location.href);return e.symbol&&i.searchParams.append("symbol",e.symbol),e.interval&&i.searchParams.append("interval",e.interval),e.style&&i.searchParams.append("style",e.style),(0,r.urlWithMobileAppParams)(i.href)}},605500:(e,t,i)=>{"use strict";i.d(t,{disableSnowplowTrackingEvents:()=>s,isSnowplowTrackingEnabled:()=>n});let r=!1;function n(){return!r}function s(){r=!0}},975774:(e,t,i)=>{"use strict";i.d(t,{loadThemeOnChartInitialization:()=>o});var r=i(295977),n=i(308721),s=i(926209);async function o(e){await Promise.all(e.getAll().map(r.waitForModel));const t=(0,n.getCurrentTheme)().name;if(!e.chartModels().value().some((e=>null===e.model().getThemeNameIfStdTheme()))){const i=e.activeChartWidget.value().model().model().getThemeNameIfStdTheme();null!==i&&i!==t&&(0,s.loadTheme)(e,{themeName:t,standardTheme:!0,noUndo:!0})}}},909740:(e,t,i)=>{"use strict";i.d(t,{setTheme:()=>n,watchedTheme:()=>r});const r=new(i(77294).WatchedValue);function n(e){r.setValue(e)}r.subscribe((e=>{!function(e,t=window){const i="theme-"+e,r=t.document.documentElement.classList;for(const e of Array.from(r))e.startsWith("theme-")&&e!==i&&r.remove(e);r.add(i),t.document.documentElement.dataset.theme=e}(e,window)}))},131089:(e,t,i)=>{"use strict";i.d(t,{uploadSnapshot:()=>n});var r=i(954912);async function n(e,t,i){const n=JSON.stringify({panes:[{content:e,contentWidth:t,contentHeight:i,leftAxis:{contentWidth:0},rightAxis:{contentWidth:0}}],timeAxis:{contentWidth:0,contentHeight:0,lhsStub:{contentWidth:0},rhsStub:{contentWidth:0}}}),s=new FormData;s.append("images",n);try{const e=await(0,r.fetch)("/snapshot/",{body:s,method:"POST",credentials:"same-origin"}),t=await e.text();return e.ok?`${location.protocol}//${location.host}/x/${t}`:""}catch(e){return""}}},812352:(e,t,i)=>{"use strict";i.d(t,{getLocale:()=>a,getLocaleIso:()=>l,getLocales:()=>o});var r=i(650151),n=i(505482);const s=function(){const e=document.querySelectorAll("link[rel~=link-locale][data-locale]");if(0===e.length)return n;const t={};return e.forEach((e=>{const i=(0,r.ensureNotNull)(e.getAttribute("data-locale"));t[i]={...n[i],href:e.href}})),t}();function o(){return s}function a(e){return e=e||window.locale,s[e]}function l(e){
return e=e||window.locale,s[e]?.iso}},332450:(e,t,i)=>{"use strict";i.d(t,{CLOSE_POPUPS_AND_DIALOGS_COMMAND:()=>r,breakpointList:()=>n});const r="CLOSE_POPUPS_AND_DIALOGS_COMMAND",n=[1920,1440,1280,1024,768,480,0]},497763:(e,t,i)=>{"use strict";i.d(t,{OLD_SERIES_COLORS:()=>s,SERIES_COLORS:()=>n,getColorByIndex:()=>a,getItemByIndex:()=>o});var r=i(790188);const n=[r.colorsPalette["color-tv-blue-400"],r.colorsPalette["color-iguana-green-a700"],r.colorsPalette["color-tan-orange-500"],r.colorsPalette["color-sky-blue-400"],r.colorsPalette["color-berry-pink-a700"],r.colorsPalette["color-banana-yellow-700"],r.colorsPalette["color-minty-green-a400"],r.colorsPalette["color-berry-pink-a200"],r.colorsPalette["color-tv-blue-a100"],r.colorsPalette["color-grapes-purple-a700"],r.colorsPalette["color-ripe-red-a400"],r.colorsPalette["color-minty-green-500"],r.colorsPalette["color-grapes-purple-a100"],r.colorsPalette["color-deep-blue-a200"],r.colorsPalette["color-tan-orange-800"]],s=[r.colorsPalette["color-tv-blue-a200"],r.colorsPalette["color-sky-blue-300"],r.colorsPalette["color-banana-yellow-900"],r.colorsPalette["color-deep-blue-a100"],r.colorsPalette["color-banana-yellow-700"],r.colorsPalette["color-tv-blue-300"],r.colorsPalette["color-grapes-purple-a100"],r.colorsPalette["color-tv-blue-400"],r.colorsPalette["color-minty-green-300"],r.colorsPalette["color-berry-pink-300"],r.colorsPalette["color-tv-blue-a100"],r.colorsPalette["color-tan-orange-a200"],r.colorsPalette["color-iguana-green-400"],r.colorsPalette["color-ripe-red-400"],r.colorsPalette["color-sky-blue-300"],r.colorsPalette["color-banana-yellow-600"],r.colorsPalette["color-berry-pink-a200"],r.colorsPalette["color-tv-blue-200"],r.colorsPalette["color-banana-yellow-900"]];function o(e,t){const i=e[t%e.length];return i||e[0]}function a(e,t=n){return o(t,e)}},647013:(e,t,i)=>{"use strict";i.d(t,{IndicatorsPreloader:()=>a});var r=i(282312),n=i(884934),s=i(604061),o=i(808648);class a{constructor(e={}){this._options=e}getIndicatorPromises(){const{javaStudies:e=!0,standardScripts:t=!0,candlestickScripts:i=!0,publicPineStudies:a=!0,trendingStudies:l=!0,editorsPicksStudies:c=!0,storeStudies:d=!0,financials:h=!0,userScripts:u=!0,personalAccessScripts:g=!0}=this._options,_=this._initIndicatorsPromises?.javaStudiesPromise??(e?(0,s.requestBuiltInJavaStudies)():void 0),p=this._initIndicatorsPromises?.standardScriptsPromise??(t?(0,n.requestBuiltinScripts)():void 0),m=this._initIndicatorsPromises?.candlestickScriptsPromise??(i?(0,r.requestCandlestickScripts)():void 0),v=this._initIndicatorsPromises?.publicPineStudiesPromise??(a?(0,s.fetchPublicPineStudies)((0,s.createPublicStudiesRequestParams)("top")):void 0),S=this._initIndicatorsPromises?.trendingStudiesPromise??(l?(0,s.fetchPublicPineStudies)((0,s.createPublicStudiesRequestParams)("trending")):void 0),f=this._initIndicatorsPromises?.editorsPicksStudiesPromise??(c?(0,s.fetchEditorsPicksStudies)():void 0),y=this._initIndicatorsPromises?.storeStudiesPromise??(d?(0,s.fetchPublicPineStudies)((0,
s.createPublicStudiesRequestParams)(void 0,!0)):void 0),b=this._initIndicatorsPromises?.addonsPromise,w=this._initIndicatorsPromises?.financialsPromise??(h?(0,o.getFinancialsViewItems)():void 0),C=this._initIndicatorsPromises?.personalAccessScriptsPromise??(g?(0,s.fetchPersonalAccessScripts)():void 0),T=u?(0,n.requestUserScripts)():void 0;return this._initIndicatorsPromises={javaStudiesPromise:_,userScriptsPromise:T,standardScriptsPromise:p,candlestickScriptsPromise:m,publicPineStudiesPromise:v,trendingStudiesPromise:S,addonsPromise:b,editorsPicksStudiesPromise:f,financialsPromise:w,storeStudiesPromise:y,personalAccessScriptsPromise:C},this._initIndicatorsPromises}}},604061:(e,t,i)=>{"use strict";i.d(t,{createPublicStudiesRequestParams:()=>c,fetchEditorsPicksStudies:()=>o,fetchLoadMorePublicStudies:()=>l,fetchPersonalAccessScripts:()=>a,fetchPublicPineStudies:()=>s,requestBuiltInJavaStudies:()=>d});var r=i(954912),n=i(163263);async function s(e){return(await(0,r.fetch)(`/pubscripts-library/?${e}`)).json()}async function o(){return(await(0,r.fetch)("/pubscripts-library/editors-picks/")).json()}async function a(){return(await(0,r.fetch)("/pubscripts-get/personal-access")).json()}async function l(e){return(await(0,r.fetch)(e)).json()}function c(e,t){const i={offset:0,count:20,type:0};void 0!==e&&(i.sort=e),void 0!==t&&(i.is_paid=t);return new URLSearchParams(Object.entries(i)).toString()}function d(){return(0,n.studyMetaInfoRepository)().findAllJavaStudies()}},988534:(e,t,i)=>{"use strict";i.d(t,{FinancialsDialogController:()=>s});var r=i(188414);let n;class s extends r.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){this._dialog?.hide()}static getInstance(){return n||(n=new s),n}_load(e){return Promise.all([i.e(60866),i.e(67240),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(55629),i.e(10727),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(53924),i.e(6563),i.e(30783),i.e(31481),i.e(17353),i.e(29573),i.e(78335),i.e(66029),i.e(7256),i.e(69295),i.e(53054),i.e(84794),i.e(15984),i.e(94891),i.e(35009),i.e(52350),i.e(97677),i.e(51711),i.e(36147),i.e(14731),i.e(89923),i.e(99397),i.e(45492),i.e(17760),i.e(55469),i.e(96621),i.e(12532),i.e(87950),i.e(20014),i.e(81469),i.e(84427),i.e(57434),i.e(64586),i.e(83999),i.e(72578),i.e(49294),i.e(31868),i.e(35387),i.e(84465),i.e(37732),i.e(3430),i.e(3105),i.e(39828),i.e(37737),i.e(54393),i.e(71497),i.e(95710),i.e(82298),i.e(15159),i.e(72386),i.e(88867),i.e(56664),i.e(10742),i.e(17611),i.e(60891),i.e(69601),i.e(96029),i.e(99667),i.e(15816),i.e(42508),i.e(88044),i.e(57762),i.e(41092),i.e(63664),i.e(21872),i.e(7646),i.e(81730),i.e(54450),i.e(3140),i.e(19729),i.e(77926),i.e(32227),i.e(48454),i.e(59008),i.e(93524),i.e(74570),i.e(15418),i.e(93647),i.e(95759),i.e(82242),i.e(41339),i.e(37047),i.e(95522),i.e(66144),i.e(86099),i.e(52158),i.e(11785),i.e(24878)]).then(i.bind(i,571592)).then((t=>(this._dialog?.hide(),
this._dialog?.visible().unsubscribe(this._subscribe),this._dialog=new t.FinancialsDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog)))}}},316478:(e,t,i)=>{"use strict";i.d(t,{ForecastDialogController:()=>o});var r=i(188414),n=i(202373);let s;class o extends r.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){this._dialog?.hide()}async canBeShown(e){const t=e||n.linking.proSymbol.value(),r=new Set(["recommendation_mark","pro_name"]),s=await(async()=>{const{snapshoter:e}=await i.e(62495).then(i.bind(i,960669));return e().getSnapshot(t,r)})();return!("error"===s.status||!s.values.recommendation_mark)}static getInstance(){return s||(s=new o),s}_load(e){return Promise.all([i.e(10832),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(55629),i.e(31697),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(6563),i.e(17353),i.e(29573),i.e(78335),i.e(66029),i.e(84794),i.e(15984),i.e(94891),i.e(35009),i.e(52350),i.e(36147),i.e(14731),i.e(89923),i.e(17760),i.e(55469),i.e(96621),i.e(87950),i.e(84427),i.e(26630),i.e(83999),i.e(72578),i.e(49294),i.e(59078),i.e(35387),i.e(84465),i.e(3430),i.e(54393),i.e(15159),i.e(56664),i.e(17611),i.e(89048),i.e(94395),i.e(96029),i.e(99667),i.e(15816),i.e(42508),i.e(85835),i.e(88044),i.e(91723),i.e(82263),i.e(78429),i.e(82659),i.e(83582),i.e(32227),i.e(2920),i.e(74570),i.e(15418),i.e(93647),i.e(95759),i.e(82242),i.e(41339),i.e(56301),i.e(33076),i.e(85080)]).then(i.bind(i,231078)).then((t=>(this._dialog?.hide(),this._dialog?.visible().unsubscribe(this._subscribe),this._dialog=new t.ForecastDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog)))}}},290382:(e,t,i)=>{"use strict";i.d(t,{SymbolSearchUI:()=>o});var r=i(650151),n=i(459582),s=i(202373);class o{async show(e){if(null!==o._provider){const e=await o._provider.getSymbol();return s.linking.setSymbolAndLogInitiator(e.symbol,"symbol search UI"),e}if(o._currentShowingInstance)throw new DOMException("SymbolSearchUI is already shown","InvalidStateError");try{o._currentShowingInstance=this,o.preload();const t=await o._implementation;return(0,r.assert)(null!==t),new Promise((i=>{t.showDefaultSearchDialog({...e,onSearchComplete:e=>{i({symbol:e})}})}))}finally{o._currentShowingInstance=null}}static setProvider(e){this._provider=e}static preload(){null===this._provider&&null===this._implementation&&(this._implementation=(0,n.loadNewSymbolSearch)())}}o._currentShowingInstance=null,o._provider=null,o._implementation=null},163639:e=>{e.exports={"css-value-header-toolbar-height":"38px"}},52877:e=>{e.exports={"top-left-button-height":"38px","top-left-button-width":"52px"}},21889:e=>{e.exports={"top-left-button-height":"38px","top-left-button-width":"52px",topLeftButton:"topLeftButton-hCWTCWBf",stub:"stub-hCWTCWBf"}},758893:(e,t,i)=>{"use strict";i.d(t,{backend:()=>U});var r={};i.r(r),i.d(r,{favorStandardStudyTemplate:()=>D,favorStudyTemplate:()=>E,getCharts:()=>y,getChartsCount:()=>b,
getDrawingTemplates:()=>N,getStandardStudyTemplateById:()=>R,getStudyTemplateById:()=>x,getStudyTemplatesList:()=>I,invalidateStudyTemplatesList:()=>W,loadDrawingTemplate:()=>F,loadLayout:()=>w,openLayoutLink:()=>C,removeChart:()=>P,removeDrawingTemplate:()=>V,removeStudyTemplate:()=>M,renameStudyTemplate:()=>k,replaceStudyTemplate:()=>O,saveChart:()=>T,saveDrawingTemplate:()=>B,saveStudyTemplate:()=>L});var n=i(283873),s=i(656130),o=i(476914);const a=(0,i(735566).getLogger)("Lib.AsyncGzip"),l=[];function c(e){let t;const r=new Promise(((r,n)=>{let s=setTimeout(n,5e3,new Error("Loading timed out"));t=l.pop()||new o.Worker(new URL(i.p+i.u(31482),i.b),{name:"Async gzip worker"}),t.onerror=n,t.onmessageerror=n,t.onmessage=e=>{clearTimeout(s),"done"===e.data.type?r(e.data.payload):s=setTimeout(n,3e4,new Error("Processing timed out"))},t.postMessage({type:"do",payload:e})}));return r.then((()=>{l.length<1?(delete t.onerror,delete t.onmessage,delete t.onmessageerror,l.push(t)):t.terminate()}),(e=>{a.logError(`Worker request failed: ${e.message}`),t.terminate()})),r}var d=i(954912);function h(e){if(e.ok)return e.json();throw new Error("not ok")}function u(e){if(e.ok)return e.json();throw new Error("not ok")}var g=i(314802),_=i(619459),p=i(163263),m=i(294721),v=i(763268),S=i(674377);const f="/api/v1/";async function y(e=null,t){const i=new URL("/my-charts/",window.location.origin);void 0!==t&&i.searchParams.append("limit",t.toString());const r=await(0,d.fetch)(i.toString(),{method:"GET",signal:e});if(!r.ok)throw new Error("Getting my charts response was not OK");return r.json()}async function b(){const e=await(0,d.fetch)(f+"charts/count/");if(!e.ok)throw e;return e.json()}async function w(e){const t=new URL(`/chart/${e.url}/json/`,window.location.origin),i=await(0,d.fetch)(t.toString(),{method:"GET",credentials:"same-origin"});if(!i.ok)throw i;let r;const s=await i.json();return r="undefined"===s.content?await async function(){const e=(0,p.studyMetaInfoRepository)();await e.requestMetaInfo();const t=await e.findById({type:"java",studyId:"Volume@tv-basicstudies"}),i=(0,v.prepareStudyProperties)(t,{},null,e.studyVersioning(),[]),r={m_priceRange:null,m_isAutoScale:!0,m_isPercentage:!1,m_isIndexedTo100:!1,m_isLog:!1,m_isLockScale:!1,m_isInverted:!1,m_topMargin:.1,m_bottomMargin:.08,alignLabels:!0};return{name:"",layout:"s",charts:[{panes:[{mode:S.PaneMode.Regular,sources:[{type:"MainSeries",id:"_seriesId",zorder:0,state:{...(new _.SeriesPropertiesImpl).state(),style:1,symbol:"NASDAQ:AAPL",shortName:"AAPL",timeframe:"",interval:"1M",unitId:null,timezone:"UTC",currencyId:null}},{type:"study_Volume",id:"nAALGd",state:i.state(),metaInfo:t.state()}],mainSourceId:"_seriesId",stretchFactor:2e3,leftAxisesState:[],rightAxisesState:[{state:{id:"H9o2zbZ0NTjL",...r},sources:["_seriesId"]}],overlayPriceScales:{nAALGd:{id:"H9o2zbZ0NTjL",...r}},priceScaleRatio:null,isCollapsed:!1,isMaximized:!1}],timeScale:{m_barSpacing:6,m_rightOffset:10},chartProperties:new m.DefaultProperty({defaultName:"chartproperties"}).state(),version:3,
timezone:"Etc/UTC",shouldBeSavedEvenIfHidden:!1,linkingGroup:null,lineToolsGroups:{groups:[]},chartId:"1"}],symbolLock:0,intervalLock:0,trackTimeLock:0,dateRangeLock:0,crosshairLock:1}}():JSON.parse(s.content),"content_study_meta"in s&&(0,n.default)(s.content_study_meta)&&(r.studyMetaInfoMap={...r.studyMetaInfoMap??{},...JSON.parse(s.content_study_meta)}),{name:s.name,chartWidgetCollectionState:r,uid:s.uid,lastModified:s.last_modified,id:s.id,description:s.description,username:s.username,isPrivate:s.is_private}}function C(e,t){const i=(0,s.generateChartUrl)({chartId:e.url}),r=document.createElement("a");r.href=i,!(0,g.isOnMobileAppPage)("new")&&/^\/chart(\/|$)/.test(location.pathname)&&(r.target=t?"_blank":"_self",r.rel="noopener"),r.click()}async function T(e,t,i,r){let n,s;try{[n,s]=await Promise.all([c(r.content),r.study_meta_info_map?c(r.study_meta_info_map):Promise.resolve(r.study_meta_info_map)])}catch(e){}const o=new FormData;for(const e in r)"content"===e&&n?o.append(e,new Blob([n],{type:"application/gzip"}),"blob.gz"):"study_meta_info_map"===e&&s?o.append(e,new Blob([s],{type:"application/gzip"}),"blob.gz"):o.append(e,r[e]);const a=await(0,d.fetch)("/savechart/",{method:"POST",credentials:"same-origin",body:o});if(!a.ok)throw a;return{result:await a.text(),response:a}}function P(e){return(0,d.fetch)(f+"charts/delete/",{method:"POST",credentials:"same-origin",body:JSON.stringify({uid:[e]}),headers:new Headers({"Content-Type":"application/json"})}).then((e=>{if(!e.ok)throw e;return e.json()})).then((e=>{if(e.error)throw e.error}))}let A=null;function I(){return null===A&&(A=(0,d.fetch)("/api/v1/study-templates",{credentials:"same-origin"}).then(h).then((e=>{const t=e.custom||[],i=e.standard||[],r=e.fundamentals||[],n=new Set([...i,...r].map((e=>e.name))),s=t.map((e=>({...e,is_default:!1,is_fundamental:!1,favorite_date:e.favorite_date?new Date(e.favorite_date).getTime():null})));for(const e of s)n.delete(e.name);const o=i.filter((e=>n.has(e.name))).map((e=>({...e,is_default:!0,is_fundamental:!1,favorite_date:e.favorite_date?new Date(e.favorite_date).getTime():null}))),a=r.filter((e=>n.has(e.name))).map((e=>({...e,is_default:!0,is_fundamental:!0,favorite_date:e.favorite_date?new Date(e.favorite_date).getTime():null})));return[...s,...o,...a]}))),A}function W(){A=null}function L(e){return t={name:e.name,content:e.content,meta_info:e.meta_info||{indicators:[]}},(0,d.fetch)("/api/v1/study-templates",{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(e.ok)return e.json().then((e=>({result:e})));switch(e.status){case 403:return e.json().then((e=>({error:e.code})));case 422:return e.json().then((e=>({error:e.code,id:e.id})));default:throw new Error("not ok")}}));var t}function E(e,t,i){(function(e,t){return(0,d.fetch)(`/api/v1/study-templates/${e}/favorite`,{credentials:"same-origin",method:t?"POST":"DELETE"}).then(h)})(e,t).then((e=>{i?.(e?.favorite_date?new Date(e.favorite_date).getTime():null)}))}function D(e,t,i){(function(e,t){return(0,
d.fetch)(`/api/v1/study-templates/standard/${e}/favorite`,{credentials:"same-origin",method:t?"POST":"DELETE"}).then(h)})(e,t).then((e=>{i?.(e?.favorite_date?new Date(e.favorite_date).getTime():null)}))}function x(e){return function(e){return(0,d.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin"}).then(h)}(e)}function R(e,t){return function(e){return(0,d.fetch)(`/api/v1/study-templates/standard/${e}`,{credentials:"same-origin"}).then(h)}(e).then(t)}function M(e){return function(e){return(0,d.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin",method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("not ok")}))}(e)}function k(e,t,i){(function(e,t){return(0,d.fetch)(`/api/v1/study-templates/${e}/rename/`,{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(h)})(e,{name:t}).then(i)}function O(e,t,i){(function(e,t){return(0,d.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(h)})(e,{name:t.name,content:t.content,meta_info:t.meta_info||{indicators:[]}}).then((e=>i({result:e})))}function N(e){return function(e){return(0,d.fetch)(`/drawing-templates/${e}/`,{credentials:"same-origin"}).then(u)}(e)}function B(e,t,i){return function(e,t,i){const r=new FormData;return r.append("name",t),r.append("tool",e),r.append("content",i),(0,d.fetch)("/save-drawing-template/",{method:"POST",credentials:"same-origin",body:r}).then(u)}(e,t,i)}function F(e,t){return async function(e,t){const i=await(0,d.fetch)(`/drawing-template/${e}/?templateName=${encodeURIComponent(t)}`,{credentials:"same-origin"}),r=await u(i);return JSON.parse(r.content)}(e,t)}function V(e,t){return function(e,t){const i=new FormData;return i.append("name",t),i.append("tool",e),(0,d.fetch)("/remove-drawing-template/",{method:"POST",credentials:"same-origin",body:i}).then(u)}(e,t)}const U=r},312941:(e,t,i)=>{"use strict";i.d(t,{closeMobileChartPickerCommand:()=>n,openMobileChartPickerCommand:()=>r});const r="OPEN_MOBILE_CHART_PICKER_COMMAND",n="CLOSE_MOBILE_CHART_PICKER_COMMAND"},933146:(e,t,i)=>{"use strict";i.d(t,{TOOLBAR_WIDTH_EXPANDED:()=>r});const r=52},544525:(e,t,i)=>{"use strict";i.d(t,{DrawingToolbarBootloader:()=>a});var r=i(404365),n=i(933146),s=i(510013),o=i(477600);class a extends s.ChunkLoader{constructor(e){super(),this._opts=e,r.isDrawingToolbarVisible.value()&&(this._opts.resizerBridge.negotiateWidth(n.TOOLBAR_WIDTH_EXPANDED),this._opts.resizerBridge.container.value().appendChild((0,o.createStubElem)()))}_startLoading(){
return Promise.all([i.e(53649),i.e(85615),i.e(41881),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(30783),i.e(29573),i.e(78335),i.e(69295),i.e(69069),i.e(43887),i.e(50876),i.e(46770),i.e(65284),i.e(73688),i.e(43868),i.e(63171),i.e(46321),i.e(434),i.e(55214),i.e(89342),i.e(24787),i.e(97341),i.e(37093),i.e(94869),i.e(82945),i.e(63653),i.e(91847),i.e(16333),i.e(45015),i.e(32227),i.e(87473),i.e(23298),i.e(91890),i.e(52641),i.e(58319),i.e(12878)]).then(i.bind(i,305517)).then((e=>new e.DrawingToolbarRenderer(this._opts.resizerBridge.container.value(),{...this._opts})))}}},404365:(e,t,i)=>{"use strict";i.d(t,{isDrawingToolbarVisible:()=>l});var r=i(62802),n=i(687037),s=i(77294);const o=!n.enabled("hide_left_toolbar_by_default"),a=r.getBool("ChartDrawingToolbarWidget.visible",o),l=new s.WatchedValue(a)},470680:(e,t,i)=>{"use strict";i.d(t,{HeaderToolbarBootloader:()=>o});var r=i(211848),n=i(477600),s=i(510013);class o extends s.ChunkLoader{constructor(e,t){super(),this._toolsBootloader=e,this._headerProps=t,this._headerProps.resizerBridge.negotiateHeight(r.HEADER_TOOLBAR_HEIGHT_EXPANDED),this._headerProps.resizerBridge.container.value().appendChild((0,n.createStubElem)())}_startLoading(){return Promise.all([this._toolsBootloader.load(),this._loadHeaderToolbar()]).then((([e,t])=>new t(this._headerProps.resizerBridge.container.value(),{...this._headerProps,tools:e})))}_loadHeaderToolbar(){return Promise.all([i.e(48161),i.e(75307),i.e(61161),i.e(32227),i.e(63005)]).then(i.bind(i,479969)).then((e=>e.HeaderToolbarRenderer))}}},211848:(e,t,i)=>{"use strict";i.d(t,{HEADER_TOOLBAR_HEIGHT_COLLAPSED:()=>s,HEADER_TOOLBAR_HEIGHT_EXPANDED:()=>n});var r=i(163639);const n=parseInt(r["css-value-header-toolbar-height"]),s=3},566647:(e,t,i)=>{"use strict";i.d(t,{recentStudyTemplatesService:()=>l});var r=i(481251),n=i(547426),s=i(226722),o=i(62802);class a extends n.CommonJsonStoreService{constructor(e,t){super(e,t,"RECENT_STUDY_TEMPLATES_CHANGED","StudyTemplates.recent",[])}remove(e){this.set(this.get().filter((t=>t!==e)))}add(e){const t=this.get().filter((t=>e!==t)),i=[e,...t].slice(0,5);this.set(i)}}const l=(0,r.default)((()=>new a(s.TVXWindowEvents,o)))},746262:(e,t,i)=>{"use strict";i.d(t,{RangeBinding:()=>w});var r=i(251924),n=i(357517),s=i(444372),o=i(666310),a=i(535861);const l={[(0,a.stringAsResolution)("1")]:{resolution:(0,a.stringAsResolution)("1"),text:(0,a.minutesStringLiteral)(1)},[(0,a.stringAsResolution)("3")]:{resolution:(0,a.stringAsResolution)("3"),text:(0,a.minutesStringLiteral)(3)},[(0,a.stringAsResolution)("5")]:{resolution:(0,a.stringAsResolution)("5"),text:(0,a.minutesStringLiteral)(5)},[(0,a.stringAsResolution)("15")]:{resolution:(0,a.stringAsResolution)("15"),text:(0,a.minutesStringLiteral)(15)},[(0,a.stringAsResolution)("30")]:{resolution:(0,a.stringAsResolution)("30"),text:(0,a.minutesStringLiteral)(30)},[(0,a.stringAsResolution)("45")]:{resolution:(0,a.stringAsResolution)("45"),text:(0,a.minutesStringLiteral)(45)},[(0,a.stringAsResolution)("60")]:{resolution:(0,a.stringAsResolution)("60"),text:(0,
a.hoursStringLiteral)(1)},[(0,a.stringAsResolution)("120")]:{resolution:(0,a.stringAsResolution)("120"),text:(0,a.hoursStringLiteral)(2)},[(0,a.stringAsResolution)("180")]:{resolution:(0,a.stringAsResolution)("180"),text:(0,a.hoursStringLiteral)(3)},[(0,a.stringAsResolution)("240")]:{resolution:(0,a.stringAsResolution)("240"),text:(0,a.hoursStringLiteral)(4)},[(0,a.stringAsResolution)("1D")]:{resolution:(0,a.stringAsResolution)("1D"),text:(0,a.daysStringLiteral)(1)},[(0,a.stringAsResolution)("1W")]:{resolution:(0,a.stringAsResolution)("1W"),text:(0,a.weeksStringLiteral)(1)},[(0,a.stringAsResolution)("1M")]:{resolution:(0,a.stringAsResolution)("1M"),text:(0,a.monthsStringLiteral)(1)},[(0,a.stringAsResolution)("3M")]:{resolution:(0,a.stringAsResolution)("3M"),text:(0,a.monthsStringLiteral)(3)},[(0,a.stringAsResolution)("6M")]:{resolution:(0,a.stringAsResolution)("6M"),text:(0,a.monthsStringLiteral)(6)},[(0,a.stringAsResolution)("12M")]:{resolution:(0,a.stringAsResolution)("12M"),text:(0,a.yearsStringLiteral)(1)}};function c(e){const t=function(e){const t=e.value.value,r=o.Interval.parse(t);if(!r.isValid()){if("YTD"===t)return s.t(null,{context:"timeframe_title"},i(119273));if("ALL"===t)return s.t(null,{context:"timeframe_title"},i(858221));if("LASTSESSION"===t)return u(1)}if(r.isMinutes()){const e=r.multiplier();return e%60!=0?d(e):h(e/60)}if(r.isDays())return u(r.multiplier());if(r.isWeeks())return g(r.multiplier());if(r.isMonths()){const e=r.multiplier();return e%12!=0?_(e):p(e/12)}return e.description||e.text}(e),r=function(e){const t=e.targetResolution,i=o.Interval.parse(t);if(i.isMinutes()){const e=i.multiplier();return e%60!=0?m(e):v(e/60)}if(i.isDays())return S(i.multiplier());if(i.isWeeks())return f(i.multiplier());if(i.isMonths()){const e=i.multiplier();return e%12!=0?y(e):b(e/12)}return l[t].text}(e);return s.t(null,{replace:{timePeriod:t,timeInterval:r},context:"timeframe_title"},i(458426))}const d=e=>s.t(null,{plural:"{str} minutes",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(995484)),h=e=>s.t(null,{plural:"{str} hours",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(772495)),u=e=>s.t(null,{plural:"{str} days",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(263808)),g=e=>s.t(null,{plural:"{str} weeks",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(6088)),_=e=>s.t(null,{plural:"{str} months",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(712752)),p=e=>s.t(null,{plural:"{str} years",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(396325)),m=e=>s.t(null,{plural:"{str} minutes intervals",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(815489)),v=e=>s.t(null,{plural:"{str} hours intervals",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(414887)),S=e=>s.t(null,{plural:"{str} days intervals",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(300561)),f=e=>s.t(null,{plural:"{str} weeks intervals",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(960316)),y=e=>s.t(null,{plural:"{str} months intervals",count:e,
replace:{str:`${e}`},context:"timeframe_title"},i(548514)),b=e=>s.t(null,{plural:"{str} years intervals",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(278971));class w{constructor(e){this._state={ranges:[]},this._firstBarTime1D=null,this._waitingUpdateAfterSymbolResolved=!0,this._change=new r.Delegate,this._rangeChangedListenerBound=this._onRangeChanged.bind(this);const{chartWidget:t}=this._context=e;t.withModel(null,(()=>{const e=t.model(),i=e.mainSeries();i.onStatusChanged().subscribe(this,this._updateAvailableRanges),i.dataEvents().symbolResolved().subscribe(this,(()=>this._updateRangesByQuotesData())),i.priceScale().properties().childs().lockScale.subscribe(this,(()=>this._updateAvailableRanges()));const r=e.model().appliedTimeFrame();r.subscribe(this._rangeChangedListenerBound),this._rangeChangedListenerBound(r.value()),this._updateRangesByQuotesData()}))}state(){return this._state}onChange(){return this._change}selectRange(e){this._setState({activeRange:e.value.value});const{chartWidgetCollection:t}=this._context,i={val:e.value,res:e.targetResolution};t.setTimeFrame(i)}destroy(){const{chartWidget:e}=this._context;e.withModel(null,(()=>{const t=e.model(),i=t.mainSeries();i.onStatusChanged().unsubscribeAll(this),i.dataEvents().symbolResolved().unsubscribeAll(this),i.quotesProvider().quotesUpdate().unsubscribeAll(this),i.priceScale().properties().childs().lockScale.unsubscribeAll(this),t.model().appliedTimeFrame().unsubscribe(this._rangeChangedListenerBound)})),this._change.destroy(),this._lastAbortController?.abort()}_setState(e){this._state=Object.assign({},this._state,e),this._change.fire(this._state)}_onRangeChanged(e){let t;null!==e&&"period-back"===e.val.type&&(t=e.val.value),this._setState({activeRange:t})}_updateRangesByQuotesData(){const{chartWidget:e}=this._context;if(!e.hasModel())return;this._lastAbortController?.abort();const t=new AbortController;this._lastAbortController=t;const i=e.model().mainSeries();i.quotesProvider().quotesUpdate().unsubscribeAll(this),this._waitingUpdateAfterSymbolResolved=!0,this._firstBarTime1D=null,Promise.race([(0,n.delay)(null,3e3),new Promise((e=>{const t=()=>{void 0!==i.quotes()?.open_price&&(i.quotesProvider().quotesUpdate().unsubscribeAll(this),e())};i.quotesProvider().quotesUpdate().subscribe(this,t),t()}))]).then((()=>{t.signal.aborted||(this._waitingUpdateAfterSymbolResolved=!1,this._updateAvailableRanges())}))}_updateAvailableRanges(e){const{availableTimeFrames:t,chartWidget:i}=this._context;if(!i.hasModel())return;const r=i.model().mainSeries(),n=r.symbolInfo(),s=r.status();if(2===s||1===s||this._waitingUpdateAfterSymbolResolved||e&&!n)return;const o=r.quotes()?.first_bar_time_1d??-1/0;if(this._firstBarTime1D===o)return;this._firstBarTime1D=o;const a=t(n,s,o).map((e=>({...e,description:c(e)})));this._setState({ranges:a})}}},733097:(e,t,i)=>{"use strict";i.d(t,{TopLeftButtonBootloader:()=>l});var r=i(510013),n=i(52877);const s=parseInt(n["top-left-button-height"]),o=parseInt(n["top-left-button-width"]);var a=i(21889);class l extends r.ChunkLoader{
constructor(e){super(),this._props=e,this._props.resizerBridge.negotiateHeight(s),this._props.resizerBridge.negotiateWidth(o),this._props.resizerBridge.container.value().appendChild(function(){const e=document.createElement("div");return e.classList.add(a.topLeftButton,a.stub),e}())}_startLoading(){return this._loadRenderer().then((e=>new e(this._props.resizerBridge.container.value(),this._props)))}_loadRenderer(){return Promise.all([i.e(79964),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(91478),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(53924),i.e(30783),i.e(98567),i.e(31481),i.e(29573),i.e(78335),i.e(73438),i.e(20934),i.e(70815),i.e(66029),i.e(7256),i.e(19981),i.e(84794),i.e(94891),i.e(35009),i.e(51711),i.e(20693),i.e(55469),i.e(96621),i.e(69069),i.e(43887),i.e(24313),i.e(50876),i.e(57369),i.e(3113),i.e(45588),i.e(31868),i.e(65729),i.e(37732),i.e(65284),i.e(73688),i.e(43868),i.e(13280),i.e(36163),i.e(94521),i.e(98066),i.e(92161),i.e(28304),i.e(13647),i.e(79768),i.e(39258),i.e(40853),i.e(19854),i.e(55214),i.e(89342),i.e(59917),i.e(17512),i.e(36817),i.e(38253),i.e(35393),i.e(79243),i.e(19301),i.e(9583),i.e(40719),i.e(24787),i.e(24770),i.e(91315),i.e(37093),i.e(36795),i.e(94965),i.e(32227),i.e(12831),i.e(36978),i.e(90223),i.e(65805),i.e(18266),i.e(51008),i.e(85420),i.e(88423),i.e(68207),i.e(39863)]).then(i.bind(i,963099)).then((e=>e.TopLeftButtonRenderer))}}},456677:(e,t,i)=>{"use strict";i.d(t,{isSupportedLineTool:()=>s,supportedLineTools:()=>o});var r=i(638456),n=i(125226);function s(e){return e in o}const o={cursor:{name:"cursor",onlySelectable:!0},dot:{name:"dot",onlySelectable:!0},arrow_cursor:{name:"arrow",onlySelectable:!0},eraser:{name:"eraser",onlySelectable:!0},measure:{name:"measure",onlySelectable:!0},zoom:{name:"zoom",onlySelectable:!0},brush:{name:"LineToolBrush"},highlighter:{name:"LineToolHighlighter"},text:{name:"LineToolText"},anchored_text:{name:"LineToolTextAbsolute",isAnchored:!0},note:{name:"LineToolNote"},text_note:{name:"LineToolTextNote"},anchored_note:{name:"LineToolNoteAbsolute",isAnchored:!0},signpost:{name:"LineToolSignpost"},callout:{name:"LineToolCallout"},balloon:{name:"LineToolBalloon"},comment:{name:"LineToolComment"},arrow_up:{name:"LineToolArrowMarkUp"},arrow_down:{name:"LineToolArrowMarkDown"},arrow_left:{name:"LineToolArrowMarkLeft"},arrow_right:{name:"LineToolArrowMarkRight"},price_label:{name:"LineToolPriceLabel"},price_note:{name:"LineToolPriceNote"},arrow_marker:{name:"LineToolArrowMarker"},flag:{name:"LineToolFlagMark"},image:{name:"LineToolImage"},table:{name:"LineToolTable"},vertical_line:{name:"LineToolVertLine"},horizontal_line:{name:"LineToolHorzLine"},cross_line:{name:"LineToolCrossLine"},horizontal_ray:{name:"LineToolHorzRay"},trend_line:{name:"LineToolTrendLine"},info_line:{name:"LineToolInfoLine"},trend_angle:{name:"LineToolTrendAngle"},arrow:{name:"LineToolArrow"},ray:{name:"LineToolRay"},extended:{name:"LineToolExtended"},parallel_channel:{name:"LineToolParallelChannel"},disjoint_angle:{
name:"LineToolDisjointAngle"},flat_bottom:{name:"LineToolFlatBottom"},anchored_vwap:{name:"LineToolAnchoredVWAP"},pitchfork:{name:"LineToolPitchfork"},schiff_pitchfork_modified:{name:"LineToolSchiffPitchfork"},schiff_pitchfork:{name:"LineToolSchiffPitchfork2"},inside_pitchfork:{name:"LineToolInsidePitchfork"},pitchfan:{name:"LineToolPitchfan"},gannbox:{name:"LineToolGannSquare"},gannbox_square:{name:"LineToolGannComplex"},gannbox_fixed:{name:"LineToolGannFixed"},gannbox_fan:{name:"LineToolGannFan"},fib_retracement:{name:"LineToolFibRetracement"},fib_trend_ext:{name:"LineToolTrendBasedFibExtension"},fib_speed_resist_fan:{name:"LineToolFibSpeedResistanceFan"},fib_timezone:{name:"LineToolFibTimeZone"},fib_trend_time:{name:"LineToolTrendBasedFibTime"},fib_circles:{name:"LineToolFibCircles"},fib_spiral:{name:"LineToolFibSpiral"},fib_speed_resist_arcs:{name:"LineToolFibSpeedResistanceArcs"},fib_wedge:{name:"LineToolFibWedge"},fib_channel:{name:"LineToolFibChannel"},xabcd_pattern:{name:"LineTool5PointsPattern"},cypher_pattern:{name:"LineToolCypherPattern"},abcd_pattern:{name:"LineToolABCD"},triangle_pattern:{name:"LineToolTrianglePattern"},"3divers_pattern":{name:"LineToolThreeDrivers"},head_and_shoulders:{name:"LineToolHeadAndShoulders"},elliott_impulse_wave:{name:"LineToolElliottImpulse"},elliott_triangle_wave:{name:"LineToolElliottTriangle"},elliott_triple_combo:{name:"LineToolElliottTripleCombo"},elliott_correction:{name:"LineToolElliottCorrection"},elliott_double_combo:{name:"LineToolElliottDoubleCombo"},cyclic_lines:{name:"LineToolCircleLines"},time_cycles:{name:"LineToolTimeCycles"},sine_line:{name:"LineToolSineLine"},long_position:{name:"LineToolRiskRewardLong"},short_position:{name:"LineToolRiskRewardShort"},forecast:{name:"LineToolPrediction"},date_range:{name:"LineToolDateRange"},price_range:{name:"LineToolPriceRange"},date_and_price_range:{name:"LineToolDateAndPriceRange"},bars_pattern:{name:"LineToolBarsPattern"},ghost_feed:{name:"LineToolGhostFeed"},projection:{name:"LineToolProjection"},rectangle:{name:"LineToolRectangle"},rotated_rectangle:{name:"LineToolRotatedRectangle"},circle:{name:"LineToolCircle"},ellipse:{name:"LineToolEllipse"},triangle:{name:"LineToolTriangle"},polyline:{name:"LineToolPolyline"},path:{name:"LineToolPath"},curve:{name:"LineToolBezierQuadro"},double_curve:{name:"LineToolBezierCubic"},arc:{name:"LineToolArc"},icon:{name:"LineToolIcon"},emoji:{name:"LineToolEmoji"},sticker:{name:"LineToolSticker"},regression_trend:{name:"LineToolRegressionTrend"},fixed_range_volume_profile:{name:"LineToolFixedRangeVolumeProfile"}};(0,n.isFeatureEnabled)("hide_tweet_drawingtool")||(o.tweet={name:"LineToolTweet"}),delete o.arrow_left,delete o.arrow_right,(0,r.isSymphonyEmbed)()||(o.idea={name:"LineToolIdea"}),o.anchored_volume_profile={name:"LineToolAnchoredVolumeProfile"}},382169:(e,t,i)=>{"use strict";i.d(t,{ChartChangesWatcher:()=>o,changedAll:()=>s});var r=i(157432),n=i(251924);const s=3;class o{constructor(e,t,i){this._contentHasChanges=!1,this._changesMask=0,this._handleLayoutNameChanged=()=>{
this.markContentAsChanged()},this._recalculateHaveChanges=()=>{const e=this._changesMask,t=this._contentHasChanges?1:0,i=this._lineToolsHaveChanges.value()?2:0;this._changesMask=t|i,e!==this._changesMask&&this._onValueChanged.fire(0!==this._changesMask)},this._chartWidgetCollection=e,this._undoHistory=e.undoHistory,this._lineToolsHaveChanges=e.lineToolsSynchronizerHasChanges,this._chartSaver=t,this._globalEvents=i,this._onValueChanged=new n.Delegate,this._hasChangesWV=(0,r.createWVFromGetterAndSubscription)((()=>this.hasChanges()),this.getOnChange()),this._subscribe()}destroy(){this._unsubscribe(),this._onValueChanged.destroy(),this._hasChangesWV.destroy()}changes(){return this._changesMask}hasChanges(){return this._changesMask>0}hasChangesWV(){return this._hasChangesWV}getOnChange(){return this._onValueChanged}markContentAsChanged(){this._contentHasChanges=!0,this._recalculateHaveChanges()}_subscribe(){this._globalEvents.subscribe("chart_loaded",this._handleChartLoaded,this),this._globalEvents.subscribe("layout_loaded",this._handleLayoutLoaded,this),this._globalEvents.subscribe("chart_migrated",this._handleChartMigrated,this),this._globalEvents.subscribe("lineToolsResavedFromContent",this._handleChartMigrated,this),this._undoHistory.undoStack().onChange().subscribe(this,this._handleUndoHistoryChange),this._chartSaver?.chartSaved().subscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.subscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.subscribe(this._handleLayoutNameChanged)}_unsubscribe(){this._globalEvents.unsubscribe("chart_loaded",this._handleChartLoaded,this),this._globalEvents.unsubscribe("layout_loaded",this._handleLayoutLoaded,this),this._globalEvents.unsubscribe("chart_migrated",this._handleChartMigrated,this),this._globalEvents.unsubscribe("lineToolsResavedFromContent",this._handleChartMigrated,this),this._undoHistory.undoStack().onChange().unsubscribe(this,this._handleUndoHistoryChange),this._chartSaver?.chartSaved().unsubscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.unsubscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.unsubscribe(this._handleLayoutNameChanged)}_setContentHasChanges(e){this._contentHasChanges=e,this._recalculateHaveChanges()}_handleChartLoaded(){this._setContentHasChanges(!1)}_handleLayoutLoaded(){this._setContentHasChanges(!1)}_handleUndoHistoryChange(e){e?.affectsState()&&this._setContentHasChanges(!0)}_handleChartMigrated(){this._setContentHasChanges(!0)}_handleChartSaved(e){e&&this._setContentHasChanges(!1)}}},361478:(e,t,i)=>{"use strict";i.d(t,{chartPageSoftRedirect:()=>n});var r=i(588948);function n(){if(!window.is_authenticated)return;if("/chart/"!==location.pathname&&"/chart"!==location.pathname)return;const{uid:e}=(0,r.getInitData)();if("string"!=typeof e||!/[0-9a-zA-Z]{8,}/.test(e))return void console.error("Invalid chart uid: "+e);const t=new URL(location.href);t.pathname=`/chart/${encodeURI(e)}/`,history.replaceState(history.state,document.title,t.href)}},295977:(e,t,i)=>{"use strict"
;i.d(t,{waitForModel:()=>r});const r=e=>new Promise((t=>{e.withModel(null,(()=>{t(e.model().model())}))}))},360176:(e,t,i)=>{"use strict";function r(e){return e.getAll().some((e=>e.isInitialized()))}function n(e,t){const i=e.getAll(),r=()=>{t(),i.forEach((e=>{e.chartWidgetInitialized().unsubscribe(null,r)}))};i.forEach((e=>{e.chartWidgetInitialized().subscribe(null,r,!0)}))}i.d(t,{isAnyChartWidgetInitialized:()=>r,waitAnyChartWidgetInitialized:()=>n})},745506:(e,t,i)=>{"use strict";i.d(t,{createFavoriteDrawingToolbar:()=>a,getFavoriteDrawingToolbarPromise:()=>o});var r=i(211848);let n=null,s=null;function o(){return s}function a(){null===s&&(s=Promise.all([i.e(71650),i.e(1283),i.e(85615),i.e(41881),i.e(58882),i.e(26628),i.e(55011),i.e(30783),i.e(98567),i.e(73438),i.e(69069),i.e(50876),i.e(30862),i.e(34489),i.e(59624),i.e(74884),i.e(98768),i.e(37682),i.e(10742),i.e(434),i.e(55214),i.e(38674),i.e(80814),i.e(88047),i.e(46057),i.e(16333),i.e(40064),i.e(32227),i.e(5483),i.e(91890),i.e(83648),i.e(22306)]).then(i.bind(i,961276)).then((({FavoriteDrawingToolbar:e})=>(n=null!==n?n:new e({left:window.innerWidth/2,top:r.HEADER_TOOLBAR_HEIGHT_EXPANDED+61}),n))))}},909814:(e,t,i)=>{"use strict";i.d(t,{autoplayDelayOptionItems:()=>s,findAutoplayDelayOptionItems:()=>o});var r=i(650151),n=i(444372);const s=[{label:"10x",description:n.t(null,void 0,i(172588)),value:100},{label:"7x",description:n.t(null,void 0,i(498583)),value:143},{label:"5x",description:n.t(null,void 0,i(475830)),value:200},{label:"3x",description:n.t(null,void 0,i(45648)),value:300},{label:"1x",description:n.t(null,void 0,i(866404)),value:1e3},{label:"0.5x",description:n.t(null,void 0,i(898636)),value:2e3},{label:"0.3x",description:n.t(null,void 0,i(816992)),value:3e3},{label:"0.2x",description:n.t(null,void 0,i(481558)),value:5e3},{label:"0.1x",description:n.t(null,void 0,i(624501)),value:1e4}];function o(e){const t=s.find((t=>t.value===e));return(0,r.assert)(void 0!==t,"This delay dosen't exist"),t}},421999:(e,t,i)=>{"use strict";i.d(t,{getReplayUiControllerInstance:()=>n});let r=null;function n(e,t){const n=i=>({controller:new i.ReplayUIController(e,t),createReplayWV:"createReplayWV"in i?i.createReplayWV:void 0})
;return r||(r=Promise.all([i.e(53956),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(55629),i.e(10727),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(30783),i.e(98567),i.e(31481),i.e(29573),i.e(73438),i.e(70815),i.e(66029),i.e(7256),i.e(19981),i.e(84794),i.e(14731),i.e(89923),i.e(99397),i.e(17760),i.e(55469),i.e(96621),i.e(12532),i.e(69069),i.e(81469),i.e(43887),i.e(57434),i.e(50876),i.e(78392),i.e(70526),i.e(3113),i.e(32496),i.e(83256),i.e(55973),i.e(46770),i.e(30862),i.e(65284),i.e(73688),i.e(43868),i.e(92161),i.e(28304),i.e(39258),i.e(22329),i.e(37682),i.e(88867),i.e(46321),i.e(85392),i.e(29367),i.e(51215),i.e(10742),i.e(97685),i.e(6998),i.e(89342),i.e(59542),i.e(47042),i.e(76606),i.e(30642),i.e(34530),i.e(17964),i.e(30198),i.e(80050),i.e(48299),i.e(88047),i.e(75307),i.e(67325),i.e(44048),i.e(82358),i.e(63480),i.e(32227),i.e(87473),i.e(94483),i.e(71986),i.e(93524),i.e(90223),i.e(45553),i.e(14454),i.e(32880),i.e(44670),i.e(52089),i.e(71951),i.e(66695),i.e(6932)]).then(i.bind(i,641205)).then(n)),r}},975717:(e,t,i)=>{"use strict";i.d(t,{checkAuthBeforeSaveLoad:()=>s});var r=i(687037),n=i(788469);function s(e,t){r.enabled("saveload_requires_authentication")?(0,n.runOrSigninWithFeature)(e,{...t,feature:"savedCharts"}):e()}},894218:(e,t,i)=>{"use strict";i.d(t,{FAVORITE_LAYOUTS_LIMIT:()=>n,favoriteLayoutsHintStateHandler:()=>s});var r=i(889110);const n=20,s=r.defaultHintStateHandler},265010:(e,t,i)=>{"use strict";i.d(t,{LoadChartService:()=>p});var r=i(444372),n=i(779923),s=i(687037),o=i(758893),a=i(975717),l=i(188414),c=i(77294),d=i(357517),h=i(954912),u=i(638456),g=i(894218);function _(){return!(s.enabled("saveload_requires_authentication")&&!window.is_authenticated)}class p extends l.DialogRenderer{constructor(e=null){super(),this._chartWidgetCollection=null,this._promise=null,this._dialog=null,this._onLoginStateChange=()=>{_()||this._setState({chartList:[],favorites:{},recents:[]})},this._onActiveChartNameChange=e=>{const{chartList:t}=this._state.value(),i=this._chartWidgetCollection;if(!i)return;const r=[];let n;t.forEach((t=>{if(t.id===i.metaInfo.id.value())return n=t,void r.push({...t,name:e});r.push(t)})),n&&this._setState({chartList:r})},this._subscribe=e=>{this._setVisibility(e)},this._getChartEntry=e=>({id:e.id,url:e.url,name:e.name,symbol:e.short_symbol,interval:e.interval,toolsCount:0,modified:e.modified_iso,favorite:e.favorite,active:()=>this._isActiveChart(e.id),openAction:(t,i)=>this.loadChart(e,t,i),deleteAction:()=>this._deleteChart(e),favoriteAction:()=>this._handleFavorite(e)}),this._isActiveChart=e=>null!==this._chartWidgetCollection&&e===this._chartWidgetCollection.metaInfo.id.value(),this._deleteChart=e=>o.backend.removeChart(e.image_url).then((()=>{const{chartList:t,favorites:i}=this._state.value(),r=t.filter((t=>t.id!==e.id));if(this._favoriteChartsService){const t={...i};t[e.id]&&delete t[e.id],this._favoriteChartsService.set(t)}_()&&this._setState({chartList:r}),this._isActiveChart(e.id)&&(s.enabled("saveload_storage_customization")||(0,
u.isSymphonyEmbed)()?null!==this._chartWidgetCollection&&this._chartWidgetCollection.clearChartMetaInfo():location.href="/chart/"+location.search)})),this._chartWidgetCollection=e;const t=this._favoriteChartsService?.get()||{};this._state=new c.WatchedValue({chartList:[],recents:[],favorites:t}),this._chartWidgetCollection?.metaInfo.name.subscribe(this._onActiveChartNameChange),window.loginStateChange.subscribe(null,this._onLoginStateChange)}showLoadDialog(){(0,a.checkAuthBeforeSaveLoad)(this._showLoadDialog.bind(this),{source:"Load chart",sourceMeta:"Chart"})}show(){this.showLoadDialog()}hide(){this._dialog?.hide(),this._dialog?.visible().unsubscribe(this._subscribe)}state(){return this._state.readonly()}refreshChartList(e){return(_()?o.backend.getCharts():Promise.resolve([])).then((t=>{if(!_())return;const i=t.map(this._getChartEntry);this._setState({chartList:i,favorites:this._initFavorites(i)}),void 0!==e&&e()}))}getRecentCharts(e){_()&&o.backend.getCharts(e,4).then((e=>{if(!_())return;const t=e.map(this._getChartEntry).sort(((e,t)=>t.modified-e.modified));this._setState({recents:t,favorites:{...this._state.value().favorites,...this._initFavorites(t)}})})).catch((e=>{(0,d.isAbortError)(e)}))}async deleteAllFavorites(){this._setState({favorites:{}}),await(0,h.fetch)("/my-charts/all/change-favorite-state/",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({favorite:!1})})}async loadChart(e,t,s){if(!(0,u.isSymphonyEmbed)()&&t)o.backend.openLayoutLink(e,t);else{function a(){if((0,u.isSymphonyEmbed)()){const t=new URL(window.location.href);return t.pathname=`/chart/${e.url}/`,t.searchParams.set("symphony","true"),t}return`/chart/${e.url}/`}const l=a(),c=async()=>{const t=await o.backend.loadLayout(e);await(this._chartWidgetCollection?.loadLayoutState(t)),window.history.replaceState(null,"",l)};if(!s&&this._chartWidgetCollection?.hasChanges().value()){if(!await new Promise((e=>{(0,n.showConfirm)({id:"unsaved-changes",title:r.t(null,void 0,i(788964)),content:r.t(null,void 0,i(285296)),mainButtonText:r.t(null,void 0,i(477049)),cancelButtonText:r.t(null,void 0,i(904543)),onConfirm:({dialogClose:t})=>{e(!0),t()},onCancel:({dialogClose:t})=>{e(!1),t()}})})))return}await c()}}async loadChartByUrl(e,t,i){let r=this._state.value().chartList.find((t=>t.url===e));r||(await this.refreshChartList(),r=this._state.value().chartList.find((t=>t.url===e))),await(r?.openAction(t,i))}async _handleFavorite(e){const{favorites:t}=this._state.value(),i={...t};i[e.id]?delete i[e.id]:i[e.id]=!0,await this._changeFavoriteState(i,e.id,e.image_url),_()&&this._setState({favorites:i})}_showLoadDialog(){this.refreshChartList((()=>{
const e=this._promise=Promise.all([i.e(45121),i.e(1283),i.e(85615),i.e(56224),i.e(41881),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(51711),i.e(36147),i.e(14731),i.e(89923),i.e(17760),i.e(49294),i.e(31868),i.e(65284),i.e(73688),i.e(3105),i.e(92161),i.e(72386),i.e(10742),i.e(434),i.e(55214),i.e(61680),i.e(36725),i.e(76476),i.e(8109),i.e(4895),i.e(71082),i.e(32227),i.e(87473),i.e(16085),i.e(34480),i.e(75009)]).then(i.bind(i,857109)).then((t=>{this._promise===e&&(this._dialog&&(this._dialog.hide(),this._dialog.visible().unsubscribe(this._subscribe)),this._dialog=new t.LoadChartDialogRenderer({chartWidgetCollection:this._chartWidgetCollection,serviceState:this.state()}),this._dialog.visible().subscribe(this._subscribe),this._dialog.show())}))}))}_setState(e){this._state.setValue({...this._state.value(),...e})}async _changeFavoriteState(e,t,i){const{favorites:r}=this._state.value(),n=Boolean(e[t]);g.favoriteLayoutsHintStateHandler.getHintState("hint.favoriteLayouts")&&Object.keys(r).length<=g.FAVORITE_LAYOUTS_LIMIT&&Object.keys(e).length>g.FAVORITE_LAYOUTS_LIMIT&&g.favoriteLayoutsHintStateHandler.setHintState("hint.favoriteLayouts"),await(0,h.fetch)(`/my-charts/${i}/change-favorite-state/`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({favorite:n})})}_initFavorites(e){const t={};return e.filter((e=>e.favorite)).forEach((e=>{t[e.id]=!0})),t}}},923995:(e,t,i)=>{"use strict";i.d(t,{SaveChartService:()=>R});var r=i(687037),n=i(77294),s=i(547426);class o extends s.CommonJsonStoreService{constructor(e,t){super(e,t,"AUTO_SAVE_ENABLED_CHANGED","Chart.autoSaveEnabled",!0)}}var a=i(226722),l=i(62802),c=i(975717),d=i(125226);i(7742);const h=r.enabled("atsv2s");var u=i(444372),g=i(954912),_=i(31214),p=i(229534),m=i(503595),v=i(314802);const S=u.t(null,void 0,i(211218)),f=u.t(null,void 0,i(796225)),y=u.t(null,void 0,i(491547));function b(e,t={}){window.runOrSignIn((()=>{(0,m.asyncWindowOpen)(async function(e,t){let i,r;try{r=await(0,g.fetch)(`/charts/${e}/clone/`,{method:"POST",body:JSON.stringify(t),credentials:"include"});const n=r.headers.get("location");if(r.ok&&n)return(0,v.urlWithMobileAppParams)(n);i=(await r.json()).code}catch{}"count_limit"===i||"login_required"===i?(0,_.reloginOrGoPro)({feature:"savedChartsLimit"}):r||!1!==navigator.onLine?r&&r.status>=500||"feature_disabled"===i?(0,p.showErrorDialog)({content:f}):(0,p.showErrorDialog)({content:S}):(0,p.showErrorDialog)({content:y});return}(e,t))}),{source:"Clone_chart_layout"})}var w=i(758893),C=i(400353);async function T(){if(!window.is_authenticated)return!1;if(!r.enabled("saved_charts_count_restriction"))return!0;const e=(0,C.getConfig)("CHART_STORAGE")?.limit;if(void 0===e||e<=0)return!1;try{return e>await w.backend.getChartsCount()}catch(e){if(403===e.status)return!1;throw e}}var P=i(779923);class A{constructor(e,t,i){this._visibility=new n.WatchedValue(!1),this._chartWidgetCollection=e,this._doSave=t,this._doLoad=i}hide(){this._hide?.(),this._visibility.setValue(!1)}visible(){
return this._visibility.readonly()}_showDialog(e,t,i,r){return(0,P.showRename)({title:this._dialogTitle(),text:this._dialogText(),maxLength:64,emojiPicker:!0,initValue:e,onRename:async e=>{this._actionHandler(e,t,i,r)},onClose:()=>this._visibility.setValue(!1)})}_doSaveCurrentLayout(e,t,i,r){const n=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.name.setValue(e),this._doSave(t,i,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(n),r?.()}))}_doOverwriteExistingLayout(e,t,i,r,n){const s=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.id.setValue(e),this._chartWidgetCollection.metaInfo.name.setValue(t),this._doSave(i,r,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(s),n?.()}))}}class I extends A{cloneChart(){this._cloneChart().then((()=>this._visibility.setValue(!0)))}show(){(0,c.checkAuthBeforeSaveLoad)((()=>this.cloneChart()),{source:"Clone chart"})}_dialogTitle(){return u.t(null,void 0,i(166134))}_dialogText(){return u.t(null,void 0,i(609541))+":"}_actionHandler({newValue:e,dialogClose:t}){r.enabled("saveload_storage_customization")?this._doCloneCurrentLayout(e):b(this._chartWidgetCollection.metaInfo.uid.value(),{name:e}),t()}async _cloneChart(){let e;await new Promise((e=>{window.runOrSignIn(e,{source:"Clone_chart_layout"})}));try{e=await T()}catch{return void(0,p.showErrorDialog)({content:u.t(null,void 0,i(673013))})}e?e&&(this._hide=await this._showDialog(this._getInitialRenameDialogInput())):(0,_.reloginOrGoPro)({feature:"savedChartsLimit"})}_doCloneCurrentLayout(e){const t=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.uid.deleteValue(),this._chartWidgetCollection.metaInfo.id.setValue(null),this._chartWidgetCollection.metaInfo.name.setValue(e),this._doSave(void 0,void 0,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(t)}))}_getInitialRenameDialogInput(){return u.t(null,{context:"ex: AAPL chart copy"},i(297559)).format({title:this._chartWidgetCollection.metaInfo.name.value()})}}var W=i(638456),L=i(638257);class E extends A{show(){this._showDialog()}_actionHandler({dialogClose:e}){e()}_dialogTitle(){return u.t(null,void 0,i(280050))}_dialogText(){return u.t(null,void 0,i(399709))}async _showDialog(){const e={title:this._dialogTitle(),text:this._dialogText(),maxLength:64,placeholder:u.t(null,void 0,i(845408)),onCreate:({newValue:e,onSameTab:t,dialogClose:i})=>{(0,L.openNewChart)({onSameTab:!(0,W.isSymphonyEmbed)()&&t,name:e}),this._actionHandler({newValue:e,dialogClose:i})}
},t=T(),r=Promise.all([Promise.all([i.e(61560),i.e(1283),i.e(85615),i.e(56224),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(55011),i.e(30783),i.e(31481),i.e(29573),i.e(69069),i.e(78392),i.e(30862),i.e(65284),i.e(73688),i.e(92161),i.e(46321),i.e(51215),i.e(97685),i.e(47042),i.e(34530),i.e(32227),i.e(87473),i.e(62526),i.e(45553),i.e(19418),i.e(38890)]).then(i.bind(i,190916)),Promise.all([i.e(57605),i.e(1283),i.e(85615),i.e(56224),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(55011),i.e(30783),i.e(98567),i.e(31481),i.e(29573),i.e(73438),i.e(70815),i.e(69069),i.e(78392),i.e(30862),i.e(65284),i.e(73688),i.e(92161),i.e(46321),i.e(51215),i.e(97685),i.e(47042),i.e(56033),i.e(32227),i.e(87473),i.e(45553),i.e(38606)]).then(i.bind(i,930083))]);if(await t){const[{showSimpleDialog:t},{Create:i}]=await r;return t(e,i)}(0,_.reloginOrGoPro)({feature:"savedChartsLimit"})}}class D extends A{show(e,t,i){const r="function"==typeof e?e:void 0;this._saveNewChart(r,t,i).then((()=>this._visibility.setValue(!0)))}_dialogTitle(){return u.t(null,void 0,i(443047))}_dialogText(){return u.t(null,void 0,i(609541))+":"}_actionHandler({newValue:e,dialogClose:t},i,r,n){this._doSaveCurrentLayout(e,i,r,n),t()}async _saveNewChart(e,t,r){let n;try{n=await T()}catch{return void(0,p.showErrorDialog)({content:u.t(null,void 0,i(673013))})}if(!n)return void(0,_.reloginOrGoPro)({feature:"savedChartsLimit"});const s=this._chartWidgetCollection.metaInfo.name.value();this._hide=await this._showDialog(s,e,t,r)}}class x extends A{show(){(0,c.checkAuthBeforeSaveLoad)((()=>this._show()),{source:"Rename chart"})}_dialogTitle(){return u.t(null,void 0,i(422584))}_dialogText(){return u.t(null,void 0,i(609541))+":"}_actionHandler({newValue:e,dialogClose:t}){this._doSaveCurrentLayout(e),t()}async _show(){await this._renameChart(),this._visibility.setValue(!0)}async _renameChart(){const e=this._chartWidgetCollection.metaInfo.name.value();this._hide=await this._showDialog(e)}}class R{constructor(e,t,r){this._autosaveTimer=null,this._watchedAutoSaveEnabled=new n.WatchedValue,this._toggleAutoSaveEnabledHandler=this._toggleAutoSaveEnabled.bind(this),this._doSave=(e,t,i,r)=>{void 0!==e&&e();const n=this._chartChangesWatcher.changes();this._chartSaver.saveChartSilently((e=>{var i;e&&e.uid===this.layoutId()&&(i=e.uid,"/chart/"===location.pathname&&(location.href="/chart/"+i)),void 0!==t&&t(e)}),(()=>{void 0!==i&&i()}),{autoSave:Boolean(r),changes:n})},this._doLoad=()=>w.backend.getCharts(),this._chartWidgetCollection=e,this._chartSaver=t,this._createController=new D(e,this._doSave,this._doLoad),this._renameController=new x(e,this._doSave,this._doLoad),this._saveAsController=new I(e,this._doSave,this._doLoad),this._autoSaveEnabledSetting=new o(a.TVXWindowEvents,l),this._createEmptyController=new E(e,this._doSave,this._doLoad),this._chartSaver.chartSizeLimitExceeded().subscribe(null,(()=>{const e=this._chartWidgetCollection.activeChartWidget.value()
;Promise.all([i.e(65153),i.e(34489),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(17066),i.e(63745),i.e(25977),i.e(2224),i.e(26820)]).then(i.bind(i,739196)).then((({showSizeLimitExceededDialog:t})=>{t(e)}))})),this._chartChangesWatcher=r,e.saveKeysPressed().subscribe(this,this.saveChartOrShowTitleDialog);{const e=!!window.is_authenticated&&(this._autoSaveEnabledSetting?.get()??!0);e&&this._enableAutoSave(),this._watchedAutoSaveEnabled.setValue(e),this._watchedAutoSaveEnabled.subscribe(this._toggleAutoSaveEnabledHandler),this._autoSaveEnabledSetting?.getOnChange().subscribe(this,this._autoSaveEnabledSettingHandler)}}autoSaveEnabled(){return this._watchedAutoSaveEnabled}destroy(){this._watchedAutoSaveEnabled.unsubscribe(),delete this._watchedAutoSaveEnabled,this._autoSaveEnabledSetting?.destroy(),delete this._autoSaveEnabledSetting}getCreateController(){return this._createController}getRenameController(){return this._renameController}getSaveAsController(){return this._saveAsController}cloneChart(){this._saveAsController.cloneChart()}createEmptyChart(){this._createEmptyController?.show()}saveChartAs(){this._saveAsController.show()}renameChart(){this._renameController.show()}saveNewChart(e,t,i){this._createController.show(e,t,i)}saveExistentChart(e,t,i){this._doSave(e,t,i)}changes(){return this._chartChangesWatcher.changes()}hasChanges(){return 0!==this._chartChangesWatcher.changes()}markContentAsChanged(){this._chartChangesWatcher.markContentAsChanged()}hasChangesWV(){return this._chartChangesWatcher.hasChangesWV()}getOnChanges(){return this._chartChangesWatcher.getOnChange()}saveChartOrShowTitleDialog(e,t,i){const r=window.saver.isSaveInProcess(),n=this._chartChangesWatcher.hasChanges(),s=!!this.layoutId();window.is_authenticated&&(r||!n&&s)||(0,c.checkAuthBeforeSaveLoad)((()=>{null!=this._chartWidgetCollection.metaInfo.id.value()?this.saveExistentChart(e,t,i):this._chartWidgetCollection.readOnly()?this.cloneChart():this.saveNewChart(e,t,i)}),{source:"Save chart",sourceMeta:"Chart"})}saveToJSON(e){return this._chartSaver.saveToJSON(e)}saveChartSilently(e,t,i){this._chartSaver.saveChartSilently(e,t,i)}setAutoSaveEnabled(e){window.is_authenticated&&window.saver.isSaveInProcess()||(0,c.checkAuthBeforeSaveLoad)((()=>{this._watchedAutoSaveEnabled.setValue(e)}),{source:"AutoSave chart"})}saveChartLineTools(e,t,i,r){return this._chartSaver.saveChartLineTools(e,t,i,r)}layoutId(){return this._chartWidgetCollection.metaInfo.uid.value()}chartSaved(){return this._chartSaver.chartSaved()}_autoSaveEnabledSettingHandler(e){this._watchedAutoSaveEnabled.setValue(e)}_toggleAutoSaveEnabled(e){window.is_authenticated&&(e?this._enableAutoSave():this._disableAutoSave(),this._autoSaveEnabledSetting?.set(e,{forceFlush:!0}))}_enableAutoSave(){this._chartChangesWatcher.getOnChange().subscribe(this,this._onStateChanged),this._chartChangesWatcher.hasChanges()&&this._doSave(void 0,void 0,void 0,!0)}_disableAutoSave(){this._stopAutosave(),this._chartChangesWatcher.getOnChange().unsubscribeAll(this)}_onStateChanged(e){
e?this._startAutosave():this._stopAutosave()}_startAutosave(){r.enabled("charts_auto_save")&&null===this._autosaveTimer&&(this._autosaveTimer=setTimeout((()=>{this._autosaveTimer=null,window.is_authenticated?this._chartWidgetCollection.metaInfo.id.value()&&this._doSave(void 0,void 0,void 0,!0):this._startAutosave()}),h?2e3:(0,d.isFeatureEnabled)("chart_autosave_2min")?12e4:(0,d.isFeatureEnabled)("chart_autosave_3min")?18e4:(0,d.isFeatureEnabled)("chart_autosave_5min")?3e5:(0,d.isFeatureEnabled)("chart_autosave_7min")?42e4:(0,d.isFeatureEnabled)("chart_autosave_10min")?6e5:(0,d.isFeatureEnabled)("chart_autosave_20min")?12e5:(0,d.isFeatureEnabled)("chart_autosave_30min")?18e5:(0,d.isFeatureEnabled)("chart_autosave_year")?31536e6:6e4))}_stopAutosave(){null!==this._autosaveTimer&&(clearInterval(this._autosaveTimer),this._autosaveTimer=null)}}},836436:(e,t,i)=>{"use strict";i.d(t,{SharingChartService:()=>s});var r=i(4944),n=i(226722);class s{constructor(e,t){this._requestInProgress=!1,this._sharingValueChangedEvent="SharingValueChanged",this._collectionState=e,this._saveService=t,this._sharingEnabled=(0,r.combine)((e=>!e),e.isPrivate.weakReference()),n.TVXWindowEvents.on(this._sharingValueChangedEvent,(e=>{const t=JSON.parse(e),i=this._collectionState.uid.value();this._collectionState.id.value()===t.chartId&&i===t.uid&&this._setSharingValue(t.value)}))}destroy(){this._sharingEnabled.destroy()}sharingEnabled(){return this._sharingEnabled}setSharingEnabled(e){window.runOrSignIn((()=>this._setSharing(e)),{source:"Sharing chart"})}toggleSharing(){const e=!this._sharingEnabled.value();return this.setSharingEnabled(e),e}async _setSharing(e){const t=this._collectionState.uid.value(),i=this._collectionState.id.value(),r=this._sharingEnabled.value();if(!1===this._requestInProgress&&r!==e){e&&this._saveService.hasChangesWV().value()&&this._saveService.autoSaveEnabled().value()&&this._saveService.saveChartSilently(),this._setSharingValue(e),this._sendSyncEvent({chartId:i,uid:t,value:e});try{this._requestInProgress=!0,await this._saveSharingValue(e)}catch(r){this._setSharingValue(!e),this._sendSyncEvent({chartId:i,uid:t,value:!e})}finally{this._requestInProgress=!1}}}_setSharingValue(e){this._collectionState.isPrivate.setValue(!e)}_sendSyncEvent(e){n.TVXWindowEvents.emit(this._sharingValueChangedEvent,JSON.stringify(e))}_saveSharingValue(e){const t=JSON.stringify({is_private:!e}),i=this._collectionState.uid.value();return fetch(`/api/v1/charts/${i}/sharing/`,{headers:new Headers({"Content-Type":"application/json"}),method:"POST",credentials:"same-origin",body:t})}}},600685:(e,t,i)=>{"use strict";i.d(t,{getStudyTemplateDescString:()=>o,getStudyTemplateMetaInfo:()=>n,getStudyTemplateSaveData:()=>s});var r=i(797657);function n(e,t){return{indicators:e.allStudies(!0).map((e=>({id:e.metaInfo().id,description:e.title(r.TitleDisplayTarget.StatusLine,!0,void 0,!0)}))),interval:t}}function s(e,t,i,r){const s=t.studyTemplate(i,r);return{name:e,content:JSON.stringify(s),meta_info:n(t,s.interval)}}function o(e){const t=new Map
;return e.forEach((e=>{const[i,r]=t.get(e.id)||[e.description,0];t.set(e.id,[i,r+1])})),Array.from(t.values()).map((([e,t])=>`${e}${t>1?` x ${t}`:""}`)).join(", ")}},364976:(e,t,i)=>{"use strict";i.d(t,{StudyTemplates:()=>m});var r=i(650151),n=i(735566),s=i(257253),o=i(444372),a=i(758893),l=i(516958),c=i(736800),d=i(345848),h=i(251924),u=i(77294),g=i(779923);const _=(0,n.getLogger)("Platform.StudyTemplates"),p=o.t(null,void 0,i(715096));class m{constructor(e){this._chartWidgetCollection=e.chartWidgetCollection,this._recentStudyTemplatesService=e.recentStudyTemplatesService,window.loginStateChange.subscribe(null,a.backend.invalidateStudyTemplatesList),this._list=new u.WatchedValue([]),this._onChange=new h.Delegate,this._list.subscribe((()=>this._onChange.fire()))}findRecordByName(e){return this._list.value().find((t=>t.name===e))||null}showSaveAsDialog(e){const t=this._chartWidgetCollection.activeChartWidget.value().model();Promise.all([i.e(58140),i.e(1283),i.e(85615),i.e(56224),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(55011),i.e(30783),i.e(98567),i.e(31481),i.e(29573),i.e(73438),i.e(70815),i.e(14731),i.e(89923),i.e(17760),i.e(69069),i.e(30862),i.e(65284),i.e(73688),i.e(92161),i.e(88867),i.e(46321),i.e(51215),i.e(97685),i.e(47042),i.e(78158),i.e(32227),i.e(87473),i.e(45553),i.e(36631)]).then(i.bind(i,333064)).then((i=>{new i.StudyTemplateSaver({controller:t,onSave:(e,t)=>{t&&this._recentStudyTemplatesService?.add(t),this._list.setValue(e)}}).show(e)}))}applyTemplate(e){const t=this.findRecordByName(e);null!==t?window.runOrSignIn((async()=>{const{id:e,name:i,is_default:n}=t,o=this._chartWidgetCollection.activeChartWidget.value(),h=e=>{(0,d.trackEvent)("GUI","Load Study Template");const t=JSON.parse(e.content),n=t.symbol,a=t.interval,h=Boolean(n)&&!o.model().mainSeries().symbolSameAsCurrent(n);if(Boolean(a)&&!s.Interval.isEqual(o.model().mainSeries().interval(),a)&&(0,c.trackIntervalChanging)(a,"Study template"),o.model().applyStudyTemplate(t,i),h){const e=(0,r.ensureNotNull)(this._chartWidgetCollection);(0,l.trackChangeSymbol)(o.model().mainSeries(),e.layout.value(),e.metaInfo.uid.value()||"","Study Template")}};n&&"number"==typeof e?await a.backend.getStandardStudyTemplateById(e,h):await a.backend.getStudyTemplateById(e).then(h)}),{source:"Study templates apply"}):_.logNormal(`Template ${e} not found in cache`)}deleteStudyTemplate(e,t,i){const r=this.findRecordByName(e);null!==r?this._removeTemplate(r,t,i):_.logNormal(`Template ${e} not found in cache`)}list(){return this._list.value()}getOnChange(){return this._onChange}refreshStudyTemplateList(e){a.backend.getStudyTemplatesList().then((t=>{this._list.setValue(t),void 0!==e&&e()}))}invalidate(){a.backend.invalidateStudyTemplatesList()}_removeTemplate(e,t,i){window.runOrSignIn((()=>{(0,g.showConfirm)({text:p.format({name:e.name}),onConfirm:({dialogClose:t})=>new Promise((r=>{a.backend.invalidateStudyTemplatesList(),a.backend.removeStudyTemplate(e.id).then((()=>{this.refreshStudyTemplateList((()=>{const n=this.list()
;this._list.setValue(n.filter((t=>t!==e))),this._recentStudyTemplatesService&&this._recentStudyTemplatesService.remove(e.id),r(),t(),i?.()}))}))}))},t)}),{source:"Study templates delete"})}}},871934:(e,t,i)=>{"use strict";i.d(t,{makeSnapshotRequest:()=>l,takeChartSnapshot:()=>a,takeChartSnapshotPromise:()=>o});i(7742);var r=i(444372),n=i(229534),s=i(954912);function o(e,t={}){return new Promise(((i,r)=>{a(e,i,r,t).catch(r)}))}async function a(e,t,i,r={}){const n=new FormData;if(void 0!==r.previews)for(const e of r.previews)n.append("previews[]",e);void 0!==r.cme&&n.append("cme",String(r.cme)),void 0!==r.wl&&n.append("wl",String(r.wl)),void 0!==r.onWidget&&n.append("onWidget",String(r.onWidget)),r.isReport&&n.append("isReport",String(r.isReport)),r.asyncSave&&n.append("asyncSave",String(r.asyncSave));const s=window.urlParams;s&&s.locale&&n.append("language",s.locale);const o=e.activeChartWidget.value(),a=o.widgetCustomer();void 0!==a&&n.append("customer",a);const c=o.model().model().timezoneExceptExchange().value()??"exchange";n.append("timezone",c),n.append("symbol",o.model().mainSeries().symbol());const d=await e.clientSnapshot({showHeaderMainSymbol:r.showHeaderMainSymbol}),h=await new Promise((e=>d.toBlob(e)));null!==h&&n.append("preparedImage",h),l(n,t,i,r)}async function l(e,t,o,a={}){try{const l=await(0,s.fetch)("/snapshot/",{body:e,method:"POST",credentials:"same-origin"}),c=await l.text();if(l.ok)t(c);else{if("suspicious_chart_snapshots_error"===c){const e=r.t(null,void 0,i(124760)).format({start_link:'<a class="tv-dialog__link js-send-report-link" href="#" data-issue-type="other">',end_link:"</a>"});a.onInvalidSnapshotImage&&a.onInvalidSnapshotImage();return(0,n.createErrorDialog)({title:r.t(null,void 0,i(161498)),content:e,btnType:"danger"}).then((e=>{e.on("afterOpen",(()=>{i.e(1484).then(i.bind(i,508956)).then((({bugDialogCreationHandler:t})=>{t(),e.$el.find(".js-send-report-link").click((()=>{e.close()}))}))})),e.open()}))}o()}}catch{o()}}},835518:(e,t,i)=>{"use strict";i.d(t,{getDeviceId:()=>o});var r=i(900608);const n="device-id";let s;function o(){return s||(s=window.localStorage.getItem(n),s||(window.localStorage.setItem(n,(0,r.guid)()),s=window.localStorage.getItem(n),s||"N/A"))}},607196:(e,t,i)=>{"use strict";var r;i.d(t,{TradingPage:()=>r,maxPanelWidth:()=>n,minPanelWidth:()=>s,panelHeight:()=>o}),function(e){e.DOMPanel="domPanel",e.OrderPanel="orderPanel"}(r||(r={}));const n=400,s=315,o=451},497106:(e,t,i)=>{"use strict";i.d(t,{isBrokerHidden:()=>g,isMobileTradingAvailable:()=>h,isMobileTradingAvailableInApp:()=>u,isSmallScreen:()=>_});var r=i(638456),n=i(125226),s=i(314802),o=i(687037);const a=(0,n.isFeatureEnabled)("mobile_trading_ios")&&r.CheckMobile.iOS()&&(0,s.isOnMobileAppPage)("old"),l=(0,n.isFeatureEnabled)("mobile_trading_android")&&r.CheckMobile.Android()&&(0,s.isOnMobileAppPage)("new"),c=(0,n.isFeatureEnabled)("mobile_trading_web")&&r.CheckMobile.any()&&!r.CheckMobile.isIPad()&&_()&&!(0,s.isOnMobileAppPage)("any"),d=o.enabled("mobile_trading")&&(a||l||c);function h(){return d}
function u(){return a||l}function g(e){return a?(0,n.isFeatureEnabled)(`hide_${e}_on_ios`):l?(0,n.isFeatureEnabled)(`hide_${e}_on_android`):!!c&&(0,n.isFeatureEnabled)(`hide_${e}_on_mobile_web`)}function _(){return window.matchMedia("(orientation: portrait) and (max-width: 567px)").matches||window.matchMedia("(orientation: landscape) and (max-height: 567px)").matches}},194745:(e,t,i)=>{"use strict";i.d(t,{settingsKeys:()=>r});const r={ACTIVE_BROKER:"trading.active_broker",PROPERTIES:"trading.chart.proterty",PROFIT_VIEW_TYPE:"trading.dom.profitViewType",ORDER_WIDGET_MODE:"trading.orderWidgetMode.",DOM_DURATION:"trading.domDuration.",TRADING_PANEL_VISIBLE:"trading.tradingPanelVisible",TRADING_PANEL_ACTIVE_PAGE:"trading.tradingPanelActivePage",PANEL_WIDTH:"trading.panelWidth",ORDER_PANEL_SETTINGS:"trading.orderPanelSettings",FAVORITE_BROKERS:"trading.panelFavorite",LOGOUT_COUNTER:"trading.brokerLogOutCounter",DISABLED_CONFIRMATIONS:"trading.disabledConfirmations",MOVE_TRADED_SOURCE_WITH_SHIFT:"trading.chart.moveWithShift",REALTIME_DATA_ACCEPTED:"trading.realTimeDataAccepted",PAPER_COMPETITION_POPUP_SHOWN_TIMESTAMP:"trading.paperCompetitionPopupShownTimestamp",PAPER_COMPETITION_POPUP_SHOWN_TIMESTAMP_2:"trading.paperCompetitionPopupShownTimestamp2",PAPER_COMPETITION_POPUP_SHOWN_TIMESTAMP_3:"trading.paperCompetitionPopupShownTimestamp3",LAST_RISK_QUANTITY_TYPE:"trading.lastRiskQuantityType",PAPER_COMPETITION_SUBACCOUNT_HINT:"trading.paperCompetitionSubaccountHint",HASH_SALT:"trading.hashSalt",QUICK_TRADING_ENABLED:"trading.quickTradingEnabled",QUICK_TRADING_ONBOARDING_ENABLED:"trading.quickTradingOnboardingEnabled",SHOW_HINT_FOR_QUICK_TRADING:"trading.showHintForQuickTrading"}},28686:(e,t,i)=>{"use strict";i.d(t,{TradingViewApi:()=>Vt});var r=i(650151),n=i(735566),s=i(158942),o=i(202373),a=(i(5368),i(251954)),l=i(687037),c=i(251924),d=i(853768),h=i(309730),u=i(333126),g=i(355902),_=i(290222),p=i(314802),m=i(693287),v=i(250346),S=i(909814);class f{constructor(e,t,i){this._replayUIController=e,this._chartWidgetsCollection=t,this._position=i?.position,this._realizedPL=i?.realizedPL,this._currency=i?.currency,this._replayAvailability=i?.availability,this._symbolInfo=i?.symbolInfo}destroy(){this._position?.release(),this._realizedPL?.release(),this._replayAvailability?.release(),this._currency?.release(),this._symbolInfo?.release()}isReplayToolbarVisible(){return this._replayUIController.isReplayModeEnabled()}showReplayToolbar(){const e=this._replayUIController;return e.showReplayToolbar?e.showReplayToolbar(!(0,p.isOnMobileAppPage)("any")&&void 0):e.enableReplayMode(!(0,p.isOnMobileAppPage)("any")&&void 0)}hideReplayToolbar(e){return this._replayUIController.requestCloseReplay(e)}isReplayAvailable(){return(0,r.ensureDefined)(this._replayAvailability)}isReadyToPlay(){return this._replayUIController.readyToPlay()}autoplayDelayList(){return S.autoplayDelayOptionItems}autoplayDelay(){return this._replayUIController.autoplayDelay().value()}autoplayDelayWV(){return this._replayUIController.autoplayDelay()}changeAutoplayDelay(e){
this._replayUIController.changeAutoplayDelay(e)}isReplayStarted(){return this._replayUIController.isReplayStarted()}isAutoplayStarted(){return this._replayUIController.isAutoplayStarted()}toggleAutoplay(){this._replayUIController.toggleAutoplay()}replayMode(){return m.replayModeProperty}replayTimingMode(){return v.replayTimingModeProperty}isJumpToBarModeEnabled(){return this._replayUIController.isJumpToBarModeEnabled()}async toggleJumpToBarMode(){v.replayTimingModeProperty.setValue("manual"),this._replayUIController.isReplayModeEnabled().value()?this._replayUIController.toggleJumpToBarMode():await this._replayUIController.enableReplayMode(!0)}getReplayDepth(e){return this._replayUIController.getReplayDepth(e)}getReplaySelectedDate(){return this._replayUIController.replaySelectedDate()}async selectDate(e){v.replayTimingModeProperty.setValue("date"),this._replayUIController.isReplayModeEnabled().value()||await this._replayUIController.enableReplayMode(!1),await this._replayUIController.selectDate(this._chartWidgetsCollection.activeChartWidget.value(),1e3*Math.floor(e/1e3))}async selectRandomDate(){if(v.replayTimingModeProperty.setValue("random"),this._replayUIController.isReplayModeEnabled().value()||await this._replayUIController.enableReplayMode(!1),null===this._replayUIController.getReplayDepth().value())return new Promise(((e,t)=>{this._replayUIController.getReplayDepth().subscribe((i=>{null!==i?this._replayUIController.selectRandomDate(this._chartWidgetsCollection.activeChartWidget.value()).then(e):t(new Error("Error getting the available data depth"))}),{once:!0})}));await this._replayUIController.selectRandomDate(this._chartWidgetsCollection.activeChartWidget.value())}async selectFirstAvailableDate(){v.replayTimingModeProperty.setValue("first_available_date"),this._replayUIController.isReplayModeEnabled().value()||await this._replayUIController.enableReplayMode(!1);const e=this._replayUIController.getReplayDepth().value();if(null===e)return new Promise(((e,t)=>{this._replayUIController.getReplayDepth().subscribe((i=>{null!==i?this._replayUIController.selectDate(this._chartWidgetsCollection.activeChartWidget.value(),1e3*i).then(e):t(new Error("Error getting the available data depth"))}),{once:!0})}));await this._replayUIController.selectDate(this._chartWidgetsCollection.activeChartWidget.value(),1e3*e)}doStep(){return this._replayUIController.doStep()}goToRealtime(){this._replayUIController.goToRealtime()}stopReplay(){return this._replayUIController.requestCloseReplay(!0)}buy(e){this._replayUIController.tradingUIController().activeModel()?.addOrder({side:1,type:2,qty:e})}sell(e){this._replayUIController.tradingUIController().activeModel()?.addOrder({side:-1,type:2,qty:e})}position(){return(0,r.ensureDefined)(this._position)}realizedPL(){return(0,r.ensureDefined)(this._realizedPL)}currency(){return(0,r.ensureDefined)(this._currency)}symbolInfo(){return(0,r.ensureDefined)(this._symbolInfo)}closePosition(){this._replayUIController.tradingUIController().activeModel()?.closePosition()}replayStrategyFacade(){return(0,
r.ensureNotNull)(this._replayUIController.tradingUIController().activeReplayStrategyFacade())}replayStrategyFacadesPerChartModelId(){return this._replayUIController.tradingUIController().replayStrategyFacadesPerChartModelId()}replayResolutions(){return this._replayUIController.replayResolutions()}currentReplayResolution(){return this._replayUIController.currentReplayResolution()}autoReplayResolution(){return this._replayUIController.autoReplayResolution()}autoReplayResolutionTitle(){return this._replayUIController.autoReplayResolutionTitle()}changeReplayResolution(e){this._replayUIController.changeReplayResolution(e)}currentDate(){return this._replayUIController.replayCurrentDate()}trackBarReplaySnowplowEvent(e,t){this._replayUIController.trackBarReplaySnowplowEvent(e,t)}}var y=i(551965),b=i(187880);class w{constructor(){this._pineEditor=null,this._pineEditorContainer=document.createElement("div"),this._widthWV=new b.WatchedValue(0),this._heightWV=new b.WatchedValue(0),this._visible=new b.WatchedValue(!0),this._openedScripts=new y.AsyncResourceWrapper(i.e(28129).then(i.bind(i,90809))),this._pineEditorCtor=new y.AsyncResourceWrapper(Promise.all([i.e(8913),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(99408),i.e(55629),i.e(10727),i.e(31697),i.e(86280),i.e(53924),i.e(30783),i.e(98567),i.e(29573),i.e(73438),i.e(70815),i.e(66029),i.e(7256),i.e(84794),i.e(51711),i.e(14731),i.e(89923),i.e(99397),i.e(17760),i.e(12532),i.e(81469),i.e(43887),i.e(57434),i.e(24313),i.e(50876),i.e(70526),i.e(32496),i.e(83256),i.e(55973),i.e(16499),i.e(30862),i.e(34489),i.e(67414),i.e(19985),i.e(38695),i.e(81306),i.e(85152),i.e(26924),i.e(98768),i.e(88867),i.e(61680),i.e(48906),i.e(6444),i.e(90807),i.e(46953),i.e(68702),i.e(32227),i.e(55091),i.e(31158),i.e(72201),i.e(7599),i.e(61123),i.e(5285),i.e(24898),i.e(83111),i.e(8133),i.e(50004),i.e(25752),i.e(49264),i.e(12661),i.e(5444),i.e(80975),i.e(86911),i.e(99311),i.e(93524),i.e(5866),i.e(79418),i.e(53704),i.e(31641),i.e(45589)]).then(i.bind(i,541688)),(e=>{e.PineEditorTestApi.hasInstance()&&e.PineEditorTestApi.getInstance().destroy()}))}destroy(){this._openedScripts.destroy(),this._pineEditorCtor.destroy()}addOpenedScript(e){this._openedScripts.callFunction((t=>{t.openedPineScripts.addScript(e)}))}removeOpenedScript(e){this._openedScripts.callFunction((t=>{t.openedPineScripts.removeScript(e)}))}openEditor(){return new Promise((e=>{this._pineEditorCtor.callFunction((t=>{t.PineEditorTestApi.hasInstance()?this._pineEditor=t.PineEditorTestApi.getInstance():this._pineEditor=new t.PineEditorTestApi({container:this._pineEditorContainer,width:this._widthWV,height:this._heightWV,visible:this._visible}),this._pineEditor.awaitEditorReady().then(e)}))}))}async openNewScript(){await(this._pineEditor?.open())}async openScript(e){await(this._pineEditor?.open(e))}async saveScript(){await(this._pineEditor?.saveScript())}async addScriptOnChart(){await(this._pineEditor?.addScriptOnChart())}async updateScriptOnChart(){await(this._pineEditor?.updateScriptOnChart())}async setEditorText(e){
await(this._pineEditor?.setEditorText(e))}focusEditor(){this._pineEditor?.focus("desktop")}}var C=i(295977),T=i(125226),P=i(946352),A=i(374952),I=i(103669),W=i(719885),L=i(988534),E=i(316478),D=i(113610),x=i(290382),R=i(638257),M=i(719255),k=i(345848),O=i(308721),N=i(909740),B=i(926209);class F{constructor(e){this._toolbarThemeChanged=new c.Delegate,this._onWatchedThemeChanged=e=>{this._toolbarThemeChanged.fire(e)},this._opts=e,N.watchedTheme.subscribe(this._onWatchedThemeChanged)}destroy(){N.watchedTheme.unsubscribe(this._onWatchedThemeChanged)}isStdTheme(){const e=this._opts.chartWidgetCollection.getAll().every((e=>null!==e.model().model().getThemeNameIfStdTheme()));return Promise.resolve(e)}async setStdTheme(e,t=!0,i){await(0,B.loadTheme)(this._opts.chartWidgetCollection,{themeName:e,standardTheme:!0,syncState:t,noUndo:i})}setStdThemeForLayout(e,t=!0){(0,N.setTheme)(e),t&&(0,O.syncTheme)()}getCurrentThemeName(){return(0,O.getCurrentTheme)().name}toolbarThemeChanged(){return this._toolbarThemeChanged}}var V=i(456677),U=i(313344),H=i(77294),z=i(294721),j=i(198526),G=i(192784),$=i(444372),q=i(892323),J=i(666310),Y=i(296673),X=i(89523),K=i(313503),Z=i(239765);class Q{constructor(e){this._timeScale=e}coordinateToTime(e){const t=this._timeScale.coordinateToIndex(e);return this._timeScale.indexToTimePoint(t)}barSpacingChanged(){return this._timeScale.barSpacingChanged()}rightOffsetChanged(){return this._timeScale.rightOffsetChanged()}setRightOffset(e){this._timeScale.setRightOffset(e)}setBarSpacing(e){this._timeScale.setBarSpacing(e)}barSpacing(){return this._timeScale.barSpacing()}rightOffset(){return this._timeScale.rightOffset()}width(){return this._timeScale.width()}defaultRightOffset(){return this._timeScale.defaultRightOffset().spawn()}defaultRightOffsetPercentage(){return this._timeScale.defaultRightOffsetPercentage().spawn()}usePercentageRightOffset(){return this._timeScale.usePercentageRightOffset().spawn()}isEmpty(){return this._timeScale.isEmpty()}scrollToFirstBar(e){this._timeScale.scrollToFirstBar(e)}scrollToRealtime(e){this._timeScale.scrollToRealtime(!1,e)}pointsCount(){return this._timeScale.points().size()}leftVisibleBarUTCTime(){const e=this._timeScale.visibleBarsStrictRange()?.firstBar()??null;return null===e?null:this._timeScale.indexToTimePoint(e)}}var ee=i(221147);const te=new q.TranslatedString("change timezone",$.t(null,void 0,i(920137)));class ie{constructor(e){this._onTimezoneChanged=new c.Delegate,this._chartWidget=e,this._timezoneProperty=e.properties().childs().timezone,this._timezoneProperty.subscribe(this,(e=>{this._onTimezoneChanged.fire(e.value())})),e.onAboutToBeDestroyed().subscribe(this,(()=>{this._timezoneProperty.unsubscribeAll(this)}),!0)}availableTimezones(){return ee.availableTimezones}getTimezone(){const e=this._timezoneProperty.value();return(0,r.ensureDefined)(this.availableTimezones().find((t=>t.id===e)))}setTimezone(e,t){(0,r.assert)((0,ee.timezoneIsAvailable)(e),`Incorrect timezone: ${e}`),
t?.disableUndo?this._timezoneProperty.setValue(e):this._chartWidget.model().setProperty(this._timezoneProperty,e,te)}onTimezoneChanged(){return this._onTimezoneChanged}}class re{constructor(e,t){this._chartUndoModel=e,this._chartModel=e.model(),this._priceScale=t}getMode(){const e=this._priceScale.properties().childs();return e.percentage.value()?2:e.indexedTo100.value()?3:e.log.value()?1:0}setMode(e){this._priceScale.setMode({percentage:2===e,log:1===e,indexedTo100:3===e})}isInverted(){return this._priceScale.isInverted()}setInverted(e){this._priceScale.properties().childs().isInverted.setValue(e)}isLocked(){return this._priceScale.isLockScale()}setLocked(e){this._priceScale.setMode({lockScale:e})}isAutoScale(){return this._priceScale.isAutoScale()}setAutoScale(e){this._priceScale.setMode({autoScale:e})}getVisiblePriceRange(){return this._priceScale.priceRangeInPrice()}setVisiblePriceRange(e){this._priceScale.setPriceRangeInPrice(e),this._chartModel.lightUpdate()}hasMainSeries(){return this._priceScale.hasMainSeries()}getStudies(){return this._priceScale.getStudies().map((e=>e.id()))}currency(){const e=this._chartModel.availableCurrencies(),t=this._priceScale.currency(e);return null===t?null:{readOnly:t.readOnly,selectedCurrency:t.selectedCurrency,originalCurrencies:Array.from(t.originalCurrencies),currencies:e.getItems().filter((e=>!t.baseCurrencies.has(e))),symbols:Array.from(t.symbols)}}setCurrency(e){const t=this.currency()?.currencies;t&&e&&!t.includes(e)?console.warn("The provided currency is not supported by your datafeed!"):this._chartUndoModel.setPriceScaleCurrency(this._priceScale,e)}unit(){const e=this._chartModel.availableUnits(),t=this._priceScale.unit(e);return null===t?null:{readOnly:0===t.availableGroups.size,selectedUnit:t.selectedUnit,originalUnits:Array.from(t.originalUnits),availableGroups:Array.from(t.availableGroups),symbols:Array.from(t.symbols)}}setUnit(e){!e||this._chartModel.availableUnits().unitGroupById(e)?this._chartUndoModel.setPriceScaleUnit(this._priceScale,e):console.warn("The provided unit is not supported by your datafeed!")}coordinateToPrice(e){const t=this._priceScale.mainSource()?.firstValue();return null==t?null:this._priceScale.coordinateToPrice(e,t)}measureUnitId(){const e=this._priceScale.measureUnitId(this._chartModel.availableUnits());return null===e?null:{selectedMeasureUnitId:e.selectedMeasureUnitId}}}var ne=i(518006);function se(e){return{id:e.id(),name:(t=e.toolname,Object.keys(V.supportedLineTools).find((e=>V.supportedLineTools[e].name===t))||null)};var t}function oe(e){return{id:e.id(),name:e.metaInfo().description}}var ae=i(536794),le=i(925341);const ce=new q.TranslatedString("change pane height",$.t(null,void 0,i(314691)));class de extends le.UndoCommand{constructor(e,t,i){super(ce),this._model=e,this._paneIndex=t,this._paneHeight=i,this._prevStretchFactors=this._model.panes().map((e=>e.stretchFactor()))}redo(){this._model.changePanesHeight(this._paneIndex,this._paneHeight)}undo(){const e=this._model.panes();for(let t=0;t<e.length;++t)e[t].setStretchFactor((0,
r.ensureDefined)(this._prevStretchFactors[t]));this._model.fullUpdate()}}class he{constructor(e,t){this._priceScales=new WeakMap,this._pane=e,this._chartWidget=t}hasMainSeries(){return this._pane.containsMainSeries()}getLeftPriceScales(){return this._pane.leftPriceScales().map(this._getPriceScaleApi,this)}getRightPriceScales(){return this._pane.rightPriceScales().map(this._getPriceScaleApi,this)}getMainSourcePriceScale(){const e=this._pane.mainDataSource();if(null===e)return null;const t=e.priceScale();return null===t||this._pane.isOverlay(e)?null:this._getPriceScaleApi(t)}getPriceScaleById(e){const t=this._pane.getPriceScaleById(e);return null===t?null:this._getPriceScaleApi(t)}setMaximized(e){this._pane.maximized().value()!==e&&this._chartWidget.model().toggleMaximizedPane(this._pane)}isMaximized(){return this._pane.maximized().value()}legendLoaded(){const e=this._chartWidget.paneByState(this._pane);return Boolean(e&&e.statusWidget())}getAllEntities(){const e=this._pane.model();return this._pane.sourcesByGroup().allIncludingHidden().filter((e=>!e.isSpeciallyZOrderedSource())).map((t=>function(e,t){return t===e.mainSeries()?{id:e.mainSeries().id(),name:"Main Series"}:(0,ne.isStudy)(t)?oe(t):(0,j.isLineTool)(t)?se(t):null}(e,t))).filter(ae.notNull).filter((e=>null!==e.name))}getHeight(){return this._pane.height()}setHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,r.assert)(i.length>1,"Unable to change pane's height if there is only one pane");const n=i.indexOf(this._pane);(0,r.assert)(-1!==n,"Invalid pane index");const s=new de(t,n,e);this._chartWidget.model().undoHistory().pushUndoCommand(s)}moveTo(e){const t=this.paneIndex();t!==e&&((0,r.assert)(e>=0&&e<this._chartWidget.paneWidgets().length,"Invalid pane index"),this._chartWidget.model().movePane(t,e))}paneIndex(){return this._chartWidget.model().model().panes().indexOf(this._pane)}collapse(){if(1===this._chartWidget.model().panes().length)throw new Error("Cannot collapse a single pane!");if(this._pane.collapsed().value())throw new Error("Cannot collapse current pane!");this._chartWidget.model().toggleCollapsedPane(this._pane)}restore(){if(1===this._chartWidget.paneWidgets().length)throw new Error("Cannot restore a single pane!");if(!this._pane.collapsed().value())throw new Error("Cannot restore current pane!");this._chartWidget.model().toggleCollapsedPane(this._pane)}isCollapsed(){return this._pane.collapsed().value()}_getPriceScaleApi(e){let t=this._priceScales.get(e);return void 0===t&&(t=new re(this._chartWidget.model(),e),this._priceScales.set(e,t)),t}}var ue=i(797657),ge=i(357997),_e=i(65189),pe=i(84505),me=i(524966),ve=i(291793),Se=i(97191),fe=i(245925),ye=i(143406),be=i(5102);var we=i(444506),Ce=i(154834);var Te=i(523480),Pe=i(564060);class Ae{constructor(e,t){this._onStudyCompleted=new c.Delegate,this._onStudyError=new c.Delegate,this._isStudyDestroyed=!1,this._study=e,this._chartWidget=t,this._undoModel=this._chartWidget.model(),this._model=this._undoModel.model(),this._study.onAboutToBeDestroyed().subscribe(this,(()=>{
this._study.onStatusChanged().unsubscribeAll(this),this._study.onAboutToBeDestroyed().unsubscribeAll(this),this._isStudyDestroyed=!0})),this._study.onStatusChanged().subscribe(this,(e=>{switch(e.type){case ye.StudyStatusType.Completed:this._onStudyCompleted.fire();break;case ye.StudyStatusType.Error:this._onStudyError.fire()}}))}isUserEditEnabled(){return this._study.userEditEnabled()}setUserEditEnabled(e){this._study.setUserEditEnabled(e)}getInputsInfo(){return void 0===(e=this._study.metaInfo()).inputs?[]:e.inputs.map((e=>({...e,id:e.id,localizedName:void 0!==e.name?(0,be.getTranslatedInputTitle)(e.name):""})));var e}getInputValues(){const e=this._study.inputs({symbolsForChartApi:!1,asObject:!0});return Object.keys(e).map((t=>{const i=e[t];return{id:t,value:(0,ae.isObject)(i)?i.v:i}}))}getStyleInfo(){return function(e){const t={};if(e.defaults){const i=(0,Ce.default)(e.defaults);t.defaults=i}return void 0!==e.plots&&(t.plots=(0,Ce.default)(e.plots)),void 0!==e.styles&&(t.styles=(0,Ce.default)(e.styles)),void 0!==e.bands&&(t.bands=(0,Ce.default)(e.bands)),void 0!==e.filledAreas&&(t.filledAreas=(0,Ce.default)(e.filledAreas)),void 0!==e.palettes&&(t.palettes=(0,Ce.default)(e.palettes)),t}(this._study.metaInfo())}getStyleValues(){const{styles:e,bands:t,filledAreas:i,palettes:r,graphics:n,ohlcPlots:s,filledAreasStyle:o}=this._study.properties().state();return{styles:e,bands:t,filledAreas:i,palettes:r,graphics:n,ohlcPlots:s,filledAreasStyle:o}}setInputValues(e){const t=this.getInputValues();for(const i of e){void 0!==t.find((e=>e.id===i.id))?this._study.properties().childs().inputs.childs()[i.id].setValue(i.value):console.warn(`There is no such input: "${i.id}"`)}}mergeUp(){this._model.isMergeUpAvailableForSource(this._study)&&new me.MergeUpUndoCommand(this._model,this._study,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._study)&&new me.MergeDownUndoCommand(this._model,this._study,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._study)&&new pe.UnmergeUpUndoCommand(this._model,this._study,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._study)&&new pe.UnmergeDownUndoCommand(this._model,this._study,null).redo()}paneIndex(){return this._model.panes().indexOf(this._model.paneForSource(this._study))}onDataLoaded(){return this._onStudyCompleted}onStudyError(){return this._onStudyError}mergeUpWithUndo(){this._model.isMergeUpAvailableForSource(this._study)&&this._undoModel.mergeSourceUp(this._study)}mergeDownWithUndo(){this._model.isMergeDownAvailableForSource(this._study)&&this._undoModel.mergeSourceDown(this._study)}unmergeUpWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceUp(this._study)}unmergeDownWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceDown(this._study)}priceScale(){return new re(this._undoModel,(0,r.ensureNotNull)(this._study.priceScale()))}symbolSource(){const e=(0,r.ensureNotNull)(this._study.symbolSource());return{symbol:e.symbol(),
currencyId:e.currency(),unitId:e.unit()}}currency(){return this._study.currency()}changePriceScale(e){const t=(0,r.ensureNotNull)(this._model.paneForSource(this._model.mainSeries())),i=(0,r.ensureNotNull)(this._model.paneForSource(this._study));switch(e){case"no-scale":(0,r.assert)(i.actionNoScaleIsEnabled(this._study),"Unable to leave a pane without any non-overlay price scale"),new ve.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"overlay",null).redo();break;case"as-series":(0,r.assert)(i===t,"Study should be on the main pane"),new ve.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,this._model.mainSeries().priceScale(),null).redo();break;case"new-left":new ve.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"left",null).redo();break;case"new-right":new ve.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"right",null).redo();break;default:const n=this._model.dataSourceForId(e);if(null===n)throw new Error(`There is no study with entityId='${e}'`);const s=i===this._model.paneForSource(n);(0,r.assert)(s,"Both studies should be on the same pane");const o=(0,r.ensureNotNull)(n.priceScale()),a=(0,_e.sourceNewCurrencyOnPinningToPriceScale)(this._study,o,this._model),l=(0,Se.sourceNewUnitOnPinningToPriceScale)(this._study,o,this._model);new ve.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,o,null).redo(),null!==a&&new ge.SetPriceScaleCurrencyUndoCommand(this._model,o,a,null).redo(),null!==l&&new fe.SetPriceScaleUnitUndoCommand(this._model,o,l,null).redo()}}isVisible(){return this._study.properties().childs().visible.value()}setVisible(e){this._study.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._study])}sendToBack(){this._model.sendToBack([this._study])}applyOverrides(e){(0,Y.applyOverridesToStudy)(this._study,e)}hasPlots(){return this._study.metaInfo().plots.length>0}dataLength(){if(this._study.status().type!==ye.StudyStatusType.Completed)return 0;return!(0,we.isFundamentalStudyMetaInfo)(this._study.metaInfo())&&this._study.metaInfo().plots.length>0?this._study.data().size():this._model.mainSeries().bars().size()}isLoading(){const e=this._study.status();return e.type===ye.StudyStatusType.Undefined||e.type===ye.StudyStatusType.Loading}hasError(){return this._study.status().type===ye.StudyStatusType.Error}hasPendingUnresolvedSymbols(){return this._study.hasPendingUnresolvedSymbols()}anyGraphicsReady(){return!(0,Te.isStudyGraphicsEmpty)(this._study.graphics())}graphicsViewsReady(){return this._study.graphicsViewsReady()}properties(){return this._study.properties()}setProperties(e){this._study.properties().mergeAndFire(e)}async applyToEntireLayout(){const{ActionsProvider:e}=await(0,Pe.actionsProviderModule)();if(this._isStudyDestroyed)return;const t=new e(this._chartWidget),i=(await t.contextMenuActionsForSources([this._study],(0,r.ensureNotNull)(this._chartWidget.model().paneForSource(this._study)))).find((e=>"applyStudyToEntireLayout"===e.id));i&&i.execute()}status(){return{...this._study.status()}}title(){
return this._study.title(ue.TitleDisplayTarget.StatusLine)}symbolsResolved(){return this._study.symbolsResolved()}study(){return this._study}}const Ie=new Map([["LineToolBezierQuadro",3],["LineToolBezierCubic",4]]);function We(e){const t=Ie.get(e.toolname);if(void 0!==t)return t;const i=e.pointsCount();return-1===i?e.points().length:i}function Le(e){return"LineToolRiskRewardLong"===e||"LineToolRiskRewardShort"===e}const Ee=["alwaysShowStats","entryPrice","inputs.first bar time","inputs.last bar time","interval","linesWidths","points","snapTo45Degrees","stopPrice","symbol","symbolStateVersion","currencyId","unitId","targetPrice","zOrderVersion"];class De{constructor(e,t,i){this._source=e,this._undoModel=t,this._model=t.model(),this._pointsConverter=i}isSelectionEnabled(){return this._source.isSelectionEnabled()}setSelectionEnabled(e){this._source.setSelectionEnabled(e)}isSavingEnabled(){return this._source.isSavedInChart()}setSavingEnabled(e){this._source.setSavingInChartEnabled(e)}isShowInObjectsTreeEnabled(){return this._source.showInObjectTree()}setShowInObjectsTreeEnabled(e){this._source.setShowInObjectsTreeEnabled(e)}isUserEditEnabled(){return this._source.userEditEnabled()}setUserEditEnabled(e){this._source.setUserEditEnabled(e)}bringToFront(){this._model.bringToFront([this._source])}sendToBack(){this._model.sendToBack([this._source])}getProperties(e,t){return this._source.properties().state(Ee,e,t)}setProperties(e,t){(0,z.allowSavingDefaults)(!!t),this._source.properties().mergeAndFire(e),(0,z.allowSavingDefaults)(!1)}getPoints(){let e=this._source.points();const t=We(this._source);return e.length>t&&((0,r.assert)(Le(this._source.toolname)),e=e.slice(0,t)),this._pointsConverter.dataSourcePointsToPriced(e)}setPoints(e){if(this._source.isFixed())return;const t=We(this._source);if(t!==e.length)throw new Error(`Wrong points count. Required: ${t}, provided: ${e.length}`);const i=this._pointsConverter.apiPointsToDataSource(e);this._model.startChangingLinetool(this._source,(0,r.ensureNotNull)(this._source.ownerSource())),this._model.changeLinePoints(this._source,i),this._model.endChangingLinetool(!0),this._source.createServerPoints()}getAnchoredPosition(){return this._source.positionPercents()}setAnchoredPosition(e){const t=this._source.fixedPoint(),i=this._source.linkKey().value(),r=void 0===t?null:this._source.screenPointToPoint(t);if(!this._source.isFixed()||void 0===t||null===i||null===r)return;const n={logical:r,screen:t},s=new Map;s.set(i,e),this._model.startMovingSources([this._source],n,null,new Map),this._model.moveSources(n,s),this._model.endMovingSources(!0)}ownerSourceId(){return(0,r.ensureNotNull)(this._source.ownerSource()).id()}changePoint(e,t){if(this._source.isFixed())return;const i=this._pointsConverter.apiPointsToDataSource([e])[0];this._model.startChangingLinetool(this._source,(0,r.ensureNotNull)(this._source.ownerSource()),{...i},t),this._model.changeLinePoint({...i}),this._model.endChangingLinetool(!1),this._source.createServerPoints()}isHidden(){return this._source.isSourceHidden()}
getRawPoints(){return this._source.points()}getNormalizedPoints(){return this._source.normalizedPoints()}setRawPoint(e,t){this._model.startChangingLinetool(this._source,(0,r.ensureNotNull)(this._source.ownerSource()),{...t},e),this._model.changeLinePoint({...t}),this._model.endChangingLinetool(!1)}move(e,t){this._model.startMovingSources([this._source],{logical:e,screen:(0,r.ensureNotNull)(this._source.pointToScreenPoint(e))},null,new Map),this._model.moveSources({logical:t,screen:(0,r.ensureNotNull)(this._source.pointToScreenPoint(t))},new Map),this._model.endMovingSources(!1)}dataAndViewsReady(){return this._source.dataAndViewsReady()}zorder(){return this._source.zorder()}symbol(){return this._source.properties().symbol.value()}currency(){return this._source.properties().currencyId.value()}unit(){return this._source.properties().unitId.value()}share(e){this._undoModel.shareLineTools([this._source],e)}setVisible(e,t=!1){this._undoModel.setProperty(this._source.properties().visible,e,null,t)}sharingMode(){return this._source.sharingMode().value()}lineDataSource(){return this._source}template(){return this._source.template()}}class xe{constructor(e,t){this._series=e,this._undoModel=t,this._model=t.model()}isUserEditEnabled(){return this._series.userEditEnabled()}setUserEditEnabled(e){this._series.setUserEditEnabled(e)}mergeUp(){this._model.isMergeUpAvailableForSource(this._series)&&new me.MergeUpUndoCommand(this._model,this._series,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._series)&&new me.MergeDownUndoCommand(this._model,this._series,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._series)&&new pe.UnmergeUpUndoCommand(this._model,this._series,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._series)&&new pe.UnmergeDownUndoCommand(this._model,this._series,null).redo()}mergeUpWithUndo(){this._model.isMergeUpAvailableForSource(this._series)&&this._undoModel.mergeSourceUp(this._series)}mergeDownWithUndo(){this._model.isMergeDownAvailableForSource(this._series)&&this._undoModel.mergeSourceDown(this._series)}unmergeUpWithUndo(){this._model.isUnmergeAvailableForSource(this._series)&&this._undoModel.unmergeSourceUp(this._series)}unmergeDownWithUndo(){this._model.isUnmergeAvailableForSource(this._series)&&this._undoModel.unmergeSourceDown(this._series)}detachToRight(){new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"right",null).redo()}detachToLeft(){new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"left",null).redo()}detachNoScale(){new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"overlay",null).redo()}changePriceScale(e){const t=(0,r.ensureNotNull)(this._model.paneForSource(this._series));switch(e){case"new-left":new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"left",null).redo();break;case"new-right":new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"right",null).redo();break;case"no-scale":(0,
r.assert)(t.actionNoScaleIsEnabled(this._series),"Unable to leave a pane without any non-overlay price scale"),new ve.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"overlay",null).redo();break;default:const i=this._model.dataSourceForId(e);if(null===i)throw new Error(`There is no study with entityId='${e}'`);const n=this._model.paneForSource(i)===t;(0,r.assert)(n,"Study should be on the main pane");const s=(0,r.ensureNotNull)(i.priceScale());new ve.MoveToExistingPriceScaleUndoCommand(this._model,this._series,t,s,null).redo()}}isVisible(){return this._series.properties().childs().visible.value()}setVisible(e){this._series.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._series])}sendToBack(){this._model.sendToBack([this._series])}entityId(){return this._series.id()}chartStyleProperties(e,t){return t?this._series.properties().childs()[Re(e)].state():this._series.properties().childs()[Re(e)].state(["inputs","inputsInfo"])}setChartStyleProperties(e,t){this._series.properties().childs()[Re(e)].mergeAndFire(t)}barsCount(){return this._series.bars().size()}endOfData(){return this._series.endOfData()}symbolSource(){return{symbol:this._series.symbol(),currencyId:this._series.currency(),unitId:this._series.unit()}}series(){return this._series}isLoading(){return this._series.isLoading()}isInReplay(){return this._series.isInReplay()}data(){return this._series.data()}priceScale(){return new re(this._undoModel,this._series.priceScale())}seriesErrorMessage(){return this._series.seriesErrorMessage()}compositeStatusVW(){return this._series.compositeStatusVW()}properties(){return this._series.properties()}_pane(){return(0,r.ensureNotNull)(this._model.paneForSource(this._series))}}function Re(e){switch(e){case 0:return"barStyle";case 1:return"candleStyle";case 2:return"lineStyle";case 14:return"lineWithMarkersStyle";case 15:return"steplineStyle";case 3:return"areaStyle";case 16:return"hlcAreaStyle";case 4:return"renkoStyle";case 5:return"kagiStyle";case 6:return"pnfStyle";case 7:return"pbStyle";case 8:return"haStyle";case 9:return"hollowCandleStyle";case 10:return"baselineStyle";case 11:return"rangeStyle";case 12:return"hiloStyle";case 13:return"columnStyle";case 17:return"volFootprintStyle";case 18:return"tpoStyle";case 19:return"volCandlesStyle";case 20:return"svpStyle";case 21:return"hlcBarsStyle";default:(0,r.ensureNever)(e)}throw new Error(`unsupported chart style: ${e}`)}var Me=i(100148),ke=i(746262);class Oe{constructor(e){this._drawer=null,this._context=e,this._rangeBindings=new ke.RangeBinding(e)}drawer(){
return Promise.all([i.e(56579),i.e(1283),i.e(85615),i.e(56224),i.e(41881),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(30783),i.e(31481),i.e(29573),i.e(19981),i.e(14731),i.e(89923),i.e(17760),i.e(69069),i.e(59624),i.e(28304),i.e(39258),i.e(22329),i.e(88867),i.e(6998),i.e(59542),i.e(76606),i.e(17964),i.e(55196),i.e(32227),i.e(90223),i.e(14454),i.e(32880),i.e(52089),i.e(8866)]).then(i.bind(i,659543)).then((e=>(null===this._drawer&&(this._drawer=new e.DateRangeDrawerApi(this._context)),this._drawer)))}state(){return this._rangeBindings.state()}onChange(){return this._rangeBindings.onChange()}selectRange(e){this._rangeBindings.selectRange(e)}goToTime(e){const t=this._context.chartWidget.model().model();t.gotoTime(e).then((e=>{const i=t.mainSeries();void 0===e?i.clearGotoDateResult():i.setGotoDateResult(e)}))}}var Ne=i(887168);class Be{constructor(e){this._chartWidget=e}latestUpdatesLollipop(){const e=this._chartWidget.model().model(),t=e.dataSourceForId("latestUpdates");return t?{clickAtLollipop:()=>{const i=(0,r.ensureNotNull)(e.paneForSource(t)),n=(0,r.ensureNotNull)(this._chartWidget.paneByState(i)),s=n.getRenderingInfo(),o=n.canvasElement();t.clickAtLollipop(s,o,"0")}}:null}}var Fe=i(516958),Ve=i(736800),Ue=i(163263),He=i(288390),ze=i(981054);function je(e,t){const{symbolChanged:i,currencyChanged:r,unitChanged:n,styleChangeRequiresRestart:s}=e.compareSymbolParams(t);return!(i||r||n||s)}function Ge(e,t){e.isLoading()&&!e.isFailed()||t(e.isFailed());const i=e.seriesSource().symbolInstanceId(),r=e.dataEvents(),n=e.symbolParams(),s=()=>{r.error().unsubscribe(null,o),(je(e,n)||e.seriesSource().symbolInstanceId()===i)&&t(!1)},o=()=>{r.completed().unsubscribe(null,s),(je(e,n)||e.seriesSource().symbolInstanceId()===i)&&t(!0)};r.completed().subscribe(null,s,!0),r.error().subscribe(null,o,!0)}var $e=i(807850),qe=i(327734),Je=i(712474),Ye=i(500704),Xe=i(543961),Ke=(i(830842),i(776734)),Ze=i(705826);class Qe{constructor(e,t){this._controller=e,this._model=t}createGroupFromSelection(){return this._controller.createGroupFromSelection().id}removeGroup(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.removeGroup(t)}groups(){return this._controller.groups().map((e=>e.id))}shapesInGroup(e){const t=(0,r.ensureDefined)(this._groupById(e));return(0,Ze.sortSources)(t.lineTools()).map((e=>e.id()))}excludeShapeFromGroup(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),n=(0,r.ensureNotNull)(this._model.dataSourceForId(t));(0,r.assert)((0,j.isLineTool)(n),"Passed shapeId is not a line tool"),this._controller.excludeLineToolFromGroup(i,n)}addShapeToGroup(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),n=(0,r.ensureNotNull)(this._model.dataSourceForId(t));(0,r.assert)((0,j.isLineTool)(n),"Passed shapeId is not a line tool"),this._controller.addLineToolToGroup(i,n)}availableZOrderOperations(e){const t=(0,r.ensureDefined)(this._groupById(e));return this._controller.availableZOrderOperations(t)}bringToFront(e){const t=(0,r.ensureDefined)(this._groupById(e))
;this._controller.bringToFront(t)}bringForward(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.bringForward(t)}sendBackward(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.sendBackward(t)}sendToBack(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.sendToBack(t)}insertAfter(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),n=(0,r.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertAfter(i,n)}insertBefore(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),n=(0,r.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertBefore(i,n)}groupVisibility(e){return(0,r.ensureDefined)(this._groupById(e)).visibility()}setGroupVisibility(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupVisibility(i,t)}groupLock(e){return(0,r.ensureDefined)(this._groupById(e)).locked()}setGroupLock(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupLock(i,t)}getGroupName(e){return(0,r.ensureDefined)(this._groupById(e)).name().value()}setGroupName(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupName(i,t)}canBeGroupped(e){const t=e.map((e=>(0,r.ensureNotNull)(this._model.dataSourceForId(e))));return!t.some((e=>!(0,j.isLineTool)(e)))&&this._controller.canBeGroupped(t)}_groupById(e){return this._controller.groups().find((t=>t.id===e))}}var et=i(772717),tt=i(552963),it=i(758893),rt=i(600685),nt=i(150199),st=i(85558),ot=i(712509);const at=new q.TranslatedString("change price to bar ratio",$.t(null,void 0,i(702509))),lt=new q.TranslatedString("toggle lock scale",$.t(null,void 0,i(949695)));function ct(e,t){return t.map((t=>(0,r.ensureNotNull)(e.dataSourceForId(t))))}class dt{constructor(e,t){this._visibleBarsChanged=new c.Delegate,this._crosshairMoved=new c.Delegate,this._dataSourceHovered=new c.Delegate,this._ranges=null,this._zoomUndoStackIsNotEmpty=null,this._panes=new WeakMap,this._studies=new WeakMap,this._lineDataSources=new WeakMap,this._selectionApi=null,this._lollipopSourcesApi=null,this._prevVisibleRange=null,this._prevHoveredSourceId=null,this._onSymbolChangedDelegate=new c.Delegate,this._chartWidget=e,this._activateChart=t,this._timezoneApi=new ie(e),this._chartWidget.withModel(this,(()=>{this._chartWidget.model().crosshairSource().moved().subscribe(this,this._onCrosshairMoved),this._chartWidget.model().model().hoveredSourceChanged().subscribe(this,this._onHoveredSourceChanged),this._chartWidget.model().timeScale().logicalRangeChanged().subscribe(this,this._onLogicalRangeChanged),this._chartWidget.model().mainSeries().dataEvents().symbolResolved().subscribe(this,this._onSymbolChanged)})),this._widgetLinkingGroupIndex=e.linkingGroupIndex().spawn(),this._widgetLinkingGroupIndex.subscribe((e=>this._apiLinkingGroupIndex.setValue(e))),this._apiLinkingGroupIndex=new H.WatchedValue(this._widgetLinkingGroupIndex.value()),this._apiLinkingGroupIndex.subscribe((e=>{
this._widgetLinkingGroupIndex.value()!==e&&(this._chartWidget.hasModel()?this._chartWidget.model().setLinkingGroupIndex(e):this._widgetLinkingGroupIndex.setValue(e))})),this._chartWidget.onAboutToBeDestroyed().subscribe(this,this._destroy,!0)}setActive(){this._activateChart()}getPriceToBarRatio(){return this._chartWidget.model().model().mainSeriesScaleRatioProperty().value()}setPriceToBarRatio(e,t){const i=this._chartWidget.model(),r=i.model(),n=r.mainSeriesScaleRatioProperty();t?.disableUndo?new ze.SetScaleRatioPropertiesCommand(n,e,null,r).redo():i.setScaleRatioProperty(n,e,at)}isPriceToBarRatioLocked(){return this._chartWidget.model().model().mainSeries().priceScale().isLockScale()}setPriceToBarRatioLocked(e,t){const i=this._chartWidget.model(),r=i.model(),n=r.mainSeries().priceScale();t?.disableUndo?new He.SetPriceScaleModeCommand({lockScale:e},n,null,r).redo():i.setPriceScaleMode({lockScale:e},n,lt)}id(){return this._chartWidget.id()}onDataLoaded(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().completed())}onSymbolChanged(){return this._makeSubscriptionFromDelegate(this._onSymbolChangedDelegate)}onIntervalChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().onIntervalChanged())}onVisibleRangeChanged(){return this._makeSubscriptionFromDelegate(this._visibleBarsChanged)}onChartTypeChanged(){const e=this._chartWidget.model().mainSeries().onStyleChanged();return this._makeSubscriptionFromDelegate(e)}onSeriesTimeframe(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().seriesTimeFrame())}onSeriesError(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().seriesError())}dataReady(e){const t=!this._chartWidget.hasModel()||!this._chartWidget.model().mainSeries()||this._chartWidget.model().mainSeries().data().isEmpty();return e&&(t?this.onDataLoaded().subscribe(null,e,!0):e()),!t}whenChartReady(e){this._chartWidget.withModel(this,e)}crossHairMoved(){return this._makeSubscriptionFromDelegate(this._crosshairMoved)}onHoveredSourceChanged(){return this._makeSubscriptionFromDelegate(this._dataSourceHovered)}setVisibleRange(e,t){throw new Error("Not implemented")}async setSymbol(e,t){(0,ae.isFunction)(t)&&(t={dataReady:t});const{dataReady:i,doNotActivateChart:r,initiatorName:n="chart api"}=t||{},s=this._chartWidget.model().mainSeries();if(e===this.symbol()||this._chartWidget.hasModel()&&s.symbolSameAsResolved(e))return i?.(),!0;r||this._activateChart();const o=this._chartWidget.chartWidgetCollection(),a=await o.setSymbol(e,void 0,this._chartWidget);return a&&((0,Fe.trackChangeSymbol)(s,o.layout.value(),o.metaInfo.uid.value()||"",n),await new Promise((e=>{Ge(s,(t=>{!t&&i&&i(),e()}))}))),a}async setResolution(e,t){(0,ae.isFunction)(t)&&(t={dataReady:t});const{dataReady:i,doNotActivateChart:r,initiatorName:n="Chart api"}=t||{},s=J.Interval.normalize(e);if(null===s||s===this.resolution())return i?.(),!0;r||this._activateChart(),(0,Ve.trackIntervalChanging)(s,n)
;const o=await this._chartWidget.chartWidgetCollection().setResolution(s,void 0,this._chartWidget);return o&&await new Promise((e=>{Ge(this._chartWidget.model().mainSeries(),(t=>{!t&&i&&i(),e()}))})),o}async setChartType(e,t){const i=this._chartWidget.model().mainSeries();if(i.properties().childs().style.value()===e)return t?.(),!0;const r=await this._chartWidget.chartWidgetCollection().setChartStyleToWidget(e,this._chartWidget);return await new Promise((e=>{Ge(i,(i=>{!i&&t&&t(),e()}))})),r}resetData(){this._chartWidget.model().mainSeries().rerequestData()}executeActionById(e){this._chartWidget.executeActionById(e)}getCheckableActionState(e){return this._chartWidget.getCheckableActionState(e)}refreshMarks(){this._chartWidget.refreshMarks()}clearMarks(e){this._chartWidget.clearMarks(e)}getBarsMarksSources(){return this._chartWidget.model().barsMarksSources()}getAllShapes(){return this._chartWidget.model().model().allLineTools().map(se).filter((e=>null!==e.name))}getAllStudies(){return this._chartWidget.model().model().allStudies(!0).map(oe)}getStudyTemplateSnapshot(e,t,i){return(0,rt.getStudyTemplateSaveData)(e,this._chartWidget.model().model(),t,i)}getStudyTemplateDescString(){const e=(0,rt.getStudyTemplateMetaInfo)(this._chartWidget.model().model());return(0,rt.getStudyTemplateDescString)(e.indicators)}async applyStudyTemplateByRecord(e){if(!e)return;const{name:t,id:i,is_default:r}=e,n=e=>this._chartWidget.model().applyStudyTemplate(JSON.parse(e.content),t);r?await it.backend.getStandardStudyTemplateById(i,n):await it.backend.getStudyTemplateById(i).then(n)}chartTemplate(){return this._chartWidget.model().model().template()}applyChartTempalte(e){this._chartWidget.chartWidgetCollection().applyTheme(e)}getAllPanesHeight(){const e=this._chartWidget.model().model().panes();if(this._chartWidget.hasMaximizedPane()){let t=0,i=0;e.forEach((e=>{t+=e.height(),i+=e.stretchFactor()}));const r=i/t;return e.map((e=>Math.round(e.stretchFactor()/r*100)/100))}return e.map((e=>e.height()))}setAllPanesHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,r.assert)(i.length===e.length,"There`s a mismatch between the number of heights you provided and the number of panes.");const n=i.reduce(((e,t)=>e+t.stretchFactor()),0)/e.reduce(((e,t)=>e+t));e.forEach(((e,t)=>{const r=e*n;i[t].setStretchFactor(r)})),t.fullUpdate()}maximizeChart(){this._chartWidget.requestFullscreen()}isMaximized(){return this._chartWidget.inFullscreen()}restoreChart(){this._chartWidget.exitFullscreen()}restoreChartPreferences(){this._chartWidget.model().restorePreferences()}availableZOrderOperations(e){const t=ct(this._chartWidget.model().model(),e);return this._chartWidget.model().availableZOrderOperations(t)}sendToBack(e){const t=ct(this._chartWidget.model().model(),e);this._chartWidget.model().sendToBack(t)}bringToFront(e){const t=ct(this._chartWidget.model().model(),e);this._chartWidget.model().bringToFront(t)}bringForward(e){const t=ct(this._chartWidget.model().model(),e);this._chartWidget.model().bringForward(t)}sendBackward(e){
const t=ct(this._chartWidget.model().model(),e);this._chartWidget.model().sendBackward(t)}insertAfter(e,t){const i=this._chartWidget.model().model(),n=ct(i,e),s=(0,r.ensureNotNull)(i.dataSourceForId(t));this._chartWidget.model().insertAfter(n,s)}insertBefore(e,t){const i=this._chartWidget.model().model(),n=ct(i,e),s=(0,r.ensureNotNull)(i.dataSourceForId(t));this._chartWidget.model().insertBefore(n,s)}sessions(){return this._chartWidget.model().model().sessions()?.get()??null}chartModel(){return this._chartWidget.model().model()}chartUndoModel(){return this._chartWidget.model()}chartWidget(){return this._chartWidget}getTimeScaleLogicalRange(){return this._chartWidget.model().timeScale().logicalRange()}setEntityVisibility(e,t){console.warn("`setEntityVisibility` is deprecated. Use shape/study API instead");const i=this._chartWidget.model().model().dataSourceForId(e);if(!i)return;const r=i.properties();r&&r.visible&&r.visible.setValue(t)}async createStudy(e,t,i,r,n,s){if("function"==typeof n)return console.warn('"createStudy" does not take "callback" parameter anymore'),Promise.resolve(null);if(s=s||{},"string"!=typeof e)return this._createStudy(e);e=e.toLowerCase();const o=await(0,Ue.studyMetaInfoRepository)().findAllJavaStudies(),a=qe.StudyMetaInfo.findStudyMetaInfoByDescription(o,e);if(s.checkLimit){const e=this._chartWidget.model().canCreateStudy({id:a.id});if(!e.success)return(0,$e.showTooManyStudiesNotice)(e.limitValue),Promise.resolve(null)}const l=(s.disableUndo?this._chartWidget.model().model():this._chartWidget.model()).createStudyInserter({type:"java",studyId:a.id},[]);if(l.setForceOverlay(!!t),s.priceScale&&l.setPreferredPriceScale(function(e){switch(e){case"no-scale":return"overlay";case"as-series":return"as-series";case"new-left":return"left";case"new-right":return"right";default:throw new Error(`The pricescale "${e}" is invalid, the only valid options are "no-scale", "as-series", "new-left" and "new-right".`)}}(s.priceScale)),s.allowChangeCurrency&&l.setAllowChangeCurrency(!0),s.allowChangeUnit&&l.setAllowChangeUnit(!0),Array.isArray(r)){console.warn("Passing study inputs as an ordered array is now deprecated. Please use an object where keys correspond to the inputs of your study instead.");const e={};for(let t=0;t<a.inputs.length;++t)e[a.inputs[t].id]=r[t];r=e}return l.insert((()=>Promise.resolve({inputs:r||{},parentSources:[]}))).then((e=>(n&&(0,Y.applyOverridesToStudy)(e,n),i&&e.setUserEditEnabled(!1),e.id())))}waitForStudyCreated(e){return this._chartWidget.model().model().waitForStudy(e)}compileFailedStudies(){return this._chartWidget.model().model().studiesWV().value().filter((e=>e.isPine()&&e.hasCompileError()))}getStudyById(e){const t=this._chartWidget.model().model().getStudyById(e);if(null===t)throw new Error("There is no such study");return this._getStudyApi(t)}getSeries(){const e=this._chartWidget.model(),t=e.mainSeries();return new xe(t,e)}createShape(e,t){return this._createMultipointShape(this._convertUserPointsToDataSource([e]),t)}async createMultipointShape(e,t){
return this._createMultipointShape(this._convertUserPointsToDataSource(e),t)}getShapeById(e){const t=this._chartWidget.model().model().getLineToolById(e);if(null===t)throw new Error("There is no such shape");return this._getLineDataSourceApi(t)}removeEntity(e,t){const i=this._chartWidget.model().model().dataSourceForId(e);i?t&&t.disableUndo?(0,ot.removeAllSourcesWithDependencies)(this._chartWidget.model().model(),[i]):this._chartWidget.model().removeSource(i,!0,!0):console.warn(`Can't find a source with id: ${e}`)}removeEntityWithUndo(e){const t=this._chartWidget.model().model().dataSourceForId(e);t&&this._chartWidget.model().removeSource(t,!1)}removeAllShapes(){this._chartWidget.removeAllDrawingTools()}removeAllStudies(){this._chartWidget.removeAllStudies()}selection(){return null===this._selectionApi&&(this._selectionApi=new Me.SelectionApi(this._chartWidget.model().model())),this._selectionApi}showPropertiesDialog(e){const t=this._chartWidget.model().model().dataSourceForId(e);if(null===t)throw new Error(`Study or shape ${e} does not exist`);this._chartWidget.showChartPropertiesForSource(t)}createStudyTemplate(e){return this._chartWidget.model().model().studyTemplate(e.saveSymbol,e.saveInterval)}applyStudyTemplate(e){this._chartWidget.model().applyStudyTemplate(e,""+1e3*Math.random())}drawOnAllCharts(e){(0,U.drawOnAllCharts)().setValue(e)}createOrderLine(){return this._createTradingPrimitive("LineToolOrder")}createPositionLine(){return this._createTradingPrimitive("LineToolPosition")}createExecutionShape(){return this._createTradingPrimitive("LineToolExecution")}symbol(){return this._chartWidget.symbolWV().value()}symbolExt(){const e=this._chartWidget.model().mainSeries().symbolInfo();return null===e?null:{symbol:e.name,full_name:e.full_name,exchange:e.exchange,description:e.description,type:e.type,pro_name:e.pro_name,typespecs:e.typespecs,delay:e.delay}}resolution(){return this._chartWidget.model().mainSeries().interval()}marketStatus(){return this._chartWidget.model().mainSeries().marketStatusModel().currentSession().spawn()}getVisibleRange(){const e={from:0,to:0},t=this._chartWidget.model().timeScale(),i=t.visibleBarsStrictRange();if(null===i)return e;const n=i.firstBar(),s=i.lastBar(),o=this._convertIndexToPublicTime(s);if(null===o)return e;const a=Math.max((0,r.ensureNotNull)(t.points().range().value()).firstIndex,n);return e.from=(0,r.ensureNotNull)(this._convertIndexToPublicTime(a)),e.to=o,e}getVisibleBarsRange(){const e=this._chartWidget.model().timeScale(),t=e.visibleBarsStrictRange();if(null===t)return null;const i=this._convertIndexToPublicTime(t.firstBar()),r=t.lastBar()-Math.max(0,Math.ceil(e.rightOffset())),n=this._convertIndexToPublicTime(r);return null===i||null===n?null:{from:i,to:n}}getVisiblePriceRange(){if(console.warn("`getVisiblePriceRange` is deprecated. Use Price Scale API instead"),!this._chartWidget.model().mainSeries())return null;return this._chartWidget.model().mainSeries().priceScale().priceRangeInPrice()}scrollPosition(){
return console.warn("`scrollPosition` is deprecated. Use rightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().rightOffset()}defaultScrollPosition(){return console.warn("`defaultScrollPosition` is deprecated. Use defaultRightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().defaultRightOffset().value()}priceFormatter(){return this._chartWidget.model().mainSeries().priceScale().formatter()}chartType(){return this._chartWidget.model().mainSeries().properties().childs().style.value()}setTimezone(e){this._chartWidget.setTimezone(e)}getTimezone(){return this._chartWidget.getTimezone()}getTimezoneApi(){return this._timezoneApi}getPanes(){return this._chartWidget.model().model().panes().map((e=>this._getPaneApi(e)))}exportData(e){return Promise.reject("Data export is not supported")}setDragExportEnabled(e){console.error("feature is not enabled")}canZoomOut(){return!this._chartWidget.model().zoomStack().isEmpty()}canZoomOutWV(){if(!this._zoomUndoStackIsNotEmpty){const e=new H.WatchedValue(!1);this._zoomUndoStackIsNotEmpty=e.spawn(),this._chartWidget.withModel(this,(()=>{const t=this._chartWidget.model().zoomStack();t.onChange().subscribe(this,(()=>e.setValue(!t.isEmpty())))}))}return this._zoomUndoStackIsNotEmpty.readonly()}zoomOut(){this.canZoomOut()&&this._chartWidget.model().zoomFromViewport()}setZoomEnabled(e){this._chartWidget.model().model().setZoomEnabled(e)}setScrollEnabled(e){this._chartWidget.model().model().setScrollEnabled(e)}shapesGroupController(){return new Qe(this._chartWidget.model().lineToolsGroupController(),this._chartWidget.model().model())}isSelectBarRequested(){return this._chartWidget.selectPointMode().value()!==U.SelectPointMode.None}requestSelectBar(){return this.isSelectBarRequested()?Promise.reject("already requested"):new Promise(((e,t)=>{this._chartWidget.requestSelectPoint({pointType:"time"}).then((t=>{e(this._convertTimeToPublic((0,r.ensureDefined)(t.point.time)))})).catch((()=>{t("cancelled")}))}))}cancelSelectBar(){this.isSelectBarRequested()&&this._chartWidget.cancelRequestSelectPoint()}barTimeToEndOfPeriod(e){const t=this._prepareEndOfPeriodArgs();return function(e,t,i){if(i.isDays())return t;if(e.moveTo(1e3*t),i.isIntraday()){const i=e.indexOfBar(1e3*t);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.endOfBar(i)/1e3}return e.startOfBar(Z.SessionStage.LASTBAR_SESSION)/1e3}(t.barBuilder,e,t.intervalObj)}endOfPeriodToBarTime(e){const t=this._prepareEndOfPeriodArgs();return function(e,t,i){if(i.isDays())return t;const r=1e3*t-1;if(e.moveTo(r),i.isIntraday()){const i=e.indexOfBar(r);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.startOfBar(i)/1e3}return e.startOfBar(0)/1e3}(t.barBuilder,e,t.intervalObj)}createAnchoredShape(e,t){const i=()=>new Error(`Cannot create "${t.shape}" shape`),r=t.shape;if((0,V.isSupportedLineTool)(r)&&!0!==V.supportedLineTools[r].isAnchored)throw console.warn(`${r} is not an anchored shape. It can be created using createShape or createMultipointShape`),i()
;const n=this._chartWidget.model().model(),s=n.mainSeries();if(n.timeScale().isEmpty())throw i();const o=void 0!==t.ownerStudyId?n.dataSourceForId(t.ownerStudyId):s,a=this._convertPositionPercentToDataSource(e,o);if(null===a)throw i();return this._createMultipointShape([a],t)}properties(){return this._chartWidget.properties()}setBarSpacing(e){this._chartWidget.model().timeScale().setBarSpacing(e)}scrollChartByBar(e){this._chartWidget.model().scrollChartByBar(e)}mergeAllScales(e){this._chartWidget.model().mergeAllScales(e)}chartPainted(){return this._chartWidget.chartPainted()}applyOverrides(e){this._chartWidget.applyOverrides(e)}addOverlayStudy(e,t,i){return this._chartWidget.addOverlayStudy(e,t,i)}lineToolsSynchronizer(){return this._chartWidget.lineToolsSynchronizer()}cloneLineTool(e){const t=this._chartWidget.model(),i=t.model().dataSourceForId(e);return t.cloneLineTools([i],!1)[0]}shareLineTools(e,t){const i=this._chartWidget.model(),r=e.map((e=>i.model().dataSourceForId(e)));i.shareLineTools(r,t)}getLollipopSourcesApi(){return this._lollipopSourcesApi||(this._lollipopSourcesApi=new Be(this._chartWidget)),this._lollipopSourcesApi}clickAtLatestUpdatesLollipop(){0}linkingGroupIndex(){return this._apiLinkingGroupIndex.spawn()}loadingScreenActive(){return this._chartWidget.screen.isShown()}symbolResolvingActive(){for(const e of this._chartWidget.model().model().symbolSources())if(e.symbolResolvingActive().value())return!0;return!1}hasModel(){return this._chartWidget.hasModel()}disableAllUtilitySources(){{const e=this._chartWidget.properties().childs(),t=this._chartWidget.model().mainSeries().properties().childs();[t.esdShowDividends,t.esdShowSplits,t.esdShowEarnings,t.showContinuousContractSwitches,t.showFuturesContractExpiration,t.showLastNews,e.chartEventsSourceProperties.childs().visible].forEach((e=>e.setValue(!1)))}}chartProto(){return st.ChartWidget.prototype}ranges(){return null===this._ranges&&(this._ranges=new Oe({chartWidget:this._chartWidget,chartWidgetCollection:this._chartWidget.chartWidgetCollection(),availableTimeFrames:Ne.availableTimeFrames})),this._ranges}getTimeScale(){return new Q(this._chartWidget.model().timeScale())}async loadChartTemplate(e){await(0,B.loadTheme)(this._chartWidget.chartWidgetCollection(),{themeName:e,standardTheme:!1,noUndo:!1,onlyActiveChart:!0})}setTimeFrame(e){this.setActive(),this._chartWidget.loadRange(e)}async syncTime(e){if(this._chartWidget.hasModel()){const t=this._chartWidget.model().model(),i=t.mainSeries().syncModel();if(i)return t.syncTimeWithModel(i.syncSourceTarget(),e)}}syncDateRange(e,t){this._chartWidget.hasModel()&&this._chartWidget.model().model().gotoTimeRange(e,t)}getLineToolsState(e=1,t,i){this._canUseLineToolsSynchronizer("getLineToolsState");const n=i??!1;return(0,r.ensureNotNull)(this.lineToolsSynchronizer()).getDTO(e,t,n)}async applyLineToolsState(e){this._canUseLineToolsSynchronizer("applyLineToolsState"),await(0,r.ensureNotNull)(this.lineToolsSynchronizer()).applyDTO(e)}reloadLineToolsFromServer(){
this._canUseLineToolsSynchronizer("reloadLineToolsFromServer"),(0,r.ensureNotNull)(this.lineToolsSynchronizer()).reloadAllLineTools()}studyMetaIntoRepository(){return(0,Ue.studyMetaInfoRepository)()}replayStatus(){return this._chartWidget.model().model().replayStatus()}replayStudyStrategyProperties(){return this._chartWidget.model().model().replayStudyStrategyProperties()}insertStudyWithoutCheck(e,t,i,r,n){return this._chartWidget.model().insertStudyWithoutCheck(new qe.StudyMetaInfo(e,n),t,i,r)}copyEntityToClipboard(e){const t=this._chartWidget.model().model().dataSourceForId(e);t&&this._chartWidget.chartWidgetCollection().clipboard.uiRequestCopy([t])}pasteFromClipboard(){this._chartWidget.chartWidgetCollection().clipboard.uiRequestPaste()}inactivityGaps(){return this._chartWidget.model().model().inactivityGaps()}setInactivityGapsSession(e){this._chartWidget.model().model().setInactivityGapsSession(e)}_destroy(){this._zoomUndoStackIsNotEmpty?.destroy(),this._chartWidget.hasModel()&&(this._chartWidget.model().crosshairSource().moved().unsubscribeAll(this),this._chartWidget.model().timeScale().logicalRangeChanged().unsubscribe(this,this._onLogicalRangeChanged),this._chartWidget.model().zoomStack().onChange().unsubscribeAll(this)),this._chartWidget.modelCreated().unsubscribeAll(this),this._widgetLinkingGroupIndex.destroy()}async _createTradingPrimitive(e){const t=this._chartWidget.model(),i=t.model(),n=(0,r.ensureNotNull)(i.paneForSource(i.mainSeries()));await(0,nt.ensureLineToolLoaded)(e);const s={pane:n,point:(()=>{const e=(0,r.ensureNotNull)(t.mainSeries().bars().last());return{index:e.index,price:e.value[4],interval:i.mainSeries().interval()}})(),linetool:e,actionSource:"API"};return i.createLineTool(s).adapter()}_createStudy(e){return new Promise(((t,i)=>{this._chartWidget.insertStudy(e,[]).then((e=>{null===e?i("Failed to create study"):t(e.id())}))}))}_convertTimeToPublic(e){return this._getTimeConverter().convertInternalTimeToPublicTime(e)}_convertIndexToPublicTime(e){return null===this._chartWidget.model().mainSeries().symbolInfo()?null:this._getTimeConverter().convertTimePointIndexToPublicTime(e)}_convertPositionPercentToDataSource(e,t){const i=this._chartWidget.model().timeScale(),r=t.priceScale(),n=t.firstValue();if(null==n||!isFinite(n)||null===r)return null;const s=i.coordinateToIndex(e.x*i.width());return{price:r.coordinateToPrice(e.y*r.height(),n),index:s}}_convertUserPointsToDataSource(e){const t=this._chartWidget.model().model(),i=t.mainSeries(),n=t.timeScale().points(),s=i.data();if(t.timeScale().isEmpty())return null;const o=e.map((e=>e.time||0)),a=this._alignPoints(o),l=(e,t,o)=>{const a=n.closestIndexLeft(e)||0,l={index:a,price:NaN},c=(0,r.ensureNotNull)(n.valueAt(a)),d=(0,r.ensureNotNull)(n.range().value());if(e>c&&a===d.lastIndex){const t=(0,r.ensureNotNull)(i.syncModel()).distance(c,e);t.success&&(l.index=l.index+t.result)}else if(e<c&&a===d.firstIndex){const t=(0,r.ensureNotNull)(i.syncModel()).distance(e,c);t.success&&(l.index=l.index-t.result)}if((0,ae.isNumber)(t))l.price=t;else{
let e=o?["open","high","low","close"].indexOf(o)+1:1;e<=0&&(e=1),l.price=(0,r.ensure)((0,r.ensureNotNull)(s.valueAt(a))[e])}return l},c=[];for(let t=0;t<e.length;t++){const i=e[t];c.push(l(a[t],i.price,i.channel))}return c}async _createMultipointShape(e,t){const i=()=>new Error(`Cannot create "${n.shape}" shape`),n=Object.assign({},{filled:!0},t),s=V.supportedLineTools[n.shape]||V.supportedLineTools.flag;(0,k.trackEvent)("API","CreateDrawing",s.name),(0,Ke.getTracker)().then((e=>{null!==e&&e.trackChartApiDrawingCreation(s.name)}));const o=this._chartWidget.model().model(),a=o.mainSeries();if(o.timeScale().isEmpty())throw i();const l=void 0!==n.ownerStudyId?o.dataSourceForId(n.ownerStudyId)??a:a,c=o.paneForSource(l);if(null===e||null===c)throw i();if(s.onlySelectable)throw new Error(`Cannot create "${n.shape}" shape`);if("LineToolIcon"===s.name){const e=n;if(e.icon=e.icon||e.overrides&&e.overrides.icon,!n.hasOwnProperty("icon"))throw new Error("icon must be specified in options");e.overrides=e.overrides||{},e.overrides.icon=e.icon}await(0,nt.ensureLineToolLoaded)(s.name);const d=(0,j.createLineToolProperties)(o.backgroundTheme().spawnOwnership(),s.name,!o.readOnly());if((0,j.prepareLineToolPropertiesByOwnerSource)(d,l),n.overrides)for(const e in n.overrides)d.hasChild(e)?(0,r.ensureDefined)(d.child(e)).mergeAndFire(n.overrides[e]):Le(s.name)&&-1!==["profitLevel","stopLevel"].indexOf(e)&&d.addProperty(e,n.overrides[e]);let h;void 0!==d.hasChild("text")&&n.text&&(0,r.ensureDefined)(d.child("text")).setValue(n.text),d.hasChild("filled")&&n.filled&&(0,r.ensureDefined)(d.child("filled")).setValue(!0),h=n.disableUndo?this._chartWidget.model().model():this._chartWidget.model(),n.template&&this.chartModel().undoModel().applyLineToolsTemplate({properties:d,data:n.template});const u=h.createLineTool({pane:c,point:e[0],linetool:s.name,properties:d,ownerSource:l,actionSource:"API"});if(null===u)throw d.destroy(),i();if(u.properties()!==d&&d.destroy(),Le(s.name)){if(e.length>2)throw new Error(`Wrong points count for ${n.shape}. Required 1 or 2`);2===e.length&&(u.startChanging(1,e[1]),u.setPoint(1,e[1]),u.endChanging(!0,!1))}else{const t=u.pointsCount();if(t!==e.length&&-1!==t)throw new Error(`Wrong points count for ${n.shape}. Required ${t}`);const i=new tt.EnvironmentState(void 0,!0),r=(0,et.isLineDrawnWithPressedButton)(s.name);for(let t=1;t<e.length&&this._chartWidget.model().lineBeingCreated();t++)u.setLastPoint(e[t]),h.continueCreatingLine(e[t],i,t<e.length-1||r);(0,et.isLineToolFinishRequiredWhenCreatedByApi)(s.name)&&(u.finish(),h.finishLineTool(u),h.continueCreatingLine(e[e.length-1],i,!1))}if(n.lock&&u.setUserEditEnabled(!1),n.disableSelection&&u.setSelectionEnabled(!1),n.disableSave&&(void 0===u.customization&&(u.customization={}),u.customization.disableSave=!0),n.hasOwnProperty("showInObjectsTree")&&(void 0===u.customization&&(u.customization={}),u.customization.showInObjectsTree=n.showInObjectsTree),n.zOrder){const e=this._chartWidget.model().availableZOrderOperations([u])
;"top"===n.zOrder&&e.bringToFrontEnabled?h.bringToFront([u]):"bottom"===n.zOrder&&e.sendToBackEnabled&&h.sendToBack([u])}return u.id()}_convertTimeFromPublic(e){return this._getTimeConverter().convertPublicTimeToInternalTime(e)}_getTimeConverter(){const e=this._chartWidget.model().mainSeries();return(0,Je.getChartWidgetApiTimeConverter)(e.interval(),(0,r.ensureNotNull)(e.symbolInfo(),"main series symbol info"),this._chartWidget.model().model())}_onHoveredSourceChanged(e){const t=null!==e&&(0,Xe.isPriceDataSource)(e)?e.id():null,i=this._prevHoveredSourceId;this._prevHoveredSourceId=t,t!==i&&this._dataSourceHovered.fire(t)}_onCrosshairMoved(e){{const t=this._convertIndexToPublicTime(e.index);if(null===t)return;return void this._crosshairMoved.fire({price:e.price,time:t})}}_makeSubscriptionFromDelegate(e){return{subscribe:e.subscribe.bind(e),unsubscribe:e.unsubscribe.bind(e),unsubscribeAll:e.unsubscribeAll.bind(e)}}_prepareEndOfPeriodArgs(){const e=this._chartWidget.model().model(),t=e.timezone(),i=(0,r.ensureNotNull)(e.mainSeries().symbolInfo()),n=e.mainSeries().interval(),s=new X.SessionInfo(t,i.session,i.session_holidays,i.corrections);return{barBuilder:(0,K.newBarBuilder)(n,s,s),intervalObj:J.Interval.parse(n)}}_getPaneApi(e){let t=this._panes.get(e);return void 0===t&&(t=new he(e,this._chartWidget),this._panes.set(e,t)),t}_getStudyApi(e){let t=this._studies.get(e);return void 0===t&&(t=new Ae(e,this._chartWidget),this._studies.set(e,t)),t}_getLineDataSourceApi(e){let t=this._lineDataSources.get(e);return void 0===t&&(t=new De(e,this._chartWidget.model(),{apiPointsToDataSource:this._convertUserPointsToDataSource.bind(this),dataSourcePointsToPriced:e=>{const t=(0,r.ensureNotNull)(this._chartWidget.model().mainSeries().syncModel()),i=this._chartWidget.model().timeScale();return e.map((e=>{const r=i.normalizeBarIndex(e.index);return{price:e.price,time:this._convertTimeToPublic(t.projectTime(r.time_t,r.offset))}}))}}),this._lineDataSources.set(e,t)),t}_alignPoints(e){const t=this._chartWidget.model().model(),i=t.mainSeries(),r=i.interval(),n=i.symbolInfo();if(t.timeScale().isEmpty()||!J.Interval.isDWM(r)||null===n)return e;const s=(0,Ye.createDwmAligner)(r,n);return null===s?e:e.map((e=>s.timeToSessionStart(1e3*e)/1e3))}_onLogicalRangeChanged(){const e=this._chartWidget.model().mainSeries(),t=e.data().isEmpty();if(null!==this._chartWidget.model().timeScale().visibleBarsStrictRange()&&t)return void e.dataEvents().completed().subscribe(this,this._onLogicalRangeChanged,!0);const i=this.getVisibleRange();null!==this._prevVisibleRange&&(0,ae.deepEquals)(this._prevVisibleRange,i)[0]||(this._prevVisibleRange=i,this._visibleBarsChanged.fire(i))}_canUseLineToolsSynchronizer(e){0}_onSymbolChanged(e){var t;this._onSymbolChangedDelegate.fire({name:(t=e).name,base_name:t.base_name,ticker:t.ticker,description:t.description,long_description:t.long_description,type:t.type,session:t.session,session_display:t.session_display,session_holidays:t.session_holidays,corrections:t.corrections,exchange:t.exchange,
listed_exchange:t.listed_exchange,timezone:t.timezone,format:t.format,pricescale:t.pricescale,minmov:t.minmov,fractional:t.fractional,minmove2:t.minmove2,variable_tick_size:t.variable_tick_size,has_intraday:t.has_intraday,supported_resolutions:t.supported_resolutions,intraday_multipliers:t.intraday_multipliers,has_seconds:t.has_seconds,has_ticks:t["is-tickbars-available"],seconds_multipliers:t.seconds_multipliers,build_seconds_from_ticks:t.build_seconds_from_ticks,has_daily:t.has_daily,daily_multipliers:t.daily_multipliers,has_weekly_and_monthly:t.has_weekly_and_monthly,weekly_multipliers:t.weekly_multipliers,monthly_multipliers:t.monthly_multipliers,has_empty_bars:t.has_empty_bars,visible_plots_set:t.visible_plots_set,volume_precision:t.volume_precision,data_status:t.data_status,delay:t.delay,expired:t.expired,expiration_date:t.expiration_date,sector:t.sector,industry:t.industry,currency_code:t.currency_code,original_currency_code:t.original_currency_code,unit_id:t.unit_id,original_unit_id:t.original_unit_id,unit_conversion_types:t.unit_conversion_types,subsession_id:t.subsession_id,subsessions:t.subsessions,price_source_id:t.price_source_id,price_sources:t.source2?[t.source2]:[],logo_urls:t.library_custom_fields?.logo_urls,exchange_logo:t.library_custom_fields?.exchange_logo,library_custom_fields:t.library_custom_fields})}}var ht=i(454546),ut=i(900069),gt=i(10178),_t=i(779923),pt=i(300459),mt=i(332450),vt=i(505754),St=i(861482),ft=i(421999),yt=i(514183),bt=i(357517),wt=i(884934);let Ct=null;var Tt=i(83620),Pt=i(204194),At=i(33591);const It="alert_service";class Wt{constructor(e,t){this.ALERT_DIALOG_CREATE_INVOCATION_ID=At.ALERT_DIALOG_CREATE_INVOCATION_ID,this._messageDelegate=new c.Delegate,this._onAlertsCreated=e=>{this._onAlertsMessage({m:"alerts_created",p:e})},this._onAlertsUpdated=e=>{this._onAlertsMessage({m:"alerts_updated",p:e})},this._onAlertsDeleted=e=>{this._onAlertsMessage({m:"alerts_deleted",p:e})},this._onAlertFired=e=>{this._onAlertsMessage({m:"alert_fired",p:e})},this._onFiresDeleted=e=>{this._onAlertsMessage({m:"fires_deleted",p:e})},this._getDataSourceHub=e,this._alertsPushApi=t,this._subscribeToPushApi(),this._watchlistsCouplingModule=this._loadWatchlistModule()}destroy(){this._unsubscribeFromPushApi()}showCreateAlertDialog(e){return new Promise(((t,i)=>{(0,Tt.invokeAlertEditor)({mode:Tt.AlertEditorInvocationMode.CreateAlert,actionSource:It,dataSourceHub:this._getDataSourceHub(),onDialogOpened:t,onAborted:i,...e?.presets,...this._extractAnalyticsFromDialogOptions(e)})}))}setActiveWatchlist(e){(0,Pt.setMobileAppActiveWatchlistId)(e)}getAlertDialogInvocations(){return At.alertEditorInvocationHandler.getDialogInvocations()}showEditAlertDialog(e,t){return new Promise(((i,r)=>{(0,Tt.invokeAlertEditor)({mode:Tt.AlertEditorInvocationMode.EditAlert,alertId:Number(e),actionSource:It,dataSourceHub:this._getDataSourceHub(),onDialogOpened:i,onAborted:r,...this._extractAnalyticsFromDialogOptions(t)})}))}async getWatchlistSymbolsDangerReasons(e){
const{getWatchlistsStates:t,getWatchlistDangerReasonSymbols:i}=await this._watchlistsCouplingModule,r=(await t()).get(e);if(!r||!r.symbols?.length)return null;return i(r.symbols)??null}subscribe(e){this._messageDelegate.subscribe(null,e)}unsubscribe(e){e?this._messageDelegate.unsubscribe(null,e):this._messageDelegate.unsubscribeAll(null)}_subscribeToPushApi(){this._alertsPushApi.on("alerts_created",this._onAlertsCreated),this._alertsPushApi.on("alerts_updated",this._onAlertsUpdated),this._alertsPushApi.on("alerts_deleted",this._onAlertsDeleted),this._alertsPushApi.on("alert_fired",this._onAlertFired),this._alertsPushApi.on("fires_deleted",this._onFiresDeleted)}_unsubscribeFromPushApi(){this._alertsPushApi.off("alerts_created",this._onAlertsCreated),this._alertsPushApi.off("alerts_updated",this._onAlertsUpdated),this._alertsPushApi.off("alerts_deleted",this._onAlertsDeleted),this._alertsPushApi.off("alert_fired",this._onAlertFired),this._alertsPushApi.off("fires_deleted",this._onFiresDeleted)}_onAlertsMessage(e){this._messageDelegate.fire({source:"pricealerts",data:e})}async _loadWatchlistModule(){return Promise.all([i.e(31741),i.e(55091),i.e(2139),i.e(19759)]).then(i.bind(i,502139))}_extractAnalyticsFromDialogOptions(e){return{method:e?.analytics?.method??e?.method,source:e?.analytics?.source??e?.source}}}var Lt=i(742418),Et=i(277038),Dt=i(666054),xt=i(262078),Rt=i(312941),Mt=i(613122),kt=i(605500),Ot=i(584878);function Nt(){throw new Error("not implemented")}const Bt=(0,p.isOnMobileAppPage)("any")&&(!l.enabled("mobile_apps_distinguish_pro_full_name")||(0,T.isFeatureEnabled)("ignore_mobile_apps_distinguish_pro_full_name"));function Ft(e){const t=new H.WatchedValue(e.value()),i=t=>{(0,z.allowSavingDefaults)(!0),e.setValue(t),(0,z.allowSavingDefaults)(!1)};return t.subscribe(i),e.subscribe(t,(()=>{t.setValue(e.value())})),t.spawn((()=>{e.unsubscribeAll(t),t.unsubscribe(i)}))}class Vt extends vt.TradingViewAuthApi{constructor(e){super(),this.linking=o.linking,this._lockDrawingsWatchedValue=null,this._hideDrawingsWatchedValue=null,this._hideIndicatorsWatchedValue=null,this._studyTemplatesDrawer=null,this._fontIconsSettingsDrawer=null,this._favoriteDrawingsToolbar=null,this._webview=null,this._activeChartWidgetWV=new H.WatchedValue(null),this._activeChartRangeState=new s.WatchedObject({ranges:[]}),this._themesApi=null,this._newsApiDeferredPromise=null,this._newsApiRejectionReason=null,this._watchlistApiDeferredPromise=null,this._watchlistApiRejectionReason=null,this._widgetbarApiDeferredPromise=null,this._widgetbarApiRejectionReason=null,this._isDestroyed=!1,this._widgebarApi=null,this._chartWidgets=new WeakMap,this._layoutSettingsDrawer=null,this._magnetEnabledWV=null,this._magnetModeWV=null,this._magnetSnapsToIndicatorsWV=null,this._drawOnAllCharts=(0,ut.convertPropertyToWatchedValue)((0,U.drawOnAllCharts)()),this._replayApi=null,this._pineEditorApi=null,this._backtestingStrategyApi=null,this._supportTicketData=null,this._activeChartWidgetChangedDelegate=new c.Delegate,this._alerts=null,this._activateChart=e=>{
this.setActiveChart(this._chartIndex(e))};const{chartApiInstance:t,chartWidgetCollection:i,studyMarket:r,saveChartService:n,loadChartService:l,sharingChartService:d=null,webview:h=null,favoriteServices:u,alertsServices:g,supportTicketData:_=null}=e;this._chartApiInstance=t,this._chartWidgetCollection=i,this._studyMarket=r,this._saveChartService=n,this._sharingChartService=d,this._loadChartService=l,this._favoriteServices=u,this._intervalsService=new P.IntervalsService(t?.defaultResolutions),this._alertsWidgetDialog=new A.AlertsWidgetDialog((()=>i.activeChartWidget.value())),this._detailsDialogController=I.DetailsDialogController.getInstance(),this._supportedChartStylesSpawn=o.linking.supportedChartStyles.spawn(),this._chartWidgetCollection.onAboutToBeDestroyed.subscribe(null,(()=>this.destroy()),!0),this._webview=h,this._alertService=g?new Wt((()=>this._chartWidgetCollection.activeChartWidget.value().model().model()),g.alertsPushApi):null,this._supportTicketData=_;const p=i.lock;if(this._symbolSync=p.symbol.spawn(),this._intervalSync=p.interval.spawn(),this._dateRangeSync=p.dateRange.spawn(),this._crosshairSync=p.crosshair.spawn(),this._timeSync=p.trackTime.spawn(),this._chartWidgetCollection.activeChartWidget.subscribe((()=>this._onActiveChartChanged()),{callWithLast:!0}),Bt){const e=this.linking.symbol,t=this.linking.proSymbol,i=Object.create(t);i.setValue=(t,i)=>e.setValue(t,i),this.linking=Object.create(this.linking,{symbol:{configurable:!1,get:()=>i}})}a.subscribe("toggle_currency_menu_inner",((...e)=>{this._toggleUnitConversionMenu("toggle_currency_menu",...e)}),this),a.subscribe("toggle_unit_menu_inner",((...e)=>{this._toggleUnitConversionMenu("toggle_unit_menu",...e)}),this),a.subscribe("toggle_series_status_tooltip_inner",((...e)=>{this._toggleSeriesStatusTooltip(...e)}),this)}destroy(){this._supportedChartStylesSpawn.destroy(),this._intervalsService?.destroy(),this._themesApi?.destroy(),this._widgebarApi?.destroy(),this._widgetbarApiRejectionReason="This ITradingViewApi instance has been destroyed",this._symbolSync.destroy(),this._intervalSync.destroy(),this._dateRangeSync.destroy(),this._crosshairSync.destroy(),this._timeSync.destroy(),this._drawOnAllCharts.destroy(),this._pineEditorApi?.destroy(),this._isDestroyed=!0,this._magnetEnabledWV?.destroy(),this._magnetModeWV?.destroy(),this._magnetSnapsToIndicatorsWV?.destroy(),a.unsubscribeAll("toggle_currency_menu_inner",this),a.unsubscribeAll("toggle_unit_menu_inner",this),a.unsubscribeAll("toggle_series_status_tooltip_inner",this)}themes(){return null===this._themesApi&&(this._themesApi=new F({chartWidgetCollection:this._chartWidgetCollection})),this._themesApi}dialogs(){return{Indicators:this._studyMarket,Compare:this._chartWidgetCollection.getCompareDialogRenderer(),ObjectsTree:u.ObjectTreeDialogController.getInstance(),ChartProperties:this._chartWidgetCollection.getChartPropertiesDialogRenderer(),ChartLayoutSaveAs:this._saveChartService?.getSaveAsController()??null,ChartLayoutRename:this._saveChartService?.getRenameController()??null,
ChartLayoutCreate:this._saveChartService?.getCreateController()??null,ChartLayoutLoad:this._loadChartService,Alerts:this._alertsWidgetDialog,Details:this._detailsDialogController,FinancialsCharts:L.FinancialsDialogController.getInstance(),Technicals:W.TechnicalsDialogController.getInstance(),Forecast:E.ForecastDialogController.getInstance()}}subscribe(e,t){a.subscribe(e,t,void 0)}unsubscribe(e,t){a.unsubscribe(e,t,void 0)}onActiveChartChanged(){return this._activeChartWidgetChangedDelegate}webview(){return this._webview||Nt(),this._webview}connect(){this._chartApiInstance&&!this._chartApiInstance.connected()&&this._chartApiInstance.connect(),xt.pushStreamMultiplexer.forceConnect()}disconnect(){this._chartApiInstance&&this._chartApiInstance.connected()&&this._chartApiInstance.disconnect(),xt.pushStreamMultiplexer.isConnected()&&xt.pushStreamMultiplexer.disconnect()}onConnectionStatusChanged(e){xt.pushStreamMultiplexer.onStatus(e)}isConnected(){return xt.pushStreamMultiplexer.status()===Dt.ConnectionStatus.Open}supportTicketData(){return this._supportTicketData}setPublishChartOptions(e){(0,Lt.setPublishChartOptions)(e)}publishChart(e){return(0,Lt.publishChart)(e)}studyTemplatesDrawerApi(){return Promise.all([i.e(23854),i.e(85615),i.e(41881),i.e(58882),i.e(26628),i.e(30783),i.e(69295),i.e(69069),i.e(30862),i.e(65284),i.e(73688),i.e(43868),i.e(92161),i.e(10742),i.e(434),i.e(55214),i.e(24787),i.e(25566),i.e(30642),i.e(70321),i.e(58186),i.e(32227),i.e(75092),i.e(17170)]).then(i.bind(i,542281)).then((e=>(this._studyTemplatesDrawer||(this._studyTemplatesDrawer=new e.ToolWidgetTemplatesDrawerMenuRenderer(this._chartWidgetCollection)),this._studyTemplatesDrawer)))}fontIconsSettingsDrawer(){return Promise.all([i.e(80039),i.e(85615),i.e(69069),i.e(65284),i.e(73688),i.e(46321),i.e(82945),i.e(91847),i.e(34639),i.e(32227),i.e(87473),i.e(58319),i.e(64558)]).then(i.bind(i,873767)).then((e=>(this._fontIconsSettingsDrawer||(this._fontIconsSettingsDrawer=new e.IconsSettingsDrawerApi),this._fontIconsSettingsDrawer)))}intervalsService(){return this._intervalsService}alertService(){return this._alertService}async alerts(){if(null!==this._alerts)return this._alerts;{const e=await i.e(60054).then(i.bind(i,733132));return this._alerts=e.initAlertsNamespace(),this._alerts}}supportedChartTypes(){return this._supportedChartStylesSpawn}setBrokerName(e){this._chartWidgetCollection.setBroker(e)}getDrawOnAllCharts(){return(0,U.drawOnAllCharts)().value()}drawOnAllCharts(e){return(0,U.drawOnAllCharts)().setValue(e)}drawOnAllChartsEnabled(){return this._drawOnAllCharts}getDrawOnAllChartsMode(){return(0,U.drawOnAllChartsMode)().value()}drawOnAllChartsMode(e){(0,U.drawOnAllChartsMode)().setValue(e)}currencies(){return this._chartApiInstance?.availableCurrencies()??Promise.reject()}units(){return this._chartApiInstance?.availableUnits()??Promise.reject()}disableTrackingEvents(){(0,k.disableTrackingEvents)(),(0,kt.disableSnowplowTrackingEvents)()}getSaveChartService(){return this._saveChartService}symbolSync(){return this._symbolSync}intervalSync(){
return this._intervalSync}dateRangeSync(){return this._dateRangeSync}crosshairSync(){return this._crosshairSync}timeSync(){return this._timeSync}setSymbolSearchUI(e){x.SymbolSearchUI.setProvider({getSymbol:()=>e.getSymbol()})}chart(e=0){if(e<0||e>=this.chartsCount())throw Error("Incorrect index: "+e);return this._getChartWidgetApi(this._chartWidgetCollection.getAll()[e])}*charts(){for(let e=0;e<this.chartsCount();e++)yield this.chart(e)}activeChart(){return this._getChartWidgetApi(this._activeChartWidget())}activeChartRangesState(){return this._activeChartRangeState}setActiveChart(e){if(e>=0&&e<this.chartsCount()){const t=this._chartWidgetCollection.getAll()[e];t&&(this._activeChartWidget().inFullscreen()?t.requestFullscreen():this._chartWidgetCollection.activeChartWidget.setValue(t))}}async replayApi(){if(null===this._chartApiInstance)throw new Error("replay api isn't available");if(null!==this._replayApi)return this._replayApi;{await Promise.all(this._chartWidgetCollection.getAll().map(C.waitForModel));const{controller:e,createReplayWV:t}=await(0,ft.getReplayUiControllerInstance)(this._chartWidgetCollection,(0,r.ensureNotNull)(this._chartApiInstance));if(null===this._replayApi){const i=t?.(this._chartWidgetCollection,e);this._replayApi=new f((0,r.ensureNotNull)(e),this._chartWidgetCollection,i)}return this._replayApi}}async backtestingStrategyApi(){if(null===this._chartApiInstance)throw new Error("backtesting api isn't available");if(null===this._backtestingStrategyApi){await Promise.all(this._chartWidgetCollection.getAll().map(C.waitForModel));const{facade:e}=await function(e){const t=t=>({facade:new t.BacktestingStrategyFacade(e)});return Ct||(Ct=Promise.all([i.e(18014),i.e(32227),i.e(40263),i.e(14105)]).then(i.bind(i,689352)).then(t)),Ct}(this._chartWidgetCollection);this._backtestingStrategyApi=e}return this._backtestingStrategyApi}pineEditorApi(){return this._pineEditorApi=this._pineEditorApi??new w,this._pineEditorApi}activeChartIndex(){return this._chartIndex(this._activeChartWidget())}chartsCount(){return g.layouts[this.layout()].count}layout(){return this._chartWidgetCollection.layout.value()}layoutName(){return this._chartWidgetCollection.metaInfo.name.value()}layoutNameWatchedValue(){return this._chartWidgetCollection.metaInfo.name.readonly()}async layoutSettingsDrawer(){{const e=await Promise.all([i.e(7374),i.e(69069),i.e(43887),i.e(43868),i.e(89342),i.e(24770),i.e(37093),i.e(30081),i.e(32227),i.e(45289)]).then(i.bind(i,927306));return this._layoutSettingsDrawer||(this._layoutSettingsDrawer=new e.LayoutSettingsDrawerApi(this._chartWidgetCollection)),this._layoutSettingsDrawer}}setLayout(e,t){t?.withUndo?this._chartWidgetCollection.setChartLayoutWithUndo(e):this._chartWidgetCollection.setLayout(e)}resetLayoutSizes(e){this._chartWidgetCollection.resetLayoutSizes(e)}setLayoutSizes(e,t){this._chartWidgetCollection.setLayoutSizes(e,t)}unloadUnusedCharts(){this._chartWidgetCollection.unloadUnusedCharts()}moveActiveChart(e){this._chartWidgetCollection.moveActiveChartWithUndo(e)}
async openPublicationViewPopup(e){await(0,Mt.openPublicationViewPopup)({uid:e})}async closePublicationViewPopup(){await(0,Mt.closeCurrentPublicationViewPopup)()}undoRedoState(){return this._chartWidgetCollection.undoHistory.state()}clearUndoHistory(){return this._chartWidgetCollection.undoHistory.clearStack()}undo(){this._chartWidgetCollection.undoHistory.undo()}redo(){this._chartWidgetCollection.undoHistory.redo()}async selectLineTool(e,t,i){if(!(0,V.isSupportedLineTool)(e))return;const r=V.supportedLineTools[e].name;if("icon"===e){const e=t?.icon;void 0!==e&&U.iconTool.setValue(e)}if(await(0,j.initLineTool)(r),"emoji"===e){const e=t?.emoji;void 0!==e&&U.emojiTool.setValue(e)}if("sticker"===e){const e=t?.sticker;void 0!==e&&U.stickerTool.setValue(e)}U.tool.setValue(r),(0,ht.trackDrawingToolSelected)(r,i)}favoriteDrawingsToolbar(){return i.e(65551).then(i.bind(i,814831)).then((e=>(this._favoriteDrawingsToolbar||(this._favoriteDrawingsToolbar=new e.FavoriteDrawingsApi),this._favoriteDrawingsToolbar)))}sharingChart(){return this._sharingChartService}watchlist(){Nt()}setWatchlistApiPromise(e){Nt()}news(){Nt()}setNewsApiPromise(e){Nt()}widgetbar(){Nt()}setWidgetbarApiPromise(e){Nt()}getChartStorage(){return(0,D.getChartStorage)()}setDebugMode(e){l.setEnabled("charting_library_debug_mode",e)}setFeatureEnabled(e,t){"chart_crosshair_menu"!==e?l.setEnabled(e,t):addPlusButtonProperty.setValue(t)}magnetEnabled(){return null===this._magnetEnabledWV&&(this._magnetEnabledWV=Ft((0,U.properties)().childs().magnet)),this._magnetEnabledWV}magnetMode(){return null===this._magnetModeWV&&(this._magnetModeWV=Ft((0,U.properties)().childs().magnetMode)),this._magnetModeWV}magnetSnapsToIndicators(){return null===this._magnetSnapsToIndicatorsWV&&(this._magnetSnapsToIndicatorsWV=Ft((0,U.properties)().childs().magnetSnapsToIndicators)),this._magnetSnapsToIndicatorsWV}flushBufferedData(){G.flushDelegate.fire()}chartWidgetCollectionState(e){return this._chartWidgetCollection.state(e)}chartWidgetCollectionSeriesStatuses(){return this._chartWidgetCollection.chartSeriesStatuses()}watermark(){Nt()}setContextMenuOptions(e){Vt.setContextMenuOptions(e)}changeSymbol(e,t,i,n="API"){o.linking.setIntervalAndLogInitiator((0,r.ensureNotNull)(J.Interval.normalize(t)),n),o.linking.setSymbolAndLogInitiator(e,n),i&&this.activeChart().onDataLoaded().subscribe(null,i,!0)}closePopupsAndDialogs(){d.ContextMenuManager.hideAll(),a.emit(mt.CLOSE_POPUPS_AND_DIALOGS_COMMAND)}startFullscreen(){return this._chartWidgetCollection.startFullscreen()}exitFullscreen(){return this._chartWidgetCollection.exitFullscreen()}getFavoriteChartStylesService(){if(this._favoriteServices)return this._favoriteServices.favoriteChartStylesService;Nt()}getFavoriteIntervalsService(){if(this._favoriteServices)return this._favoriteServices.favoriteIntervalsService;Nt()}getFavoriteCurrencyUnitConversionApi(){if(this._favoriteServices)return this._favoriteServices.favoriteCurrencyUnitConversionApi;Nt()}getIntervals(){let e=[];const t=(0,pt.getCustomResolutions)()
;return null!==this._chartApiInstance&&(e=this._chartApiInstance.defaultResolutions()),(0,pt.mergeResolutions)(e,t)}getLinetoolsFavoritesStore(){if(this._favoriteServices)return this._favoriteServices.lineToolsFavoritesService;Nt()}getSavedCharts(e){it.backend.getCharts().then(e)}getStudiesList(){Nt()}getStudyInputs(e){Nt()}getStudyStyles(e){Nt()}getSymbolInterval(e){const t={symbol:this.linking.proSymbol.value(),interval:this.linking.interval.value()};return e?.(t),t}hasChartChanges(){return this._chartWidgetCollection.hasChanges()}async loadChart(e){Nt()}async loadChartFromServer(e){await(this._loadChartService?.loadChart(e,!1))}async loadLayoutFromServerByLayoutId(e,t,i){await(this._loadChartService?.loadChartByUrl(e,!!t,i))}layoutId(){return this._chartWidgetCollection.metaInfo.uid.value()}async createNewLayout(e){{const t=await(0,R.createNewChart)(e);if(void 0===t)return null;const i=new URL(t);return window.history.replaceState(null,"",i),/\/chart\/([^/]+)\/?$/.exec(i.pathname)?.[1]??null}}lockAllDrawingTools(){return null===this._lockDrawingsWatchedValue&&(this._lockDrawingsWatchedValue=new H.WatchedValue((0,U.lockDrawings)().value()),this._lockDrawingsWatchedValue.subscribe((e=>{(0,U.lockDrawings)().setValue(e)})),(0,U.lockDrawings)().subscribe(this,(()=>{(0,r.ensureNotNull)(this._lockDrawingsWatchedValue).setValue((0,U.lockDrawings)().value())}))),this._lockDrawingsWatchedValue}hideAllDrawingTools(){return null===this._hideDrawingsWatchedValue&&(this._hideDrawingsWatchedValue=new H.WatchedValue((0,U.hideAllDrawings)().value()),this._hideDrawingsWatchedValue.subscribe((e=>{(0,U.hideAllDrawings)().setValue(e)})),(0,U.hideAllDrawings)().subscribe(this,(()=>{(0,r.ensureNotNull)(this._hideDrawingsWatchedValue).setValue((0,U.hideAllDrawings)().value())}))),this._hideDrawingsWatchedValue}hideAllIndicators(){return null===this._hideIndicatorsWatchedValue&&(this._hideIndicatorsWatchedValue=new H.WatchedValue((0,U.hideAllIndicators)().value()),this._hideIndicatorsWatchedValue.subscribe((e=>{(0,U.hideAllIndicators)().setValue(e)})),(0,U.hideAllIndicators)().subscribe(this,(()=>{(0,r.ensureNotNull)(this._hideIndicatorsWatchedValue).setValue((0,U.hideAllIndicators)().value())}))),this._hideIndicatorsWatchedValue}logs(){return{getLogHistory:n.getLogHistory,enable:window.lon,disable:window.loff}}mainSeriesPriceFormatter(){return this._chartWidgetCollection.activeChartWidget.value().model().mainSeries().priceScale().formatter()}onContextMenu(e){a.subscribe("onContextMenu",(t=>{t.callback(e(t.unixtime,t.price))}),void 0)}onGrayedObjectClicked(e){a.subscribe("onGrayedObjectClicked",e,void 0)}removeChartFromServer(e,t){it.backend.removeChart(e).then(t)}saveChart(e,t){if(!this._saveChartService)return;const i=this._saveChartService.saveToJSON(t);return e&&e(JSON.parse(i.content))}saveChartToServer(e,t,i){this._saveChartService&&this._saveChartService.saveChartSilently(e,t,i)}selectedLineTool(){const e=Object.keys(V.supportedLineTools),t=U.tool.value();for(let i=0;i<e.length;++i)if(V.supportedLineTools[e[i]].name===t)return e[i]
;throw new Error("Unknown tool")}autosave(){if(!this._saveChartService)throw new Error("Saving service is not available");return this._saveChartService.autoSaveEnabled()}setForceFullscreenMode(){this._chartWidgetCollection.setViewMode(h.CollectionViewMode.ForceFullscreen),this._activeChartWidget().requestFullscreen()}setMultichartMode(){this._chartWidgetCollection.setViewMode(h.CollectionViewMode.Multichart),this._activeChartWidget().exitFullscreen()}setDateRangeLinkingEnabled(e){this._chartWidgetCollection.lock.dateRange.setValue(e)}studyMetaIntoRepository(){return(0,Ue.studyMetaInfoRepository)()}deferredStudiesReady(){return gt.DeferredStudies.ready()}hasPendingStudiesModuleLoading(){return(0,ne.hasPendingStudiesModuleLoading)()}hasPendingLineToolsModuleLoading(){return(0,nt.hasPendingLineToolsModuleLoading)()}shouldBeSaved(){return!this._chartWidgetCollection.readOnly()&&(this._saveChartService?.hasChanges()||!1)}setIntervalLinkingEnabled(e){this._chartWidgetCollection.lock.interval.setValue(e)}setTimeFrame(e){this._chartWidgetCollection.setTimeFrame(e)}showConfirmDialog(e){let t=e.callback;const i=e=>{t&&(t(e),t=null)};(0,_t.showConfirm)({title:e.title,text:e.body||"",onClose:()=>{i(!1)},onConfirm:e=>{i(!0),e.dialogClose()}})}showLoadChartDialog(){this._loadChartService?.showLoadDialog()}persistentLogger(){return(0,_.getPersistentLogger)()}showNoticeDialog(e){(0,_t.showWarning)({title:e.title,text:e.body||"",onClose:e.callback})}showSupportDialog(){(0,St.showSupportDialog)()}showSaveAsChartDialog(){const e=this._saveChartService;e&&window.runOrSignIn((()=>{e.saveChartAs()}),{source:"Save as chart dialogue"})}showRenameChartDialog(){{const e=this._saveChartService;if(!e)return;e.renameChart()}}saveChartOrShowTitleDialog(e,t,i){{const r=this._saveChartService;if(!r)return;r.saveChartOrShowTitleDialog(e,t,i)}}showCreateAlertDialog(){this._alertService&&this._alertService.showCreateAlertDialog()}createGoProDialog(e){(0,Et.createGoProDialog)(e)}setUserInfo(e){e&&(!1===e.profile_data_filled&&delete e.profile_data_filled,window.loginUser(e))}openMobileChartPicker(){a.emit(Rt.openMobileChartPickerCommand)}closeMobileChartPicker(){a.emit(Rt.closeMobileChartPickerCommand)}takeClientScreenshot(e){return this._chartWidgetCollection.clientSnapshot(e)}takeScreenshot(){return this._chartWidgetCollection.takeScreenshot()}trading(){return(0,yt.tradingService)()}waitTrading(){return(0,yt.waitTradingService)()}viewMode(){return this._chartWidgetCollection.viewMode.value()}viewModeWatchedValue(){return this._chartWidgetCollection.viewMode}async dummyBrokerController(){{const e=new((await Promise.all([i.e(92409),i.e(38326)]).then(i.bind(i,711502))).DummyBrokerController);return e.startBroker=async()=>{const e=(0,r.ensureNotNull)(this.trading());await e.selectBroker("DUMMY"),await(0,bt.delay)(null,1e3),e.activeBroker()?.signIn("","",1)},e}}pineLibApi(){return{saveNew:wt.saveNew,saveNext:wt.saveNext,requestBuiltinScripts:wt.requestBuiltinScripts}}resetCache(){Nt(),getChartingLibraryGlobalContext().ChartApiInstance.resetCache()}
getSymbolAliasService(){return(0,M.getSymbolAliasService)()}shouldAffectUser(e,t){return(0,Ot.shouldAffectUser)(e,t)}static setContextMenuOptions(e){void 0!==e.items_processor&&d.ContextMenuManager.setCustomItemsProcessor(e.items_processor),void 0!==e.renderer_factory&&d.ContextMenuManager.setCustomRendererFactory(e.renderer_factory)}_getChartWidgetApi(e){let t=this._chartWidgets.get(e);return void 0===t&&(t=new dt(e,this._activateChart.bind(null,e)),this._chartWidgets.set(e,t)),t}_chartIndex(e){return this._chartWidgetCollection.getAll().indexOf(e)}_activeChartWidget(){return this._chartWidgetCollection.activeChartWidget.value()}_chartWidgetIndexByModelId(e){return this._chartWidgetCollection.getAll().findIndex((t=>t.model().model().id()===e))}_toggleUnitConversionMenu(e,t,i,n,s){if(t)return void a.emit(e,t,-1,-1,"");const o=this._chartWidgetCollection.getAll(),l=this._chartWidgetIndexByModelId(i);if(-1===l)return;const c=(0,r.ensureDefined)(o[l]).paneWidgets().findIndex((e=>e.state().id()===n));-1!==c&&a.emit(e,t,l,c,s)}_toggleSeriesStatusTooltip(e,t){const i=this._chartWidgetIndexByModelId(t);-1!==i&&a.emit("toggle_series_status_tooltip",e,i)}_onBeforeActiveChartChanged(){this._activeChartWidgetWV.value()?.ranges().onChange().unsubscribeAll(this)}_onActiveChartChanged(){this._onBeforeActiveChartChanged(),this._activeChartWidgetWV.setValue(this.activeChart()),this._activeChartWidgetChangedDelegate.fire(),this._onAfterActiveChartChanged()}_onAfterActiveChartChanged(){this._updateActiveChartRangeState()}_updateActiveChartRangeState(){{const e=(0,r.ensureNotNull)(this._activeChartWidgetWV.value());this._activeChartRangeState.setValue(e.ranges().state()),e.ranges().onChange().subscribe(this,(()=>{this._activeChartRangeState.setValue(this.activeChart().ranges().state())}))}}}},505754:(e,t,i)=>{"use strict";i.d(t,{TradingViewAuthApi:()=>n});var r=i(277038);class n{loginRequired(){return window.loginRequiredDelegate}onGoProDialog(e,t){(0,r.onGoProDialog)(e,t)}}},38124:(e,t,i)=>{"use strict";i.d(t,{drawSelection:()=>o,getSymbolCoordinatesInfo:()=>s});var r=i(680574),n=i(436465);function s(e){const{symbolPosition:t,textWidth:i,textByLines:s,lineHeight:o,font:a,textAlign:l,lineSpacing:c=0}=e;let[d,h]=function(e,t){let i=0;switch(e){case"center":i=t/2;break;case"start":i=(0,r.isRtl)()?t:0;break;case"end":i=(0,r.isRtl)()?0:t;break;case"right":i=t}return[i,0]}(l,i);const u=(0,r.isRtl)(),g=o+c;let _=0,p=0,m="";for(let e=0;e<s.length;e++){let r=t-_;const{wrappedLinePart:o,wrappedLineEnd:c,hidden:v,text:S}=s[e],f=e<s.length-1?s[e+1]:null;if(v||(m=S),f&&r>S.length){_+=S.length+(o&&!c?0:1),v||(h+=g);continue}v&&(h-=g);const y=o&&!c&&S.length===r&&f&&!f.hidden;if(v&&(m+="",r=m.length),"center"===l)if(y)d=i/2;else{const e=(0,n.measureText)(m,a).width,t=(0,n.measureText)(m.slice(0,r),a).width,s=i/2;d=u?s+e/2-t:s-e/2+t}else if("right"===l&&!u||"left"===l&&u||"end"===l)if(y)d=i;else{const e=(0,n.measureText)(m.slice(r),a).width;d=u?e:i-e}else if(y)d=0;else{const e=(0,n.measureText)(m.slice(0,r),a).width;d=u?i-e:e}y?(p=e+1,h+=g):p=e
;break}return{x:d,y:h,lineNumber:p}}function o(e,t,i){const{lines:s,selectionStart:o,selectionEnd:l,left:c,right:d,color:h,font:u,lineHeight:g,lineSpacing:_=0}=i;e.save();const p=(c+d)/2,m=g+_,v=(0,r.isRtl)();e.fillStyle=h;const{horizontalPixelRatio:S,verticalPixelRatio:f}=t;if(o.lineNumber===l.lineNumber){const t=Math.round(o.x*S),i=Math.round(o.y*f),r=Math.round(l.x*S);e.fillRect(Math.min(t,r),i,Math.abs(t-r),Math.round(m*f))}else{const t=(0,n.measureText)(" ",u).width;let i=0;for(let r=o.lineNumber;r<=l.lineNumber;r+=1){const n=r===o.lineNumber,h=r===l.lineNumber,g=s[r];if(g.hidden)continue;const _=a(g.text,u);let y,b,w=!1;"center"===e.textAlign?(y=n?o.x:v?p+_/2:p-_/2,b=h?l.x:v?p-_/2:p+_/2):"right"===e.textAlign||v&&"start"===e.textAlign||!v&&"end"===e.textAlign?(y=n?o.x:d-_,b=h?l.x:d,w=!0):(y=n?o.x:c,b=h?l.x:c+_);let C=Math.min(y,b),T=Math.max(y,b);h||g.wrappedLinePart&&!g.wrappedLineEnd||(w?C-=t:T+=t);const P=Math.round(C*S),A=Math.round(T*S),I=Math.round((o.y+i*m)*f),W=Math.round((o.y+(i+1)*m)*f);e.fillRect(P,I,A-P,W-I),i+=1}}e.restore()}function a(e,t){return(0,n.measureText)(e,t).width}},551034:(e,t,i)=>{"use strict";let r;async function n(e=null){return r||(r=async function(e){const{ScriptUpdater:t}=await Promise.all([i.e(16388),i.e(8169),i.e(92646),i.e(93843),i.e(2147),i.e(26843),i.e(87980),i.e(55132),i.e(25282),i.e(70333)]).then(i.bind(i,567515));return new t(e)}(e))}i.d(t,{loadScriptUpdaterAsync:()=>n})},926209:(e,t,i)=>{"use strict";i.r(t),i.d(t,{loadTheme:()=>s});var r=i(308721),n=i(453287);async function s(e,t){const{themeName:i,standardTheme:s,syncState:o=!0,noUndo:a=!1,applyOverrides:l=!1,onlyActiveChart:c=!1}=t,d=await(s?Promise.resolve((0,r.getStdTheme)(i)):(0,r.getTheme)(i)),h=!s;if(void 0!==d.content){const t=!s||c;l&&(void 0!==(u=d.content).chartProperties&&(0,n.applyDefaultsOverrides)(u.chartProperties),void 0!==u.mainSourceProperties&&(0,n.applyDefaultsOverrides)(u.mainSourceProperties,void 0,!0,"mainSeriesProperties")),await e.applyTheme({theme:d.content,onlyActiveChart:t,restoreNonThemeDefaults:h,themeName:i,standardTheme:s,syncState:o,noUndo:a})}var u;return d}},220553:(e,t,i)=>{"use strict";i.d(t,{latestUpdatesAvailableOnDevice:()=>o});var r=i(125226),n=i(314802);let s;s=!(i(638456).CheckMobile.iOS()&&"14"===navigator.userAgent.match(/(Version\/|iPhone OS |iPad; CPU OS )(\d+)/)?.[2])&&((0,n.isOnMobileAppPage)("old")?(0,r.isFeatureEnabled)("ios_app_news_and_minds"):((0,n.isOnMobileAppPage)("new"),!0));const o=s},753530:(e,t,i)=>{"use strict";i.d(t,{BitmapCoordinatesPaneRenderer:()=>n});var r=i(327714);class n{draw(e,t){new r.CanvasRenderingTarget2D(e,t.mediaSize,t.bitmapSize).useBitmapCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new r.CanvasRenderingTarget2D(e,t.mediaSize,t.bitmapSize).useBitmapCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},743099:(e,t,i)=>{"use strict";i.d(t,{CompositeRenderer:()=>r});class r{constructor(){this._renderers=[],this._globalAlpha=1}setGlobalAlpha(e){this._globalAlpha=e}append(e){e&&this._renderers.push(e)}
insert(e,t){this._renderers.splice(t,0,e)}clear(){this._renderers.length=0}isEmpty(){return 0===this._renderers.length}draw(e,t){for(let i=0;i<this._renderers.length;i++)e.save(),e.globalAlpha=this._globalAlpha,this._renderers[i].draw(e,t),e.restore()}drawBackground(e,t){e.save(),e.globalAlpha=this._globalAlpha;for(let i=0;i<this._renderers.length;i++){const r=this._renderers[i];r.drawBackground&&r.drawBackground(e,t)}e.restore()}hitTest(e,t){let i=null;for(let r=this._renderers.length-1;r>=0;r--){const n=this._renderers[r].hitTest(e,t);null!==n&&(null===i||n.target()>i.target())&&(i=n)}return i}doesIntersectWithBox(e,t){return this._renderers.some((i=>!!i.doesIntersectWithBox&&i.doesIntersectWithBox(e,t)))}}},973274:(e,t,i)=>{"use strict";i.d(t,{MediaCoordinatesPaneRenderer:()=>n});var r=i(327714);class n{draw(e,t){new r.CanvasRenderingTarget2D(e,t.mediaSize,t.bitmapSize).useMediaCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new r.CanvasRenderingTarget2D(e,t.mediaSize,t.bitmapSize).useMediaCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},265683:(e,t,i)=>{"use strict";i.d(t,{TextRenderer:()=>I,calculateLabelPosition:()=>_,fontSize:()=>C,getTextAlignInBox:()=>A,getTextBoundaries:()=>p,lineSpacing:()=>w,needTextExclusionPath:()=>m});var r=i(610555),n=i(650151),s=i(906453),o=i(680574),a=i(594632),l=i(578679),c=i(850699),d=i(38124),h=i(436465),u=i(204181),g=i(729813);function _(e,t,i,n,s){const o=.5*(t.x+i.x);let a=i.y;return t.y>i.y?(a-=e.height/2+n.y,a=Math.max(e.height/2,a)):(a+=e.height/2+n.y,a=Math.min(s-e.height/2,a)),new r.Point(o,a)}function p(e,t,i){if(e.isOutOfScreen(t,i))return null;const r=e.getPolygonPoints();return 0===r.length?null:r}function m(e){const t=e.getLinesInfo().lines;if(t.length%2==0)return!1;if(""===t[Math.floor(t.length/2)].text.trim())return!1;return!0}function v(e,t,i){if(0===i)return e.clone();const n=(e.x-t.x)*Math.cos(i)-(e.y-t.y)*Math.sin(i)+t.x,s=(e.x-t.x)*Math.sin(i)+(e.y-t.y)*Math.cos(i)+t.y;return(0,r.point)(n,s)}function S(e){return void 0!==e.boxPaddingVert?e.boxPaddingVert*P(e):void 0!==e.boxPadding?e.boxPadding*P(e):C(e)/3}function f(e){return void 0!==e.boxPaddingHorz?e.boxPaddingHorz*P(e):void 0!==e.boxPadding?e.boxPadding*P(e):C(e)/3}function y(e){return void 0!==e.boxPaddingLeft?e.boxPaddingLeft*P(e):f(e)}function b(e){return void 0!==e.boxPaddingRight?e.boxPaddingRight*P(e):f(e)}function w(e){let t=e.lineSpacing;return void 0===t&&e.lineHeight&&(t=(e.lineHeight-1)*T(e)),(t??0)*P(e)}function C(e){return Math.ceil(T(e)*P(e))}function T(e){return e.fontsize||e.fontSize||30}function P(e){const t=Math.min(1,Math.max(.2,e.scale||1));if(1===t)return t;const i=T(e);return Math.ceil(t*i)/i}function A(e){const{horzAlign:t,extendLeft:i=!1,extendRight:n=!1,width:s,leftPoint:o,rightPoint:l}=e,c=(o.x<=s||i)&&(l.x>=0||n);let d,h,u=t;switch(u){case a.HorizontalAlign.Left:h=o.y,i?d=c?0:l.x:(d=o.x,u=a.HorizontalAlign.Right);break;case a.HorizontalAlign.Right:h=l.y,n?d=c?s:o.x:(d=l.x,u=a.HorizontalAlign.Left);break;default:
d=((i&&c?0:o.x)+(n&&c?s:l.x))/2,h=(o.y+l.y)/2;break}return[(0,r.point)(d,h),u]}class I{constructor(e,t){this._data=null,this._textWidthCache=new u.TextWidthCache,this._internalData=null,this._boxSize=null,this._box=null,this._polygonPoints=null,this._linesInfo=null,this._fontInfo=null,this._centerTextRotationPoint=null,this._rotationPoint=null,this._wordWrap=(0,g.wordWrapCached)(),this._hitTest=t||new l.HitTestResult(l.HitTarget.MovePoint,{areaName:l.AreaName.Text}),void 0!==e&&this.setData(e)}setHitTest(e){this._hitTest=e}data(){return this._data}updateData(e){this.setData({...(0,n.ensureNotNull)(this._data),...e})}setData(e){null!==e?((0,n.assert)(!e.decorator||void 0===e.wordWrapWidth,"Decorator is not supported with wordWrapWidth"),void 0===e.text&&(e.text=""),e.horzTextAlign||(e.horzTextAlign=e.horzAlign),!function(e,t){if(null===e||null===t)return null===e==(null===t);if(void 0===e.points!=(void 0===t.points))return!1;if(void 0!==e.points&&void 0!==t.points){if(e.points.length!==t.points.length)return!1;for(let n=0;n<e.points.length;++n)if(i=e.points[n],r=t.points[n],i.x!==r.x||i.y!==r.y)return!1}var i,r;return e.text===t.text&&e.decorator===t.decorator&&e.vertAlign===t.vertAlign&&e.horzAlign===t.horzAlign&&e.horzTextAlign===t.horzTextAlign&&e.font===t.font&&e.offsetX===t.offsetX&&e.offsetY===t.offsetY&&e.bold===t.bold&&e.italic===t.italic&&e.fontsize===t.fontsize&&e.fontSize===t.fontSize&&e.backgroundRoundRect===t.backgroundRoundRect&&e.forceTextAlign===t.forceTextAlign&&e.wordWrapWidth===t.wordWrapWidth&&e.forceCalculateMaxLineWidth===t.forceCalculateMaxLineWidth&&e.lineHeight===t.lineHeight&&e.lineSpacing===t.lineSpacing&&e.scale===t.scale&&e.boxPadding===t.boxPadding&&e.boxPaddingVert===t.boxPaddingVert&&e.boxPaddingLeft===t.boxPaddingLeft&&e.boxPaddingRight===t.boxPaddingRight&&e.boxPaddingHorz===t.boxPaddingHorz&&e.angle===t.angle&&e.maxHeight===t.maxHeight&&e.outlineBorder?.width===t.outlineBorder?.width&&e.outlineBorder?.color===t.outlineBorder?.color}(this._data,e)?(this._data=e,this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._centerTextRotationPoint=null,this._rotationPoint=null,this._linesInfo=null,this._fontInfo=null,this._box=null):this._data=e):this._data=null}hitTest(e){return null===this._data||void 0===this._data.points||0===this._data.points.length?null:(0,s.pointInPolygon)(e,this.getPolygonPoints())?this._hitTest:null}doesIntersectWithBox(e){return null!==this._data&&void 0!==this._data.points&&0!==this._data.points.length&&(0,s.pointInBox)(this._data.points[0],e)}measure(){if(null===this._data)return{boxWidth:0,boxHeight:0,width:0,height:0};const e=this._getBoxSize();return{boxWidth:e.boxWidth,boxHeight:e.boxHeight,width:e.textBoxWidth,height:e.textBoxHeight}}rect(){if(null===this._data)return{x:0,y:0,width:0,height:0};const{boxLeft:e,boxTop:t,boxWidth:i,boxHeight:r}=this._getBox();return{x:e,y:t,width:i,height:r}}isOutOfScreen(e,t){if(null===this._data||void 0===this._data.points||0===this._data.points.length)return!0;const{boxLeft:i,boxWidth:n}=this._getBox()
;if(i+n<0||i>e){const i=(0,r.box)((0,r.point)(0,0),(0,r.point)(e,t));return this.getPolygonPoints().every((e=>!(0,s.pointInBox)(e,i)))}return!1}setPoints(e,t){(0,n.ensureNotNull)(this._data).points=e,this._hitTest=t||new l.HitTestResult(l.HitTarget.MovePoint)}setPoint(e,t,i){const r=(0,n.ensureNotNull)(this._data);this.setData({...r,points:[e],offsetX:t??r.offsetX,offsetY:i??r.offsetY})}point(){return this._data?.points?.[0]??null}fontStyle(e){return null===this._data?"":this._getFontInfo().fontStyle}lineHeight(){return null===this._data?0:C(this._data)}lineSpacing(){return null===this._data?0:w(this._data)}draw(e,t){if(null===this._data||void 0===this._data.points||0===this._data.points.length)return;const{mediaSize:i,horizontalPixelRatio:s,verticalPixelRatio:o}=t;if(this.isOutOfScreen(i.width,i.height))return;const a=this._getInternalData(),l=(0,n.ensureNotNull)(this.rotation()),d=(0,r.point)(l.x*s,l.y*o);e.save(),0!==l.angle&&(e.translate(d.x,d.y),e.rotate(l.angle),e.translate(-d.x,-d.y));const u=this._getFontInfo().fontSize;e.textBaseline=a.textBaseLine,e.textAlign=a.textAlign,e.font=this.fontStyle();const{scaledLeft:g,scaledRight:_,scaledTop:p,scaledBottom:m}=function(e,t){const{horizontalPixelRatio:i,verticalPixelRatio:r}=t,n=Math.round(e.boxLeft*i),s=Math.round(e.boxTop*r);return{scaledLeft:n,scaledRight:n+Math.round(e.boxWidth*i),scaledTop:s,scaledBottom:s+Math.round(e.boxHeight*r)}}(a,t),v=this._data.borderWidth||Math.max(u/12,1),S=Math.round(v*s),f=S/2;if(this._data.backgroundColor||this._data.borderColor){let t=!1;if(this._data.boxShadow){e.save();const{shadowColor:i,shadowBlur:r,shadowOffsetX:n=0,shadowOffsetY:a=0}=this._data.boxShadow;e.shadowColor=i,e.shadowBlur=r*s,e.shadowOffsetX=n*s,e.shadowOffsetY=a*o,t=!0}if(this._data.backgroundRoundRect){const{borderColor:i,backgroundColor:r,backgroundRoundRect:n}=this._data;r&&((0,c.drawRoundRect)(e,g,p,_-g,m-p,n*s),e.closePath(),e.fillStyle=r,e.fill(),t&&(e.restore(),t=!1)),i&&((0,c.drawRoundRect)(e,g-f,p-f,_-g+S,m-p+S,n*s+S),e.closePath(),e.strokeStyle=i,e.lineWidth=S,e.stroke(),t&&e.restore())}else{const{borderColor:i,backgroundColor:r}=this._data;r&&(e.fillStyle=r,e.fillRect(g,p,_-g,m-p),t&&(e.restore(),t=!1)),i&&(e.strokeStyle=i,e.lineWidth=S,e.beginPath(),e.moveTo(g-f,p-f),e.lineTo(g-f,m+f),e.lineTo(_+f,m+f),e.lineTo(_+f,p-f),e.lineTo(g-f,p-f),e.closePath(),e.stroke(),t&&e.restore())}}this._drawSelectionIfNeeded(e,t),e.fillStyle=this._data.color;const y=(g+Math.round(a.textHorizStart*s))/s,b=.05*u;let C=(p+Math.round((a.textVertStart+b)*o))/o;const T=w(this._data),P=this.getLinesInfo();for(const t of P.lines)(0,h.drawScaled)(e,s,o,(()=>e.fillText(t.text,y,C))),C+=u+T;if(this._data.decorator?.draw(e,t,this._data,a),this._data.outlineBorder){const{outlineBorder:{width:t,color:i}}=this._data,r=Math.round(t*s),n=this._data.borderColor?S:0,o={x:g-n,y:p-n,w:_-g+2*n,h:m-p+2*n},a=new Path2D;a.rect(o.x-r,o.y-r,o.w+2*r,o.h+2*r),a.rect(o.x,o.y,o.w,o.h),e.fillStyle=i,e.fill(a,"evenodd")}e.restore()}getPolygonPoints(){
if(null!==this._polygonPoints)return this._polygonPoints;if(null===this._data)return[];const e=this._data.angle||0,{boxLeft:t,boxTop:i,boxWidth:n,boxHeight:s}=this._getBox(),o=this._getRotationPoint();return this._polygonPoints=[v((0,r.point)(t,i),o,e),v((0,r.point)(t+n,i),o,e),v((0,r.point)(t+n,i+s),o,e),v((0,r.point)(t,i+s),o,e)],this._polygonPoints}centerTextRotation(){if(null===this._centerTextRotationPoint&&null!==this._data){const e=this._data.angle??0,t=this._getRotationPoint(),{textLeft:i,textTop:n,textRight:s,textBottom:o}=this._getInternalData(),a=v((0,r.point)((i+s)/2,(n+o)/2),t,e);this._centerTextRotationPoint={x:a.x,y:a.y,angle:e}}return this._centerTextRotationPoint}rotation(){if(null===this._rotationPoint&&null!==this._data){const e=this._data.angle??0,t=this._getRotationPoint();this._rotationPoint={x:t.x,y:t.y,angle:e}}return this._rotationPoint}getLinesInfo(){if(null===this._linesInfo){const e=(0,n.ensureNotNull)(this._data),t=this._wordWrap(e.text,this.fontStyle(),this._textWidthCache,!1,e.wordWrapWidth);let i=t.filter((e=>!e.hidden));if(void 0!==e.maxHeight){const t=function(e){const t=(0,n.ensureDefined)(e.maxHeight),i=C(e),r=w(e);return Math.floor((t+r)/(i+r))}(e);i.length>t&&(i=i.slice(0,t))}this._linesInfo={linesMaxWidth:this._getLinesMaxWidth(i),linesIncludingHidden:t,lines:i}}return this._linesInfo}positionToCoordinate(e){const t=(0,n.ensureNotNull)(this._data),i=this._getInternalData(),r=this.getLinesInfo(),{x:s,y:o,lineNumber:a}=(0,d.getSymbolCoordinatesInfo)({symbolPosition:e,textWidth:i.textRight-i.textLeft,textByLines:r.linesIncludingHidden,lineHeight:C(t),font:this.fontStyle(),textAlign:i.textAlign,lineSpacing:this.lineSpacing()});return{x:s+i.textLeft,y:o+i.textTop,lineNumber:a}}_getInternalData(){if(null!==this._internalData)return this._internalData;const e=(0,n.ensureNotNull)(this._data),{boxLeft:t,boxTop:i,boxWidth:r,boxHeight:s,textBoxWidth:l,textBoxHeight:c}=this._getBox(),d=y(e),h=b(e),u=S(e),g=e.decorator?.geometry(e),_=g?.width??0,p=0===e.text.length?0:g?.decoratorAndTextMargin??0,m=g?.ignoreRtl,v=_+p;let f;const w=i+u+C(e)/2;let T;const P=(0,o.isRtl)(),A=P&&!m,I=A?t+r-h-_:t+d;switch((0,n.ensureDefined)(e.horzTextAlign)){case a.HorizontalAlign.Left:T="start",f=I+v,P&&(e.forceTextAlign?T="left":(f=A?I-p:t+r-h,T="right"));break;case a.HorizontalAlign.Center:T="center";const i=r-d-h-v;f=A?I-p-i/2:I+v+i/2;break;case a.HorizontalAlign.Right:T="end",f=A?I-p:t+r-h,P&&e.forceTextAlign&&(T="right")}return this._internalData={boxLeft:t,boxTop:i,boxWidth:r,boxHeight:s,textBoxWidth:l,textBoxHeight:c,textLeft:t+d+(A?0:v),textRight:t+r-h-(A?v:0),textTop:i+u,textBottom:i+s-u,textHorizStart:f-t,textVertStart:w-i,textAlign:T,textBaseLine:"middle",decoratorLeft:I,decoratorWidth:_},this._internalData}_getFontInfo(){if(null===this._fontInfo){const e=(0,n.ensureNotNull)(this._data),t=C(e),i=`${e.bold?"bold ":""}${e.italic?"italic ":""}${t}px ${e.font}`;this._fontInfo={fontStyle:i,fontSize:t}}return this._fontInfo}_drawSelectionIfNeeded(e,t){const i=(0,n.ensureNotNull)(this._data),r=C((0,
n.ensureNotNull)(this._data));if(i.selectionHighlight){const n=this.positionToCoordinate(i.selectionHighlight.start),s=this.positionToCoordinate(i.selectionHighlight.end),o=this._getInternalData();(0,d.drawSelection)(e,t,{lines:this.getLinesInfo().linesIncludingHidden,selectionStart:n,selectionEnd:s,left:o.textLeft,right:o.textRight,color:i.selectionHighlight.color,font:this.fontStyle(),lineHeight:r,lineSpacing:this.lineSpacing()})}}_getLinesMaxWidth(e){const t=this.fontStyle();if(null!==this._data&&this._data.wordWrapWidth&&!this._data.forceCalculateMaxLineWidth)return this._data.wordWrapWidth*P(this._data);let i=0;for(const r of e)i=Math.max(i,(0,h.measureText)(r.text,t,this._textWidthCache).width);return i}_getBoxSize(){if(null===this._boxSize){const e=this.getLinesInfo(),t=(0,n.ensureNotNull)(this._data),i=function(e,t){const i=e.decorator?.geometry(e),r=Math.round(t+y(e)+b(e)+(i?.width??0)+(0===e.text.length?0:i?.decoratorAndTextMargin??0));return r%2?r+1:r}(t,e.linesMaxWidth),r=function(e,t){return C(e)*t+w(e)*(t-1)+2*S(e)}(t,e.lines.length);this._boxSize={textBoxWidth:i,textBoxHeight:r,boxWidth:t.boxWidth??i,boxHeight:t.boxHeight??r}}return this._boxSize}_getBox(){if(this._box)return this._box;const e=(0,n.ensureNotNull)(this._data),[t]=(0,n.ensureDefined)(e.points),{boxWidth:i,boxHeight:r,textBoxWidth:s,textBoxHeight:o}=this._getBoxSize();let{y:l,x:c}=t;switch(e.vertAlign){case a.VerticalAlign.Bottom:l-=r+e.offsetY;break;case a.VerticalAlign.Middle:l-=r/2;break;case a.VerticalAlign.Top:l+=e.offsetY}switch(e.horzAlign){case a.HorizontalAlign.Left:c+=e.offsetX;break;case a.HorizontalAlign.Center:c-=i/2;break;case a.HorizontalAlign.Right:c-=i+e.offsetX}return this._box={boxLeft:c,boxTop:l,boxWidth:i,boxHeight:r,textBoxWidth:s,textBoxHeight:o}}_getRotationPoint(){const{boxLeft:e,boxTop:t,boxWidth:i,boxHeight:s}=this._getBox(),{horzAlign:o,vertAlign:l}=(0,n.ensureNotNull)(this._data);let c,d;switch(o){case a.HorizontalAlign.Center:c=e+i/2;break;case a.HorizontalAlign.Left:c=e;break;case a.HorizontalAlign.Right:c=e+i}switch(l){case a.VerticalAlign.Middle:d=t+s/2;break;case a.VerticalAlign.Top:d=t;break;case a.VerticalAlign.Bottom:d=t+s}return(0,r.point)(c,d)}}},729813:(e,t,i)=>{"use strict";i.d(t,{wordWrapCached:()=>a});var r=i(259332),n=i(169958),s=i(989533);function o(e,t,i,r=!0,n){return`${t}_${r}_${n}_${e}`}function a(e=10){const t=r.default.Cache;r.default.Cache=n.CircularCacheBuffer.bind(n.CircularCacheBuffer,e);const i=(0,r.default)(s.wordWrap,o);return r.default.Cache=t,i}},989533:(e,t,i)=>{"use strict";i.d(t,{wordWrap:()=>l});var r=i(536794),n=i(127707),s=i(436465);function o(e){const t=[];do{const i=e.match(/\s+/);if(!i||void 0===i.index||-1===i.index){t.push({word:e,spaces:""});break}t.push({word:e.slice(0,i.index),spaces:i[0]}),e=e.slice(i.index+i[0].length)}while(e.length);return t}function a(e,t,i,r){const o=[],a=[];for(let t=0;t<e.length;++t)a.push(t);for(;e.length;){const l=Math.max(1,(0,n.upperbound)(a,r,((r,n)=>(0,s.measureText)(e.slice(0,n+1),t,i).width>r),0,e.length));o.push(e.slice(0,l)),
e=e.slice(l)}return o}function l(e,t,i,n=!0,l){l=(0,r.isString)(l)?parseInt(l):l;const c=(e+="").split(/\r\n|\r|\n|$/).map((e=>({text:e,hidden:!1,wrappedLinePart:!1,wrappedLineEnd:!1})));if(!(0,r.isNumber)(l)||!isFinite(l)||l<=0)return c;if((0,s.measureText)("x",t,i).width>l)return c;const d=[];for(let e=0;e<c.length;e++){const r=c[e];if((0,s.measureText)(r.text,t,i).width<=l){d.push(r);continue}const h=o(r.text),u=!0;let g="",_=0;for(;_<h.length;){const e=h[_];let r=`${g}${e.word}`,o=(0,s.measureText)(r,t,i).width;if(o>l){if(""!==g)d.push({text:g,hidden:!1,wrappedLinePart:u,wrappedLineEnd:!1}),g="";else if(1===r.length)d.push({text:r,hidden:!1,wrappedLinePart:u,wrappedLineEnd:!0}),e.word="";else{const n=a(r,t,i,l);for(let e=0;e<n.length-1;e+=1)d.push({text:n[e],hidden:!1,wrappedLinePart:u,wrappedLineEnd:!1});e.word=n[n.length-1]}continue}let c=r.length;if(r=`${g}${e.word}${e.spaces}`,o=(0,s.measureText)(r,t,i).width,o<l){g=r,_+=1;continue}const p=a(r,t,i,l);for(let e=0;e<p.length;e+=1){const t=p[e];c-=t.length;const i={text:t,hidden:e>0,wrappedLinePart:u,wrappedLineEnd:_===h.length-1&&e===p.length-1};i.hidden&&n||d.push(i)}g="",_+=1}""!==g&&d.push({text:g,wrappedLinePart:u,hidden:!1,wrappedLineEnd:!0})}return d}},250346:(e,t,i)=>{"use strict";i.d(t,{replayTimingModeProperty:()=>a});var r=i(62802),n=i(673378);const s="replay_timing_mode";function o(){return r.getValue(s,"manual")}const a=(0,n.createPrimitiveProperty)(o());r.onSync.subscribe(null,(()=>a.setValue(o()))),a.subscribe(null,(()=>r.setValue(s,a.value())))},374952:(e,t,i)=>{"use strict";i.d(t,{AlertsWidgetDialog:()=>c});var r=i(62802),n=i(77294),s=i(995155),o=i(672267),a=i(495047),l=i(789790);class c{constructor(e){this._isVisible=new n.WatchedValue(!1),this._activeTab=new n.WatchedValue(function(){const e=r.default.getValue("alerts.widget_dialog.active_tab");return!e||"list"!==e&&"log"!==e?"list":e}()),this._willShow=!1,this._dialogImpl=null,this._getChartWidget=e,this._activeTab.subscribe((e=>{r.default.setValue("alerts.widget_dialog.active_tab",e)}))}setTab(e){this._activeTab.setValue(e)}show(){this._willShow||(this._willShow=!0,Promise.all([Promise.all([i.e(19736),i.e(1283),i.e(85615),i.e(56224),i.e(41881),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(6563),i.e(98567),i.e(31481),i.e(17353),i.e(73438),i.e(70815),i.e(7256),i.e(94891),i.e(35009),i.e(36147),i.e(14731),i.e(89923),i.e(17760),i.e(24313),i.e(50876),i.e(57369),i.e(30862),i.e(65284),i.e(73688),i.e(43868),i.e(94521),i.e(92161),i.e(98768),i.e(434),i.e(76189),i.e(6961),i.e(88827),i.e(25566),i.e(3044),i.e(76476),i.e(42049),i.e(92593),i.e(30793),i.e(65322),i.e(66975),i.e(32227),i.e(55091),i.e(87473),i.e(2139),i.e(35938),i.e(12360),i.e(95734),i.e(96754),i.e(19663),i.e(30415),i.e(89859),i.e(61491)]).then(i.bind(i,260282)),(0,l.getWidgetAlertsCollection)(),(0,a.getFiresActions)(),(0,o.getAlertsActionCreators)(),(0,o.getFiresActionCreators)(),(0,
s.getAlertsFiresFocusHandler)(),Promise.all([i.e(62885),i.e(55091),i.e(2139),i.e(46670)]).then(i.bind(i,58021)),Promise.all([i.e(87178),i.e(55848)]).then(i.bind(i,509163))]).then((([{AlertsWidgetDialogImpl:e},t,i,r,n,s,{getUnreadFiresBuffer:o},{getAlertSession:a}])=>{this._willShow&&(this._dialogImpl=new e({widgetAlertsCollection:t,firesActions:i,alertsActionCreators:r,firesActionCreators:n,alertsFiresFocusHandler:s,unreadFiresBuffer:o(),onClose:()=>this.hide(),activeTab:this._activeTab,getChartWidget:this._getChartWidget,alertSession:a()}),this._isVisible.setValue(!0))})))}hide(){this._dialogImpl&&(this._dialogImpl.destroy(),this._dialogImpl=null),this._willShow=!1,this._isVisible.setValue(!1)}visible(){return this._isVisible}}},995155:(e,t,i)=>{"use strict";i.d(t,{getAlertsFiresFocusHandler:()=>r});const r=(0,i(481251).default)((async()=>{const{AlertsFiresFocusHandler:e}=await i.e(69581).then(i.bind(i,291798));return new e}))},789790:(e,t,i)=>{"use strict";i.d(t,{StudyLineTool:()=>s.StudyLineTool,getWidgetAlertsCollection:()=>o});var r=i(481251),n=i(495047),s=i(484181);const o=(0,r.default)((async()=>{const[{getAlertSession:e},{getAlertsTrackers:t},{getAlertsCollection:r},s,{getWatchlistsStates:o},{FacadeWidgetAlertsCollection:a}]=await Promise.all([Promise.all([i.e(87178),i.e(55848)]).then(i.bind(i,509163)),i.e(95063).then(i.bind(i,135886)),Promise.all([i.e(83477),i.e(88857),i.e(55091),i.e(2139),i.e(35938),i.e(96657),i.e(14141)]).then(i.bind(i,935938)),(0,n.getAlertsActions)(),Promise.all([i.e(62885),i.e(55091),i.e(80372)]).then(i.bind(i,693621)),Promise.all([i.e(83477),i.e(79807),i.e(55091),i.e(2139),i.e(35938),i.e(96657),i.e(98429),i.e(35063)]).then(i.bind(i,4940))]),l=await o(),c=e(),d=t();return new a(s,r(),l,c,d)}))},484181:(e,t,i)=>{"use strict";var r;i.d(t,{StudyLineTool:()=>r}),function(e){e.LineToolAnchoredVWAP="AnchoredVWAP@tv-basicstudies"}(r||(r={}))},720728:(e,t,i)=>{"use strict";i.d(t,{defaultCompareSymbols:()=>r});const r=[{symbol:"SPX",title:"S&P 500"},{symbol:"NDX",title:"US 100"},{symbol:"DJI",title:"Dow 30"},{symbol:"NI225",title:"Nikkei 225"},{symbol:"DAX",title:"DAX"},{symbol:"UKX",title:"FTSE 100"}]},154699:(e,t,i)=>{"use strict";function r(){return Promise.all([i.e(10835),i.e(98288),i.e(45702)]).then(i.bind(i,1961))}function n(e){r().then((t=>t.showDisconnectedMessage(e)))}function s(e){r().then((t=>t.showCriticalErrorMessage(e)))}i.d(t,{showCriticalErrorMessage:()=>s,showDisconnectedMessage:()=>n})},207799:(e,t,i)=>{"use strict";function r(){
return Promise.all([i.e(67874),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(91478),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(53924),i.e(30783),i.e(98567),i.e(31481),i.e(73438),i.e(70815),i.e(19981),i.e(53054),i.e(51711),i.e(24313),i.e(26630),i.e(57369),i.e(78392),i.e(3113),i.e(34489),i.e(31868),i.e(37732),i.e(50454),i.e(38361),i.e(21507),i.e(94521),i.e(10271),i.e(13647),i.e(17066),i.e(19854),i.e(63745),i.e(17512),i.e(38253),i.e(35393),i.e(83557),i.e(45632),i.e(25307),i.e(67265),i.e(32227),i.e(25977),i.e(12831),i.e(65805),i.e(65089),i.e(6729),i.e(45586),i.e(61174),i.e(21015)]).then(i.bind(i,733164))}function n(){r().then((e=>e.createIdcAgreementDialog().open()))}function s(e){return r().then((t=>t.createIdcAgreementDelayDialog(e)))}function o(){return r().then((e=>e.createIdcDelayAddServiceDialog()))}i.r(t),i.d(t,{createIdcDelayAddServiceDialog:()=>o,createIdcDelayAgreementDialog:()=>s,showIdcAgreementDialog:()=>n})},85437:(e,t,i)=>{"use strict";i.d(t,{showExchangeAgreementDialog:()=>n});var r=i(473552);async function n(e){void 0===e.isExpert&&(e={...e,isExpert:window.user.declared_status===r.UserStatus.Pro});(await Promise.all([i.e(93874),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(41881),i.e(99408),i.e(91478),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(53924),i.e(98567),i.e(31481),i.e(73438),i.e(70815),i.e(19981),i.e(51711),i.e(24313),i.e(26630),i.e(57369),i.e(3113),i.e(31868),i.e(37732),i.e(94521),i.e(13647),i.e(19854),i.e(17512),i.e(38253),i.e(35393),i.e(83557),i.e(45632),i.e(25307),i.e(67265),i.e(32227),i.e(12831),i.e(65805),i.e(65089),i.e(6729),i.e(45586),i.e(61174),i.e(61932)]).then(i.bind(i,672141))).openExchangeAgreementDialog(e)}},583332:(e,t,i)=>{"use strict";i.d(t,{StudyMarket:()=>n});var r=i(77294);class n{constructor(e,t){this._visibility=new r.WatchedValue(!1),this._dialogPromise=null,this._dialog=null,this._chartWidgetCollection=e,this._options=t}visible(){return this._visibility.readonly()}show(e,t,i){const r=Array.isArray(e)?e:[],n=Array.isArray(e)?void 0:e;null===this._dialog&&this._requestDialog(r??[],t,i,n),this._dialog?.open(r??[],this._options?.indicatorsPreloader?.getIndicatorPromises(),t,i,n)}hide(){this._dialog?.hide()}getDialog(){return this._dialog}resetAllPages(){this._dialog?.resetAllStudies()}_requestDialog(e,t,r,n){if(null===this._dialogPromise){let s
;s=this._options?.onWidget?Promise.all([i.e(31184),i.e(1283),i.e(85615),i.e(56224),i.e(41881),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(6563),i.e(31481),i.e(78335),i.e(7256),i.e(69295),i.e(53054),i.e(84794),i.e(35009),i.e(97677),i.e(14731),i.e(89923),i.e(45492),i.e(17760),i.e(20693),i.e(69069),i.e(49294),i.e(65774),i.e(3105),i.e(13280),i.e(36163),i.e(72386),i.e(17611),i.e(55214),i.e(96029),i.e(94276),i.e(24770),i.e(933),i.e(35511),i.e(29657),i.e(66030),i.e(32420),i.e(89880),i.e(19413),i.e(32227),i.e(87473),i.e(62260),i.e(76536),i.e(40342),i.e(92646),i.e(93843),i.e(2147),i.e(57211),i.e(26843),i.e(87980),i.e(314),i.e(98526),i.e(48172),i.e(8648),i.e(72222),i.e(70796),i.e(6456)]).then(i.bind(i,538943)).then((e=>new e.IndicatorsLibraryContainer(this._chartWidgetCollection,this._options))):Promise.all([i.e(31184),i.e(1283),i.e(85615),i.e(56224),i.e(41881),i.e(55629),i.e(31697),i.e(80760),i.e(79902),i.e(86280),i.e(58882),i.e(26628),i.e(55011),i.e(6563),i.e(31481),i.e(78335),i.e(7256),i.e(69295),i.e(53054),i.e(84794),i.e(35009),i.e(97677),i.e(14731),i.e(89923),i.e(45492),i.e(17760),i.e(20693),i.e(69069),i.e(49294),i.e(65774),i.e(3105),i.e(13280),i.e(36163),i.e(72386),i.e(17611),i.e(55214),i.e(96029),i.e(94276),i.e(24770),i.e(933),i.e(35511),i.e(29657),i.e(66030),i.e(32420),i.e(89880),i.e(19413),i.e(32227),i.e(87473),i.e(62260),i.e(76536),i.e(40342),i.e(92646),i.e(93843),i.e(2147),i.e(57211),i.e(26843),i.e(87980),i.e(314),i.e(98526),i.e(48172),i.e(8648),i.e(72222),i.e(70796),i.e(6456)]).then(i.bind(i,784270)).then((e=>new e.IndicatorsContainerMainChart(this._chartWidgetCollection))),this._dialogPromise=s.then((i=>{this._dialog=i,this._dialog.visible().subscribe((e=>{this._visibility.setValue(e)})),this._dialog.open(e,this._options?.indicatorsPreloader?.getIndicatorPromises(),t,r,n)}))}return this._dialogPromise}}},727481:(e,t,i)=>{"use strict";async function r(e={}){Promise.all([i.e(59400),i.e(1283),i.e(85615),i.e(56224),i.e(59648),i.e(99408),i.e(91478),i.e(55629),i.e(31697),i.e(86280),i.e(53924),i.e(98567),i.e(78335),i.e(73438),i.e(70815),i.e(7256),i.e(53054),i.e(24313),i.e(26630),i.e(57369),i.e(65729),i.e(94521),i.e(13647),i.e(38962),i.e(72086),i.e(17512),i.e(38253),i.e(83557),i.e(45632),i.e(28132),i.e(49268),i.e(65383),i.e(35429),i.e(32227),i.e(12831),i.e(12047),i.e(65089),i.e(15199)]).then(i.bind(i,72835)).then((({showUpgradeToProDialog:t})=>t(e)))}i.r(t),i.d(t,{showUpgradeToProDialog:()=>r})},638257:(e,t,i)=>{"use strict";i.d(t,{createNewChart:()=>_,openNewChart:()=>g});var r=i(954912),n=i(656130),s=i(31214),o=i(229534),a=i(503595),l=i(314802),c=i(444372);const d=c.t(null,void 0,i(564697)),h=c.t(null,void 0,i(796225)),u=c.t(null,void 0,i(491547));async function g(e={}){const{onSameTab:t,...i}=e,r=t?"_self":"_blank";window.is_authenticated?await(0,a.asyncWindowOpen)(p(i),r):window.open((0,n.generateChartUrl)(i),r)}async function _(e={}){return p(e)}async function p(e){let t,i;try{i=await(0,r.fetch)("/charts/",{method:"POST",body:JSON.stringify(e),credentials:"include"})
;const n=i.headers.get("location");if(i.ok&&n)return(0,l.urlWithMobileAppParams)(n);t=(await i.json()).code}catch{}"count_limit"===t||"login_required"===t?(0,s.reloginOrGoPro)({feature:"savedChartsLimit"}):i||!1!==navigator.onLine?i&&i.status>=500||"feature_disabled"===t?(0,o.showErrorDialog)({content:h}):(0,o.showErrorDialog)({content:d}):(0,o.showErrorDialog)({content:u})}},742418:(e,t,i)=>{"use strict";let r;function n(e){const t={...e,...r};return new Promise((e=>{window.runOrSignIn((()=>{e(async function(e){return window.saver.publishChart(e)}(t))}),{source:"Publish chart",sourceMeta:"Chart"})}))}function s(e){r=e}i.d(t,{publishChart:()=>n,setPublishChartOptions:()=>s})},694236:(e,t,i)=>{"use strict";var r,n=i(744404),{clone:s}=i(536794),o=(r={},{suggest:function(e,t){var i=n.ajax({url:t||"/pubscripts-suggest-json/",type:"GET",data:{search:e},dataType:"json"});return i.done((function(e){if(e&&e.results)for(var t=0;t<e.results.length;t++)r[e.results[t].scriptIdPart]||(r[e.results[t].scriptIdPart]=s(e.results[t]))})),i},info:function(e,t=!1){for(var i=n.Deferred(),o=[],a=[],l=0;l<e.length;l++){var c=e[l];r[c]?o.push(s(r[c])):a.length<3e3&&a.push(c)}if(!a.length)return i.resolve(o).promise();var d={scriptIdPart:a.join(","),show_hidden:t};return n.ajax({url:"/pubscripts-get/",type:"POST",data:d,dataType:"json"}).done((function(e){for(var t in e=e||[]){var n=e[t];r[n.scriptIdPart]=s(n),o.push(n)}i.resolve(o)})).fail((function(){i.reject()})),i},invalidateCache:function(e){e.forEach((function(e){delete r[e]}))},cleanCache:function(){r=[]}});e.exports=o},801642:(e,t,i)=>{"use strict";i.d(t,{ChartSaverBase:()=>y});var r=i(650279),n=i(650151),s=i(444372),o=i(382169),a=i(113610),l=i(175203),c=i(277038),d=i(31214),h=i(125226),u=i(251924),g=(i(687037),i(758893)),_=i(744404);const p=(0,h.isFeatureEnabled)("chart_save_metainfo_separately");function m(e,t){p&&"studyMetaInfoMap"in t&&(e.study_meta_info_map=JSON.stringify(t.studyMetaInfoMap),delete t.studyMetaInfoMap),e.content=JSON.stringify(t)}const v=new WeakMap;function S(e){let t=v.get(e);if(void 0===t){const i=JSON.parse(e.content);t=void 0!==i.charts?i.charts.map(JSON.stringify):[e.content],v.set(e,t)}return t}const f=new TextEncoder;class y{constructor(e){this._prevChartState=null,this._chartSavedDelegate=new u.Delegate,this._chartAboutToBeSavedDelegate=new u.Delegate,this._chartSizeLimitExceededDelegate=new u.Delegate,this._isSaveInProcess=!1,this._savingToken=null,this._chartWidgetCollection=e,window.initData&&window.initData.content&&(this._prevChartState={content:JSON.stringify(window.initData.content),study_meta_info_map:JSON.stringify(window.initData.study_meta_info_map??{})})}async saveChartLineTools(e,t,i,r){{const n=await(0,a.getChartStorage)();return(s=>n.saveLineToolsAndGroups(s,e,t,i,r))(this.layoutId())}}layoutId(){return this._chartWidgetCollection.metaInfo.uid.value()}saveChartSilently(e,t,r){const o=r||{};_(window).on("beforeunload.savechart",(()=>s.t(null,void 0,i(533416)))),this._isSaveInProcess=!0,this._chartAboutToBeSavedDelegate.fire(),
this._saveChart((e=>{const t=e&&!0,i=this._getChartWidgetCollectionState(!1,void 0,void 0,void 0,t),r=this._getCommonSavingInfo(!1);return m(r,i),o.chartName&&(r.name=o.chartName),r.name&&0!==r.name.length||!o.defaultChartName||(r.name=o.defaultChartName),o.autoSave&&(r.autoSave=!0),r}),((t,i)=>{(0,n.assert)(!this._chartWidgetCollection.readOnly(),"Trying to save layout in read-only mode"),i&&this.layoutId()===t.uid&&this._chartWidgetCollection.metaInfo.name.setValue(i.name??""),this._prevChartState=i,this._chartSavedDelegate.fire(!0),this._isSaveInProcess=!1,e&&e({uid:t.uid,data:i}),this._prevChartState&&delete this._prevChartState.savingToken}),(e=>{this._chartSavedDelegate.fire(!1),this._isSaveInProcess=!1,t&&t(e)}),o),_(window).off("beforeunload.savechart")}saveToJSON(e){const t=e&&!1===e.includeDrawings||void 0,i=this._getCommonSavingInfo(!1);return m(i,this._getChartWidgetCollectionState(!1,!0,t,void 0,t)),i}isSaveInProcess(){return this._isSaveInProcess}_getChartWidgetCollectionState(e,t,i,r,n){let s=!1;return e?s=!0:(t=!0,r=!1),this._chartWidgetCollection.state({withData:!!e,skipLineToolsFromOtherSymbols:!!i,wipeSensitiveData:!!r,skipLineTools:n,skipHiddenSources:s,addOnlyActiveChart:!t})}_getCommonSavingInfo(e){const t=this._chartWidgetCollection,i=this._chartWidgetCollection.chartsSymbols()[t.activeChartWidget.value().id()],r={...(n=i,{...n,legs:JSON.stringify(n.legs??[])})};var n;const s=t.metaInfo,o=s.id.value();return null!==o&&(r.id=o),r.name=s.name.value()||"",r.description=s.description.value()||"",r.is_realtime=r.is_realtime=e?"0":"1",r}async _saveLineToolsToStorage(){{if(!this.layoutId())throw new Error("Cannot save for new layout");const[e,t]=this._chartWidgetCollection.getAll().reduce(((e,t)=>{const i=t.lineToolsSynchronizer();if(i){e[0]||=i.hasUnsavedMigrationsFromChartState();const t=i.flushPendingSavings();t&&e[1].push(t)}return e}),[!1,[]]);return t.length&&await Promise.all(t),t.length>0&&e}}_invalidateAllLineTools(){this._chartWidgetCollection.getAll().forEach((e=>e.lineToolsSynchronizer()?.invalidateAll()))}_saveChartImpl(e,t,i,r,n,s){let o;if(this._savingToken=String(Math.random()),e.savingToken=this._savingToken,o=s=>{this._savingToken=null;const o=s.result,a=s.response?.status;if("ok:"===o.substring(0,3)){const r=o.substring(3),n=JSON.parse(r);t.uid||t.uid!==this.layoutId()||(t.id=n.id,t.uid=n.uid,t.isPrivate=n.isPrivate,this._chartWidgetCollection.metaInfo.id.setValue(t.id),this._chartWidgetCollection.metaInfo.uid.setValue(t.uid),this._chartWidgetCollection.metaInfo.isPrivate.setValue(t.isPrivate)),t.uid===this.layoutId()&&(t.lastModified=n.lastModified,this._chartWidgetCollection.metaInfo.lastModified.setValue(t.lastModified)),i(t,e)}else if("saved_chart_limit_reached"===o||""===o){if(r({status:a,message:""===o?"Unknown error":"Saved chart limit reached"}),n.noDefaultOnFail)return;(0,c.createGoProDialog)({feature:"savedChartsLimit"})}else r({status:a,message:o}),_("#error").html(o);_(window).off("beforeunload.savechart")},!e.name)return void r({status:-1,
message:"Saving chart with empty name is not allowed"});const a={...e};this._prevChartState?.study_meta_info_map===a.study_meta_info_map&&delete a.study_meta_info_map,g.backend.saveChart(a.name,a.short_name,a.resolution,a,t).then(o).catch((async e=>{const t=e instanceof Response?e:void 0,o=e instanceof Error?e:void 0;this._savingToken=null;const a=r.bind(null,{status:t?.status,message:t?.statusText??o?.message??"Unknown error"});if(t&&413===t.status)return this._chartSizeLimitExceededDelegate.fire(),void a();if(t&&403===t.status){try{"login_required"===(await t.json()).code&&(0,d.reloginOrGoPro)({feature:"savedChartsLimit"})}catch(e){}return void a()}const l=t&&429===t.status;n.retry||l?a():(n.retry=!0,this._saveChart(s,i,r,n))}))}async _saveChart(e,t,n,s){const a=this._chartWidgetCollection.metaInfo,c={name:a.name.value(),description:a.description.value(),uid:a.uid.value(),id:a.id.value(),lastModified:a.lastModified.value(),username:a.username.value(),isPrivate:a.isPrivate.value()};let d=s.changes??o.changedAll;let h=!0;if(2&d)try{await this._saveLineToolsToStorage()&&(d|=1)}catch(e){d|=1;const{SavingLineToolsLibraryError:t}=await Promise.resolve().then(i.bind(i,198303));!1||(h=!1)}if(1&d){const i=e(h);if((0,r.default)(this._prevChartState,i)&&null!==c.id)return this._chartSavedDelegate.fire(!0),void t(c,i);(function(e,t){const i=null===e?[]:S(e),r=S(t);let n=0,s=0;for(let e=0;e<r.length;++e){const t=f.encode(r[e]).length;n+=t,r[e]!==i[e]&&(s+=t)}l.telemetry.sendChartReport("save_layout_changed_to_total_bytes_ratio",{value:s/n})})(this._prevChartState,i);const o=(e,i)=>(h||this._chartWidgetCollection.getAll().forEach((e=>e.lineToolsSynchronizer()?.markAsValidatedBecauseOfSavingToContent())),t(e,i));return this._saveChartImpl(i,c,o,n,s,e)}this._chartSavedDelegate.fire(!0),t(c,e(h))}}},591631:(e,t,i)=>{"use strict";var r=i(744404),n=i(282312),s=i(345848).trackEvent,o=i(776734).getTracker,a=i(694236),l=i(251954),c=i(503595).asyncWindowOpen,d=i(750397),h=i(779923).showWarning,u=i(989013).forceTradingObjVisibilityOnScreenshot,g=i(801642).ChartSaverBase;const _=i.i18next(null,void 0,i(249947));function p(e){return e.returnValue=i.i18next(null,void 0,i(976078)),e.returnValue}t.ChartSaver=class extends g{constructor(e){super(e),this._savingToken=null}chartSizeLimitExceeded(){return this._chartSizeLimitExceededDelegate}chartAboutToBeSaved(){return this._chartAboutToBeSavedDelegate}chartSaved(){return this._chartSavedDelegate}publishChart(e){var t=this;return new Promise((function(r){s("GUI","Publish Chart");var n=t,o={accessType:(e=e||{}).isPrivate||TVSettings.getBool("publishchart.private",!1)?0:1,publishSource:e.publishSource,videoFilename:e.videoFilename,videoDuration:e.videoDuration,videoCam:e.videoCam},a={savePrivacySetting:!e.doNotSavePrivacySetting,onWidget:e.onWidget},l=e.onPublishUrl,c=e.onPublishError
;n._ideaPublisher?r(n._ideaPublisher.openPublication(o,a)):Promise.all([Promise.all([i.e(42517),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(57162),i.e(32227),i.e(25977),i.e(29042),i.e(69095),i.e(44125)]).then(i.bind(i,777483)),Promise.all([i.e(42517),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(57162),i.e(32227),i.e(25977),i.e(29042),i.e(69095),i.e(44125)]).then(i.bind(i,792011)),Promise.all([i.e(42517),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(57162),i.e(32227),i.e(25977),i.e(29042),i.e(69095),i.e(44125)]).then(i.bind(i,788293)),Promise.all([i.e(42517),i.e(50454),i.e(38361),i.e(21507),i.e(10271),i.e(57162),i.e(32227),i.e(25977),i.e(29042),i.e(69095),i.e(44125)]).then(i.bind(i,318596))]).then((([{CategoriesProvider:e},{ChartInfoProvider:t},{IdeasProvider:i},{IdeaPublisher:s}])=>{var d=new t({chartWidgetCollection:n._chartWidgetCollection}),h=new i({publish:function(e,t){return new Promise((function(i,r){var s={closeForm:function(){i()},showError:function(e){const t=JSON.parse(e).errorText;r(t||e)},onPublishUrl:l,onPublishError:c};try{n.onPublish(e,Object.assign({},t,s))}catch(e){r(_)}}))}}),u=new e;n._ideaPublisher=new s({chartInfoProvider:d,ideasProvider:h,categoriesProvider:u,onOpenEditor:function(){},onMinimizeEditor:function(){},onCloseEditor:function(){}}),r(n._ideaPublisher.openPublication(o,a))}))}))}publishScript(e,t,i){var r=this;if(e.accessType=TVSettings.getBool("publishscript.private",!1)?0:1,r._scriptPublisher)r._scriptPublisher.openPublication(e,t);else{var n=i.scriptPublisher,s=i.scriptsProvider,o=i.categoriesProvider,l=new(0,i.chartInfoProvider)({chartWidgetCollection:r._chartWidgetCollection}),c=new s({publish:function(e){return new Promise((function(t,i){var n={closeForm:function(){if(e&&e.scriptPublication&&e.scriptPublication.updateScriptIdPart){var i=e.scriptPublication.updateScriptIdPart;a.invalidateCache([i]),window.studyMarket&&window.studyMarket.resetAllPages()}t()},showError:function(e){i(e)},savePrivacySetting:!0};try{r.onPublish(e,n)}catch(e){i(_)}}))}});r._scriptPublisher=new n({scriptsProvider:c,categoriesProvider:new o,chartInfoProvider:l,scriptType:e.scriptType,scriptTitle:e.title,existingLibraryInfo:e.existingLibraryInfo,originalScriptVersion:t.originalScriptVersion,originalScriptId:t.originalScriptVersion}),r._scriptPublisher.openPublication(e,t)}}isScriptNameValid(e){return""!==e.trim()&&e.length<=64}isScriptDescriptionValid(e){return""!==e.trim()&&e.length<=7e4}isScriptDescribersValid(e,t){return this.isScriptNameValid(e)&&this.isScriptDescriptionValid(t)}openInNewTab(e,t,i){e.publishInProgress=!0,i||this.isScriptDescribersValid(t.name,t.description)&&c(new Promise((function(t){e.setPopupUrl=t})))}onPublish(e,t){{var a=this;if(a.publishInProgress)return;var c=t&&t.publishAllLayout,g=a._getCommonSavingInfo(!0),_=!1;e.scriptPublication&&(e.scriptPublication.scriptProtection===d.Access.ACCESS_CLOSED_NEEDS_AUTH&&(_=!0),g.scriptProtection=parseInt(d.Access.MAP_NAME_TO_ID[e.scriptPublication.scriptProtection])),function(e,t){e.content=JSON.stringify(t)
}(g,this._getChartWidgetCollectionState(!0,c,!0,_)),u.setValue(!1),g.image=JSON.stringify(this._chartWidgetCollection.images({onlyActiveChart:!c})),u.setValue(null);const f=r=>{window.removeEventListener("beforeunload",p),a.publishInProgress=!1;var n=r.responseText||"";if("ok:"===n.substring(0,3)){var s=!1;if(t.savePrivacySetting){s=!e.is_public;TVSettings.setValue(e.scriptPublication?"publishscript.private":"publishchart.private",s)}var o=n.substring(3),c=JSON.parse(o);a._chartWidgetCollection.metaInfo.id.value()||a._chartWidgetCollection.metaInfo.id.setValue(c.id),t.closeForm&&t.closeForm(),t.onPublishUrl&&t.onPublishUrl(c.publishUrl,c.uuid),l.emit("onPublishUrl",c.uuid),a._lastPublishUrl=c.publishUrl,a.setPopupUrl&&a.setPopupUrl(`${c.publishUrl}${s||e.scriptPublication?"":"?social_toast=true"}`)}else{(413===r.status||/^[\d\s]*request.+large/i.test(n.trim()))&&(n=i.i18next(null,void 0,i(524074)));var d=n||i.i18next(null,void 0,i(871028));t.showError&&t.showError(d,{html:!0}),t.onPublishError&&t.onPublishError(d),a.setPopupUrl&&a.setPopupUrl(void 0)}};var m=e.scriptPublication,v=!(!m||!m.updateScriptIdPart),S=new Promise((function(e,t){var r;m?(v?(window.addEventListener("beforeunload",p),r=n.publishNext(m.scriptSource,m.updateScriptIdPart,m.originalScriptId,m.originalScriptVersion)):r=n.publishNew(m.scriptSource,m.scriptProtection,m.originalScriptId,m.originalScriptVersion),r.done((function(t){e(t.publishedstudyscript_id)})).fail((function(e){const{errors:r}=e,n=-1!==r.findIndex((e=>e.message.indexOf("already published library")))?i.i18next(null,void 0,i(266914)):i.i18next(null,void 0,i(759638)),s=r.map((e=>e.message)).join(", ");h({title:n,text:s}),t()}))):e()}));v?S.then((function(i){a.openInNewTab(a,e,t.onWidget);var n={publishedstudyscript_id:i,script_terms:e.script_terms,description:e.description,tags:e.tags,preserve_old_chart:e.preserveOldChart};r.ajax({url:"/script-update/",type:"post",dataType:"text",data:r.extend({},g,n),complete:f})}),f):S.then((function(i){a.openInNewTab(a,e,t.onWidget),i&&(e.publishedstudyscript_id=i);for(var n=e.tags.split(","),l=e.scriptPublication?"Script":"Idea",c=0;c<n.length;c++)s(l+" Publication",l+" Tag",n[c]);if(e.scriptPublication){var d=e.scriptPublication.scriptProtection;s("Script Publication","Script Visibility",{open_no_auth:"Open",closed_no_auth:"Protected",closed_needs_auth:"Invite Only"}[d]),o().then((e=>{e&&e.trackPublicationAction({event_name:"publication_happened",action:"posting_script"})}))}else{var h=e.is_education?"Education":"Analysis",u=e.is_public?"Public":"Private";s("Idea Publication","Idea Type",h),s("Idea Publication","Idea Strategy",["Neutral","Long","Short"][e.direction]),s("Idea Publication","Idea Privacy",u),o().then((e=>{e&&e.trackPublicationAction({event_name:"publication_happened",action:"posting_idea"})}))}r.ajax({url:"/publishchart/",type:"post",dataType:"text",data:r.extend({},g,e),complete:f})}),f)}}}},772383:(e,t,i)=>{"use strict";i.d(t,{setNewBlackColor:()=>r});const r=(0,i(125226).isFeatureEnabled)("set_new_black_color")},248060:(e,t,i)=>{
"use strict";i.d(t,{getDayResolutionTimeFrameOptions:()=>h,getFromForDay:()=>l,getFromForMonthsAgo:()=>o,getFromForYearsAgo:()=>a,getMediumTimeFrameOptions:()=>u,getMiniTimeFrameOptions:()=>d,getStartOfTheYear:()=>c});var r=i(708078),n=i(119381);const s=Date.now();function o(e){const t=new Date(s);return t.setMonth(t.getMonth()-e),Math.trunc(t.valueOf()/1e3)}function a(e){const t=new Date(s);return t.setFullYear(t.getFullYear()-e),Math.trunc(t.valueOf()/1e3)}function l(e){const t=new Date(s);return t.setDate(t.getDate()-e),Math.trunc(t.valueOf()/1e3)}function c(){return Math.trunc((0,r.resetToYearStart)(new Date(s)).valueOf()/1e3)}function d(e){const t=(0,n.getTimeFrames)();return[{...t[e?"lastsession":"1d"]},{...t["1m"],targetResolution:"1D",from:o(1)},{...t["3m"],targetResolution:"1D",from:o(3)},{...t["12m"],from:a(1)},{...t["60m"],targetResolution:"1M",from:a(5)},{...t.all}]}function h(e){const t=(0,n.getTimeFrames)();return[{...t[e?"lastsession":"1d"]},{...t["1m"],targetResolution:"1D",from:o(1)},{...t["3m"],targetResolution:"1D",from:o(3)},{...t["6m"],targetResolution:"1D",from:o(6)},{...t.ytd,targetResolution:"1D",from:o(6)},{...t["12m"],from:a(1)}]}function u(e){const t=(0,n.getTimeFrames)(),i=[];return 1!==e&&i.push({...t.lastsession}),0!==e&&i.push({...t["1d"]}),[...i,{...t["1m"],targetResolution:"60",from:o(1)},{...t["3m"],targetResolution:"120",from:o(3)},{...t["12m"],from:a(1)},{...t["60m"],targetResolution:"1W",from:a(5)},{...t.all}]}},119381:(e,t,i)=>{"use strict";i.d(t,{getTimeFrames:()=>s});var r=i(444372),n=i(535861);function s(e){return{"1d":{text:r.t(null,void 0,i(207075)),value:{value:"1D",type:"period-back"},targetResolution:e?.["1D"]??(0,n.stringAsResolution)("1"),description:(0,n.daysStringLiteral)(1)},"5d":{text:r.t(null,void 0,i(558628)),value:{value:"5D",type:"period-back"},targetResolution:e?.["5D"]??(0,n.stringAsResolution)("5"),description:(0,n.daysStringLiteral)(5)},"1w":{text:r.t(null,void 0,i(189696)),value:{value:"7D",type:"period-back"},targetResolution:e?.["5W"]??(0,n.stringAsResolution)("15"),description:(0,n.weeksStringLiteral)(1)},"1m":{text:r.t(null,void 0,i(333493)),value:{value:"1M",type:"period-back"},targetResolution:e?.["1M"]??(0,n.stringAsResolution)("30"),description:(0,n.monthsStringLiteral)(1)},"3m":{text:r.t(null,void 0,i(318717)),value:{value:"3M",type:"period-back"},targetResolution:e?.["3M"]??(0,n.stringAsResolution)("60"),description:(0,n.monthsStringLiteral)(3)},"6m":{text:r.t(null,void 0,i(869411)),value:{value:"6M",type:"period-back"},targetResolution:e?.["6M"]??(0,n.stringAsResolution)("120"),description:(0,n.monthsStringLiteral)(6)},"12m":{text:r.t(null,void 0,i(186322)),value:{value:"12M",type:"period-back"},targetResolution:e?.["12M"]??(0,n.stringAsResolution)("1D"),description:(0,n.yearsStringLiteral)(1)},"24m":{text:r.t(null,void 0,i(745391)),value:{value:"24M",type:"period-back"},targetResolution:e?.["24M"]??(0,n.stringAsResolution)("1W"),description:(0,n.yearsStringLiteral)(2)},"36m":{text:r.t(null,void 0,i(189992)),value:{value:"36M",type:"period-back"
},targetResolution:e?.["36M"]??(0,n.stringAsResolution)("1W"),description:(0,n.yearsStringLiteral)(3)},"60m":{text:r.t(null,void 0,i(772834)),value:{value:"60M",type:"period-back"},targetResolution:e?.["60M"]??(0,n.stringAsResolution)("1W"),description:(0,n.yearsStringLiteral)(5)},"120m":{text:r.t(null,void 0,i(27969)),value:{value:"120M",type:"period-back"},targetResolution:e?.["120M"]??(0,n.stringAsResolution)("1M"),description:(0,n.yearsStringLiteral)(10)},ytd:{text:r.t(null,void 0,i(168881)),value:{value:"YTD",type:"period-back"},targetResolution:e?.YTD??(0,n.stringAsResolution)("1D"),description:r.t(null,void 0,i(251478))},all:{text:r.t(null,void 0,i(580066)),value:{value:"ALL",type:"period-back"},targetResolution:e?.ALL??(0,n.stringAsResolution)("1M")},lastsession:{text:r.t(null,void 0,i(207075)),value:{value:"LASTSESSION",type:"period-back"},targetResolution:e?.LASTSESSION??(0,n.stringAsResolution)("1"),description:(0,n.daysStringLiteral)(1)}}}},535861:(e,t,i)=>{"use strict";i.d(t,{daysStringLiteral:()=>o,hoursStringLiteral:()=>s,minutesStringLiteral:()=>n,monthsStringLiteral:()=>l,stringAsResolution:()=>d,weeksStringLiteral:()=>a,yearsStringLiteral:()=>c});var r=i(444372);const n=e=>r.t(null,{plural:"{str} minutes",count:e,replace:{str:`${e}`}},i(805926)),s=e=>r.t(null,{plural:"{str} hours",count:e,replace:{str:`${e}`}},i(664963)),o=e=>r.t(null,{plural:"{str} days",count:e,replace:{str:`${e}`}},i(862368)),a=e=>r.t(null,{plural:"{str} weeks",count:e,replace:{str:`${e}`}},i(149306)),l=e=>r.t(null,{plural:"{str} months",count:e,replace:{str:`${e}`}},i(520062)),c=e=>r.t(null,{plural:"{str} years",count:e,replace:{str:`${e}`}},i(791549)),d=e=>e},674277:(e,t,i)=>{"use strict";i.d(t,{timeFrames:()=>r});const r=(0,i(119381).getTimeFrames)()},887168:(e,t,i)=>{"use strict";i.d(t,{availableTimeFrames:()=>c});var r=i(650151),n=i(674277),s=i(939767),o=i(248060);const a={8:[n.timeFrames.ytd,n.timeFrames["12m"],n.timeFrames["60m"],n.timeFrames.all],3:[n.timeFrames["1d"],n.timeFrames["5d"],n.timeFrames["1m"],n.timeFrames["3m"],n.timeFrames["6m"],n.timeFrames.ytd,n.timeFrames["12m"],n.timeFrames["60m"],n.timeFrames.all]},l=new Map([["1D",(0,o.getFromForDay)(1)],["5D",(0,o.getFromForDay)(5)],["7D",(0,o.getFromForDay)(7)],["1M",(0,o.getFromForMonthsAgo)(1)],["3M",(0,o.getFromForMonthsAgo)(3)],["6M",(0,o.getFromForMonthsAgo)(6)],["12M",(0,o.getFromForYearsAgo)(1)],["24M",(0,o.getFromForYearsAgo)(2)],["36M",(0,o.getFromForYearsAgo)(3)],["60M",(0,o.getFromForYearsAgo)(5)],["YTD",(0,o.getStartOfTheYear)()],["LASTSESSION",(0,o.getFromForDay)(1)],["ALL",-1/0]]);function c(e,t,i=-1/0){let o;null!==e?o=(a[3]||[]).filter((t=>null===(0,s.getResolutionUnsupportedReason)(e,t.targetResolution))):(9===t&&(t=3),6===t&&(t=8),o=a[t]||[]);const c=[];for(let e=0;e<o.length;e++){const t=o[e];if(c.push(t),(0,r.ensureDefined)(l.get(t.value.value))<i)break}return c.length&&"ALL"!==c[c.length-1].value.value&&(c[c.length-1]={...c[c.length-1],text:n.timeFrames.all.text,value:{...c[c.length-1].value,value:n.timeFrames.all.value.value}}),c}},505482:e=>{
"use strict"
;e.exports=JSON.parse('{"en":{"language":"en","language_name":"English","flag":"us","geoip_code":"us","iso":"en","iso_639_3":"eng","global_name":"English","is_only_recommended_tw_autorepost":true},"in":{"language":"en","language_name":"English (India)","flag":"in","geoip_code":"in","iso":"en","iso_639_3":"eng","global_name":"Indian"},"de_DE":{"language":"de","language_name":"Deutsch","flag":"de","geoip_code":"de","countries_with_this_language":["at","ch"],"iso":"de","iso_639_3":"deu","global_name":"German","is_in_european_union":true},"fr":{"language":"fr","language_name":"Franais","flag":"fr","geoip_code":"fr","iso":"fr","iso_639_3":"fra","global_name":"French","is_in_european_union":true},"ca_ES":{"language":"ca_ES","language_name":"Catal","flag":"es","geoip_code":"es","iso":"ca","iso_639_3":"cat","global_name":"Catalan"},"es":{"language":"es","language_name":"Espaol","flag":"es","geoip_code":"es","countries_with_this_language":["mx","ar","ve","cl","co","pe","uy","py","cr","gt","c","bo","pa","pr"],"iso":"es","iso_639_3":"spa","global_name":"Spanish","is_in_european_union":true},"it":{"language":"it","language_name":"Italiano","flag":"it","geoip_code":"it","iso":"it","iso_639_3":"ita","global_name":"Italian","is_in_european_union":true},"pl":{"language":"pl","language_name":"Polski","flag":"pl","geoip_code":"pl","iso":"pl","iso_639_3":"pol","global_name":"Polish","is_in_european_union":true},"hu_HU":{"language":"hu_HU","language_name":"Magyar","flag":"hu","geoip_code":"hu","iso":"hu","iso_639_3":"hun","global_name":"Hungarian","is_in_european_union":true},"sv_SE":{"language":"sv","language_name":"Svenska","flag":"se","geoip_code":"se","iso":"sv","iso_639_3":"swe","global_name":"Swedish","is_in_european_union":true},"tr":{"language":"tr","language_name":"Trke","flag":"tr","geoip_code":"tr","iso":"tr","iso_639_3":"tur","global_name":"Turkish","is_only_recommended_tw_autorepost":true},"ru":{"language":"ru","language_name":"","flag":"ru","geoip_code":"ru","countries_with_this_language":["am","by","kg","kz","md","tj","tm","uz"],"iso":"ru","iso_639_3":"rus","global_name":"Russian","is_only_recommended_tw_autorepost":true},"br":{"language":"pt","language_name":"Portugus","flag":"br","geoip_code":"br","iso":"pt","iso_639_3":"por","global_name":"Portuguese"},"id":{"language":"id_ID","language_name":"Bahasa Indonesia","flag":"id","geoip_code":"id","iso":"id","iso_639_3":"ind","global_name":"Indonesian"},"ms_MY":{"language":"ms_MY","language_name":"Bahasa Melayu","flag":"my","geoip_code":"my","iso":"ms","iso_639_3":"zlm","global_name":"Malaysian"},"th_TH":{"language":"th","language_name":"","flag":"th","geoip_code":"th","iso":"th","iso_639_3":"tha","global_name":"Thai"},"vi_VN":{"language":"vi","language_name":"Ting Vit","flag":"vn","geoip_code":"vn","iso":"vi","iso_639_3":"vie","global_name":"Vietnamese"},"ja":{"language":"ja","language_name":"","flag":"jp","geoip_code":"jp","iso":"ja","iso_639_3":"jpn","global_name":"Japanese"},"kr":{"language":"ko","language_name":"","flag":"kr","geoip_code":"kr","iso":"ko","iso_639_3":"kor","global_name":"Korean"},"zh_CN":{"language":"zh","language_name":"","flag":"cn","geoip_code":"cn","countries_with_this_language":["zh"],"iso":"zh-Hans","iso_639_3":"cmn","global_name":"Chinese"},"zh_TW":{"language":"zh_TW","language_name":"","flag":"tw","geoip_code":"tw","countries_with_this_language":["hk"],"iso":"zh-Hant","iso_639_3":"cmn","global_name":"Taiwanese"},"ar_AE":{"language":"ar","language_name":"","flag":"sa","geoip_code":"sa","countries_with_this_language":["ae","bh","dj","dz","eg","er","iq","jo","km","kw","lb","ly","ma","mr","om","qa","sa","sd","so","sy","td","tn","ye"],"dir":"rtl","iso":"ar","iso_639_3":"arb","global_name":"Arabic"},"he_IL":{"language":"he_IL","language_name":"","flag":"il","geoip_code":"il","dir":"rtl","iso":"he","iso_639_3":"heb","global_name":"Israeli"}}')
}}]);